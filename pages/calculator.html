<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=400, user-scalable=no">

    <!-- 在現有的 meta 標籤下方添加 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>小朋友計算機 - 計算頁面</title>

    <style>

        /* ============================================
        * CSS 變數定義區域 - 統一管理所有外觀相關變數
        * ============================================ */

        /* 基礎全域變數定義 */
        :root {
            /* ========== 尺寸相關變數 ========== */
            /* 圓角尺寸 */
            --border-radius-sm: 4px;              /* 小型元素圓角（按鈕、輸入框） */
            --border-radius-md: 8px;              /* 中型元素圓角（卡片） */
            --border-radius-lg: 12px;             /* 大型元素圓角（模態框） */
            
            /* 間距尺寸 */
            --spacing-xs: 2px;                    /* 極小間距 */
            --spacing-sm: 4px;                    /* 小間距 */
            --spacing-md: 8px;                    /* 中間距 */
            --spacing-lg: 15px;                   /* 大間距 */
            
            /* 字體大小 */
            --font-size-xs: 12px;                 /* 極小字體（標籤說明） */
            --font-size-sm: 14px;                 /* 小字體（次要文字） */
            --font-size-md: 16px;                 /* 中字體（一般內容） */
            --font-size-lg: 18px;                 /* 大字體（重要內容） */
            --font-size-xl: 22px;                 /* 特大字體（標題） */
            
            /* 特殊元素字體大小 */
            --input-font-size: 16px;              /* 輸入框文字大小 */
            --label-font-size: 16px;              /* 標籤文字大小 */
            
            /* 輸入框特殊設定 */
            --input-padding-lr: 5px;              /* 輸入框左右內邊距 */
            
            /* 動畫時間 */
            --transition-fast: 0.2s;              /* 快速過渡動畫 */
            --transition-normal: 0.3s;            /* 標準過渡動畫 */
            --transition-slow: 0.5s;              /* 慢速過渡動畫 */
            
            /* 陰影效果 */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);    /* 淺層陰影 */
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.3);    /* 中層陰影 */
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.4);   /* 深層陰影 */
        }

        /* ========== 主題色彩定義 ========== */
        /* 預設主題：暗夜橘焰 */
        :root {
            /* RGB 色彩值（用於透明度調整） */
            --primary-color-rgb: 51, 51, 51;              /* 主背景色 RGB */
            --secondary-color-rgb: 74, 74, 74;            /* 次背景色 RGB */
            --accent-color-rgb: 255, 156, 51;             /* 強調色 RGB */
            --input-bg-rgb: 34, 34, 34;                   /* 輸入框背景 RGB */
            --error-color-rgb: 231, 76, 60;               /* 錯誤色 RGB */
            --info-color-rgb: 52, 152, 219;               /* 資訊色 RGB */
            
            /* 基本色彩 */
            --primary-color: #333333;                      /* 主要背景色 */
            --secondary-color: #4a4a4a;                    /* 次要背景色 */
            --text-color: #ffffff;                         /* 文字顏色 */
            --text-muted: #999999;                         /* 淡化文字顏色 */
            --border-color: #555555;                       /* 邊框顏色 */
            --hover-color: #666666;                        /* 懸停背景色 */
            --shadow-color: rgba(0, 0, 0, 0.3);           /* 陰影顏色 */
            
            /* 功能色彩 */
            --accent-color: #ff9c33;                       /* 強調色（橘色） */
            --accent-color-light: rgba(255, 156, 51, 0.2); /* 淡強調色 */
            --accent-color-dark: #e88a22;                  /* 深強調色 */
            --success-color: #33b5e5;                      /* 成功色（藍色） */
            --warning-color: #ff9c33;                      /* 警告色（橘色） */
            --error-color: #e74c3c;                        /* 錯誤色（紅色） */
            --info-color: #3498db;                         /* 資訊色（藍色） */
            
            /* 元件專用色彩 */
            --button-primary: #ff9c33;                     /* 主要按鈕色 */
            --button-secondary: #4a4a4a;                   /* 次要按鈕色 */
            --button-orange: #ff9c33;                      /* 橘色按鈕（兼容舊代碼） */
            --button-blue: #33b5e5;                        /* 藍色按鈕（兼容舊代碼） */
            --button-grey: #333333;                        /* 灰色按鈕（兼容舊代碼） */
            
            /* 輸入框色彩 */
            --input-bg: #222222;                           /* 輸入框背景色 */
            --input-border: #555555;                       /* 輸入框邊框色 */
            --input-focus-border: #ff9c33;                 /* 輸入框焦點邊框色 */
            
            /* 其他元件色彩 */
            --card-bg: #333333;                            /* 卡片背景色 */
            --text-highlight: #ff9c33;                     /* 文字強調色 */
            --helper-text-color: #999999;                  /* 輔助文字顏色 */
            --note-text-color: #e0e0e0;                    /* 備註文字顏色 */
            --note-text-empty: #888888;                    /* 空備註提示文字顏色 */
        }

        /* ============================================
        * 固定頂部利率顯示header樣式
        * 說明：永遠固定在網頁最頂部的利率顯示區域樣式定義
        * 包含佣後和稅佣後利率的顯示格式和動畫效果
        * ============================================ */

        /* 固定頂部的利率顯示容器 - 主要容器樣式 */
        .fixed-rate-header {
            position: fixed;                              /* 固定定位，不隨頁面滾動 */
            top: 0;                                       /* 貼齊瀏覽器窗口頂部 */
            left: 0;                                      /* 貼齊瀏覽器窗口左側 */
            right: 0;                                     /* 貼齊瀏覽器窗口右側 */
            width: 100%;                                  /* 占滿整個寬度 */
            max-width: 400px;                             /* 與body的max-width保持一致 */
            margin: 0 auto;                               /* 水平居中對齊 */
            background-color: var(--primary-color);      /* 使用主題背景色（深色背景） */
            border-bottom: 3px solid var(--accent-color); /* 底部邊框使用強調色（橘色） */
            padding: 12px 10px;                           /* 內部間距：上下12px，左右10px */
            display: flex;                                /* 使用彈性布局排列內部元素 */
            align-items: center;                          /* 垂直居中對齊 */
            justify-content: center;                      /* 水平居中對齊 */
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.4);   /* 向下的陰影效果，增加層次感 */
            z-index: 1500;                                /* 層級設定，確保在所有內容之上 */
            transition: all 0.3s ease;                    /* 平滑過渡效果，用於顏色變化等動畫 */
            animation: headerSlideDown 0.6s ease-out;     /* 載入時從上方滑入的動畫效果 */
        }

        /* header載入時的滑入動畫定義 */
        @keyframes headerSlideDown {
            /* 動畫開始狀態：在螢幕上方且透明 */
            from {
                transform: translateY(-100%);             /* 位置在上方100%的距離外 */
                opacity: 0;                               /* 完全透明 */
            }
            /* 動畫結束狀態：正常位置且不透明 */
            to {
                transform: translateY(0);                 /* 移動到正常位置 */
                opacity: 1;                               /* 完全不透明 */
            }
        }

        /* header中的利率顯示項目容器 - 單個利率顯示區域的樣式 */
        .rate-header-item {
            display: flex;                                /* 使用彈性布局 */
            align-items: center;                          /* 垂直居中對齊 */
            gap: 6px;                                     /* 內部元素之間的間距 */
            transition: transform 0.2s ease;              /* 懸停效果的過渡動畫 */
        }

        /* 利率項目的懸停效果 - 滑鼠懸停時的視覺回饋 */
        .rate-header-item:hover {
            transform: scale(1.02);                       /* 輕微放大效果 */
        }

        /* header中的標題文字樣式 - "佣後"和"稣佣後"標籤的樣式 */
        .rate-header-label {
            font-size: 20px;                              /* 文字大小，比原footer稍大 */
            color: var(--accent-color);                   /* 使用強調色（橘色） */
            font-weight: bold;                            /* 粗體文字，增加視覺重量 */
            white-space: nowrap;                          /* 防止文字換行 */
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);   /* 文字陰影，增加立體感 */
            letter-spacing: 1px;                          /* 字母間距，讓文字更清晰 */
        }

        /* header中的利率數值輸入框樣式 - 顯示利率數值的輸入框 */
        .rate-header-input {
            width: 75px;                                  /* 固定寬度，比footer稍寬 */
            padding: 6px 8px;                             /* 內部間距，讓數字顯示更舒適 */
            background-color: var(--input-bg);            /* 使用輸入框背景色（深色） */
            color: var(--text-color);                     /* 使用文字顏色（白色或主題色） */
            border: 2px solid var(--border-color);        /* 邊框，比原footer稍粗 */
            border-radius: 6px;                           /* 圓角效果，比原footer稍大 */
            font-size: 20px;                              /* 文字大小，比原footer稍大 */
            text-align: right;                            /* 文字靠右對齊（數字顯示習慣） */
            font-weight: bold;                            /* 粗體文字，讓數字更突出 */
            cursor: default;                              /* 預設游標（因為是唯讀欄位） */
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2); /* 內陰影，增加凹陷效果 */
            transition: all 0.3s ease;                    /* 所有屬性的過渡動畫 */
            font-family: 'Consolas', monospace;           /* 等寬字體，數字對齊更整齊 */
        }

        /* 利率輸入框的焦點效果（雖然是唯讀，但提供視覺回饋） */
        .rate-header-input:focus {
            outline: none;                                /* 移除預設的焦點外框 */
            border-color: var(--accent-color);            /* 邊框變為強調色 */
            box-shadow: 0 0 8px rgba(var(--accent-color-rgb), 0.4); /* 發光效果 */
        }

        /* header中的百分比符號樣式 - "%"符號的顯示樣式 */
        .rate-header-percent {
            font-size: 20px;                              /* 文字大小，與數值框匹配 */
            color: var(--text-color);                     /* 使用主題文字顏色 */
            margin-left: -10px;                           /* 左側負間距，讓%符號更靠近數字 */
            font-weight: bold;                            /* 粗體效果，與其他文字保持一致 */
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);   /* 文字陰影，增加立體感 */
        }

        /* 兩個利率顯示之間的分隔線樣式 - 佣後和稅佣後之間的視覺分隔 */
        .rate-header-separator {
            width: 35px;                                  /* 分隔線寬度，比footer稍寬 */
            height: 3px;                                  /* 分隔線高度，比footer稍高 */
            background: linear-gradient(90deg,             /* 漸變分隔線，增加視覺效果 */
                transparent,                              /* 左側透明 */
                var(--accent-color),                      /* 中間使用強調色 */
                transparent);                             /* 右側透明 */
            margin: 0 20px;                               /* 左右間距，為分隔線留出空間 */
            border-radius: 2px;                           /* 圓角效果，讓分隔線更柔和 */
            opacity: 0.8;                                 /* 透明度，讓分隔線不會太突兀 */
            animation: separatorPulse 3s infinite;        /* 脈動動畫，吸引注意力 */
        }

        /* 分隔線的脈動動畫定義 - 讓分隔線有呼吸般的效果 */
        @keyframes separatorPulse {
            0%, 100% {                                    /* 動畫開始和結束狀態 */
                opacity: 0.6;                             /* 較淡的透明度 */
                transform: scaleX(0.9);                   /* 水平方向稍微縮小 */
            }
            50% {                                         /* 動畫中間狀態 */
                opacity: 1;                               /* 完全不透明 */
                transform: scaleX(1);                     /* 正常大小 */
            }
        }

        /* 警告樣式 - 當利率數值有問題時的視覺提示 */
        .rate-header-input.warning-text {
            color: var(--error-color) !important;         /* 強制使用錯誤色文字（紅色） */
            background-color: rgba(var(--error-color-rgb), 0.15); /* 淡紅色背景提示 */
            border-color: var(--error-color) !important;  /* 紅色邊框 */
            animation: warningPulse 1s infinite;          /* 警告脈動動畫 */
            box-shadow: 0 0 10px rgba(var(--error-color-rgb), 0.3); /* 紅色發光效果 */
        }

        /* 警告狀態的脈動動畫定義 - 讓有問題的數值持續閃爍提醒 */
        @keyframes warningPulse {
            0%, 100% {                                    /* 動畫開始和結束狀態 */
                border-color: var(--error-color);         /* 紅色邊框 */
                box-shadow: 0 0 5px rgba(var(--error-color-rgb), 0.3); /* 較弱的發光 */
            }
            50% {                                         /* 動畫中間狀態 */
                border-color: var(--accent-color);        /* 邊框變為強調色 */
                box-shadow: 0 0 15px rgba(var(--error-color-rgb), 0.6); /* 較強的發光 */
            }
        }

        /* 響應式設計 - 針對不同螢幕大小的適配 */
        @media screen and (max-width: 360px) {
            /* 在較小的螢幕上調整header樣式 */
            .fixed-rate-header {
                padding: 10px 8px;                        /* 減少內邊距以節省空間 */
            }
            
            .rate-header-label {
                font-size: 18px;                          /* 減小標籤文字大小 */
                letter-spacing: 0.5px;                    /* 減少字母間距 */
            }
            
            .rate-header-input {
                width: 65px;                              /* 減小輸入框寬度 */
                font-size: 18px;                          /* 減小文字大小 */
                padding: 5px 6px;                         /* 減少內邊距 */
            }
            
            .rate-header-percent {
                font-size: 18px;                          /* 減小百分比符號大小 */
            }
            
            .rate-header-separator {
                width: 25px;                              /* 減小分隔線寬度 */
                margin: 0 15px;                           /* 減少左右間距 */
            }
        }

        /* 印刷樣式 - 如果頁面被印刷，確保header正確顯示 */
        @media print {
            .fixed-rate-header {
                position: relative !important;            /* 印刷時改為相對定位 */
                top: auto !important;                     /* 取消頂部固定 */
                box-shadow: none;                         /* 移除陰影效果 */
                animation: none;                          /* 移除動畫效果 */
            }
        }

        /* ============================================
        * 2. 基礎元素樣式
        * ============================================ */

        /* 基本頁面樣式 */
        html, body {
            width: 100%;                          /* 使用100%寬度 */
            max-width: 400px;                     /* 設定最大寬度 */
            margin: 0 auto;                       /* 居中顯示 */
            position: relative;                   /* 相對定位用於子元素絕對定位 */
            overflow-x: hidden;                   /* 防止水平滾動 */
            -webkit-text-size-adjust: 100%;       /* 確保字體大小不自動調整 */
            padding: 0 3px;                       /* 為頁面添加左右間距 */
            background-color: var(--primary-color); /* 使用主題背景色 */
            color: var(--text-color);             /* 使用主題文字色 */
            font-family: "Microsoft JhengHei", Arial, sans-serif; /* 設定字體 */
            box-sizing: border-box;               /* 盒模型計算包含邊框和內邊距 */

            padding-top: 70px;                       /* 為固定header預留空間 */

        }

        /* ============================================
        * 3. 佈局與容器
        * ============================================ */

        /* 行容器樣式 - 用於資料輸入區域 */
        .row {
            margin: 4px 0;
            display: flex;
            align-items: center;
            background: var(--secondary-color);
            padding: 3px;
            border-radius: 4px;
            box-shadow: 0 4px 8px var(--shadow-color);
            /* 移除 transition 以去除動畫效果 */
            position: relative;
            transform-origin: left;
            /* 移除 will-change 因為不再需要動畫優化 */
        }

        /* ============================================
        * 現代化可編輯欄位設計
        * ============================================ */

        /* 可編輯欄位的現代化設計 - 採用簡潔的左側邊框 + 微妙背景效果 */
        .editable-field {
            position: relative;                                    /* 相對定位，為內部元素提供定位基準 */
            border-left: 3px solid var(--accent-color);           /* 左側3像素寬的實心邊框，使用主題強調色 */
            background: linear-gradient(135deg,                    /* 135度角的漸變背景 */
                rgba(var(--accent-color-rgb), 0.03) 0%,           /* 起始：極淡的主題色（透明度3%） */
                rgba(var(--accent-color-rgb), 0.01) 100%);        /* 結束：更淡的主題色（透明度1%） */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);   /* 使用現代化的緩動函數，提供流暢的過渡效果 */
            box-shadow: 0 0 0 0 rgba(var(--accent-color-rgb), 0); /* 初始時無陰影，用於懸停動畫 */
        }

        /* 聚焦狀態 - 簡化版本 */
        .editable-field:focus-within {
            border-left-width: 4px;                /* 保留邊框加寬表示聚焦 */
            /* 已移除背景漸變、陰影和位移效果以提升效能 */
        }

        /* 確保內部元素保持正常的定位和顯示 */
        .editable-field .label,
        .editable-field input,
        .editable-field button,
        .editable-field .helper-text {
            position: relative;                                    /* 相對定位 */
            z-index: 1;                                           /* 確保在背景效果之上 */
        }

        /* ============================================
        * 響應式設計優化
        * ============================================ */

        /* 在較小的螢幕上減少動畫效果，提升性能 */
        @media (max-width: 480px) {
            .editable-field {
                transition: border-left-width 0.2s ease,          /* 只保留邊框變化動畫 */
                            background-color 0.2s ease;           /* 和背景色變化動畫 */
            }
            
            .editable-field:hover,
            .editable-field:focus-within {
                transform: none;                                   /* 在小螢幕上移除位移效果 */
            }
        }

        /* 針對觸控設備的優化 */
        @media (hover: none) and (pointer: coarse) {
            .editable-field:hover {
                /* 在觸控設備上移除懸停效果，因為觸控設備沒有真正的懸停狀態 */
                border-left-width: 3px;
                background: linear-gradient(135deg,                
                    rgba(var(--accent-color-rgb), 0.03) 0%,       
                    rgba(var(--accent-color-rgb), 0.01) 100%);
                box-shadow: none;
                transform: none;
            }
        }

        /* 標籤樣式 */
        .label {
            width: 120px;                        /* 固定寬度 */
            margin-right: 8px;                   /* 右側邊距 - 從15px減少到8px讓標籤更靠近輸入框 */
            text-align: right;                   /* 文字右對齊 */
            font-weight: normal;                 /* 字體粗細 - 改為正常粗細（不是粗體） */
            color: var(--text-color);            /* 文字顏色 */
            position: relative;                  /* 相對定位 */
            overflow: hidden;                    /* 隱藏溢出內容 */
            font-size: var(--label-font-size);   /* 使用變數控制字體大小 */
        }

        /* 輸入框與按鍵的視覺分組 */
        .input-button-group {
            border: 1px solid var(--border-color); /* 添加邊框 */
            border-radius: 8px;                    /* 圓角 */
            margin: 4px 0;                         /* 上下邊距 */
            padding: 1px;                          /* 內邊距 */
            background: var(--secondary-color);    /* 使用次背景色 */
            box-shadow: 0 4px 8px var(--shadow-color); /* 陰影效果 */
            position: relative;                     /* 相對定位 */
            overflow: hidden;                       /* 隱藏溢出內容 */
            transition: all 0.3s ease-in-out;       /* 過渡效果 */
        }

        /* 分組內的行容器 */
        .input-button-group .row {
            background: transparent;              /* 透明背景 */
            box-shadow: none;                     /* 移除陰影 */
            margin: 2px 0;                        /* 上下邊距 */
            padding-top: 1px;                     /* 上部內邊距 */
            padding-bottom: 1px;                  /* 下部內邊距 */
        }

        /* 按鍵容器樣式調整 - 已移除動畫效果 */
        .input-button-group div[id$="Buttons"] {
            margin: 0;
            padding-top: 0;
            padding-bottom: 2px;
            border-top: none;
            /* 確保沒有 transition 屬性 */
            max-height: 100px;
            opacity: 1;
        }
        
        /* 當滑鼠懸停在按鍵組上時的效果 */
        .input-button-group div[id$="Buttons"]:hover {
            background-color: rgba(255, 156, 51, 0.05); /* 添加淡橙色背景 */
            border-radius: 4px;                          /* 圓角 */
        }

        /* 隱藏狀態的按鈕組 */
        .input-button-group div[id$="Buttons"] {
            max-height: 0;                         /* 高度為0 */
            opacity: 0;                            /* 完全透明 */
            padding: 0;                            /* 移除內邊距 */
            margin: 0;                             /* 移除邊距 */
            overflow: hidden;                      /* 隱藏溢出內容 */
        }

        /* 時間顯示包裝容器 */
        .time-display-wrapper {
            position: relative;                    /* 相對定位 */
            height: auto;                          /* 自動高度 */
            margin: 3px 0;                         /* 上下邊距 */
            z-index: 1400;                         /* 層級，確保在header下方但高於其他內容 */
            margin-top: 5px;                       /* 減少頂部間距，因為header已經提供了足夠空間 */
        }

        /* 固定頂部的時間顯示 */
        .sticky-header {
            position: -webkit-sticky !important;   /* Safari支持 */
            position: sticky !important;           /* 黏性定位 */
            top: 65px;                                /* 設定在固定header下方 */
            background: var(--secondary-color);    /* 使用次背景色 */
            padding: 8px;                          /* 內邊距 */
            border-radius: 4px;                    /* 圓角 */
            box-shadow: 0 2px 4px var(--shadow-color); /* 陰影效果 */
            animation: fadeIn 0.8s ease-out;       /* 淡入動畫 */
            transition: all 0.3s ease;             /* 過渡效果 */
            z-index: 1400;                            /* 層級設定，低於header但高於其他內容 */
            width: calc(100% - 16px);              /* 寬度考慮內邊距 */
            margin: 0 auto;                        /* 居中 */
        }

        /* 固定狀態的樣式 */
        .sticky-header.is-sticky {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); /* 增強陰影 */
            border-radius: 0 0 4px 4px;              /* 只保留底部圓角 */
            transform: translateY(0);                 /* 重置Y軸位置 */
        }

        /* 時間顯示樣式 */
        #timeDisplay {
            margin: 3px 0;                          /* 上下邊距 */
            font-size: 15px;                        /* 字體大小 */
            background: var(--secondary-color);     /* 背景色 */
            color: var(--text-color);               /* 文字顏色 */
            padding: 8px;                           /* 內邊距 */
            border-radius: 4px;                     /* 圓角 */
            box-shadow: 0 2px 4px var(--shadow-color); /* 陰影 */
            animation: fadeIn 0.8s ease-out;        /* 淡入動畫 */
            transition: all 0.3s ease;              /* 過渡效果 */
            position: relative;                     /* 相對定位 */
            overflow: hidden;                       /* 隱藏溢出內容 */
        }

        /* 時間顯示頂部線條動畫 */
        #timeDisplay::before {
            content: '';                           /* 創建空內容 */
            position: absolute;                    /* 絕對定位 */
            top: 0;                                /* 貼齊頂部 */
            left: -100%;                           /* 初始位置在左外側 */
            width: 100%;                           /* 寬度100% */
            height: 2px;                           /* 高度2px */
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent); /* 漸變背景 */
            animation: timelineSlide 3s linear infinite; /* 滑動動畫 */
        }

        /* 時間線滑動動畫 */
        @keyframes timelineSlide {
            0% { left: -100%; }                   /* 開始時在左外側 */
            100% { left: 100%; }                  /* 結束時在右外側 */
        }

        /* 時間標籤樣式 */
        .time-label {
            font-weight: normal;                     /* 粗體 */
            margin-right: 8px;                    /* 右側邊距 */
            color: var(--accent-color);            /* 使用強調色 */
        }

        /* 淡入動畫 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); } /* 開始時透明且下移 */
            to { opacity: 1; transform: translateY(0); }      /* 結束時不透明且回到原位 */
        }

        /* 1. 流光分隔線 */
        .divider-flow {
            position: relative;                    /* 相對定位 */
            height: 2px;                           /* 高度2px */
            background: linear-gradient(90deg, 
                var(--secondary-color) 0%,
                var(--accent-color) 50%,
                var(--secondary-color) 100%);      /* 漸變背景 */
            margin: 4px 0;                         /* 上下邊距 */
            overflow: hidden;                      /* 隱藏溢出內容 */
            animation: dividerFadeIn 0.5s ease-out; /* 淡入動畫 */
        }

        /* 分隔線流光效果 */
        .divider-flow::after {
            content: '';                           /* 創建空內容 */
            position: absolute;                    /* 絕對定位 */
            top: 0;                                /* 貼齊頂部 */
            left: -100%;                           /* 初始位置在左外側 */
            width: 100%;                           /* 寬度100% */
            height: 100%;                          /* 高度100% */
            background: linear-gradient(90deg,
                transparent,
                var(--accent-color),
                transparent);                      /* 漸變背景 */
            animation: flowLight 3s ease-in-out infinite; /* 流光動畫 */
        }

        /* 流光動畫 */
        @keyframes flowLight {
            0% { transform: translateX(0); }       /* 開始位置 */
            100% { transform: translateX(200%); }  /* 結束位置 */
        }

        /* 分隔線淡入動畫 */
        @keyframes dividerFadeIn {
            from {
                opacity: 0;                        /* 開始時透明 */
                transform: scaleX(0.8);            /* 開始時寬度為80% */
            }
            to {
                opacity: 1;                        /* 結束時不透明 */
                transform: scaleX(1);              /* 結束時寬度為100% */
            }
        }

        /* 輔助說明文字樣式 - 用於欄位右側的說明文字 */
        .helper-text {
            margin-left: 0px;                    /* 左側邊距 */
            color: var(--helper-text-color);     /* 使用變數控制文字顏色 */
            font-size: 16px;                     /* 保持原始字體大小 */
        }

        /* 強調重要欄位 */
        .emphasized-row {
            border-left: 3px solid var(--accent-color); /* 左側邊框 */
            background: linear-gradient(90deg, var(--accent-color-light), transparent); /* 漸變背景 */
            transform: scale(1.01);                /* 稍微放大 */
            transition: all 0.3s ease;             /* 過渡效果 */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* 陰影效果 */
        }

        /* 強調欄位標籤 */
        .emphasized-row .label {
            color: var(--accent-color);           /* 使用強調色 */
            font-weight: 700;                     /* 粗體 */
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); /* 文字陰影 */
        }

        /* 強調欄位輸入框 */
        .emphasized-row input {
            font-weight: bold;                    /* 粗體 */
            color: #ffffff;                       /* 白色文字 */
            font-size: 17px;                      /* 字體大小 */
            border-color: var(--accent-color);    /* 使用強調色邊框 */
        }

        /* 修正精簡顯示模式下的間距問題 */
        /* 當分隔線被隱藏時，確保不佔用任何空間 */
        .divider-flow.hidden-element {
            display: none !important;     /* 完全不顯示 */
            margin: 0 !important;         /* 移除所有邊距 */
            padding: 0 !important;        /* 移除所有內距 */
            height: 0 !important;         /* 高度設為0 */
        }

        /* 確保行與行之間的間距一致 */
        .row + .row {
            margin-top: 4px;              /* 統一行與行之間的間距 */
        }

        /* 當分隔線被隱藏時，下一個元素不需要額外的頂部間距 */
        .divider-flow + .row {
            margin-top: 4px !important;   /* 保持與其他行相同的間距 */
        }

        /* 頁腳訊息 */
        .footer-message {
            background-color: var(--primary-color); /* 使用主背景色 */
            color: var(--text-color);              /* 使用文字色 */
            padding: 15px;                         /* 內邊距 */
            text-align: center;                    /* 文字居中 */
            margin-top: 10px;                      /* 頂部邊距 */
            border-radius: 4px;                    /* 圓角 */
            transform: scale(1.05);                /* 稍微放大 */
            text-shadow: 0 0 10px var(--accent-color); /* 文字陰影 */
            transition: all 0.3s ease;              /* 過渡效果 */
            position: relative;                     /* 相對定位 */
        }

        /* 頁腳訊息前的emoji */
        .footer-message::before {
            content: '🍚';                         /* 顯示飯emoji */
            margin-right: 8px;                     /* 右側邊距 */
            display: inline-block;                 /* 行內塊顯示 */
            transition: transform 0.3s ease;        /* 過渡效果 */
        }

        /* 頁腳訊息懸停時emoji旋轉效果 */
        .footer-message:hover::before {
            transform: rotate(360deg);             /* 旋轉360度 */
        }

        /* 頁腳間距 */
        .footer-spacing {
            background-color: var(--primary-color); /* 使用主背景色 */
            height: 50px;                          /* 高度 */
            margin-top: 0px;                       /* 頂部邊距 */
        }

        /* ============================================
        * 4. 輸入元素與表單
        * ============================================ */

        /* 輸入框基本樣式 */
        input {
            width: 95px;                           /* 固定寬度 */
            padding: 5px var(--input-padding-lr);  /* 內邊距 - 使用變數控制左右間距 */
            margin-right: 10px;                    /* 右側邊距 */
            background-color: var(--input-bg);     /* 使用主題輸入框背景色 */
            color: var(--text-color);              /* 使用主題文字色 */
            border: 1px solid var(--border-color); /* 邊框 */
            border-radius: 4px;                    /* 圓角 */
            font-size: var(--input-font-size);     /* 使用變數控制字體大小 */
            transition: all 0.3s ease;             /* 過渡效果 */
            text-align: right;                     /* 文字靠右對齊 */
        }

        /* 輸入框聚焦效果 - 簡化版本 */
        input:focus {
            outline: none;                         /* 移除預設焦點外框 */
            border-color: var(--accent-color);     /* 保留強調色邊框以表示聚焦狀態 */
            /* 已移除 box-shadow 和 transform 以提升效能 */
        }

        /* 只讀輸入框樣式 */
        .readonly {
            background-color: var(--input-bg);     /* 使用主題輸入框背景色 */
            animation: breathe 4s ease-in-out infinite; /* 呼吸動畫 */
        }

        /* 值變化動畫 */
        .value-changed {
            animation: valueChange 0.5s ease-out;  /* 值變化動畫 */
            will-change: background-color;         /* 優化渲染性能 */
        }

        /* 值變化動畫 - 背景色和大小變化 */
        @keyframes valueChange {
            0% { 
                background-color: var(--accent-color-light); /* 初始用強調色 */
                transform: scale(1.02);            /* 稍微放大 */
            }
            100% { 
                background-color: transparent;     /* 恢復透明背景 */
                transform: scale(1);               /* 恢復原始大小 */
            }
        }

        /* 警告文字樣式 */
        .warning-text {
            color: var(--error-color) !important;    /* 使用錯誤色 */
            font-weight: bold !important;            /* 粗體 */
            animation: pulse 1s infinite, shake 0.5s ease-in-out; /* 脈動和震動動畫 */
            will-change: transform;                  /* 優化渲染性能 */
        }

        /* 震動動畫 */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }   /* 開始和結束位置 */
            20%, 60% { transform: translateX(-1px); } /* 向左移動 */
            40%, 80% { transform: translateX(1px); }  /* 向右移動 */
        }

        /* 脈動動畫 - 定義元素的透明度和縮放變化 */
        @keyframes pulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }   /* 開始和結束狀態：輕微透明和原始大小 */
            50% { opacity: 1; transform: scale(1.1); }        /* 中間狀態：完全不透明和放大10% */
        }

        /* 按鈕基本樣式 - 所有基本按鈕的共同樣式 */
        button {
            background-color: var(--secondary-color);    /* 使用次要背景色 */
            color: var(--text-color);                   /* 使用主要文字顏色 */
            border: 1px solid var(--border-color);      /* 使用標準邊框色 */
            padding: 3px 8px;                          /* 內部間距 */
            margin: 0 5px;                             /* 左右外部間距 */
            border-radius: 4px;                        /* 圓角效果 */
            cursor: pointer;                           /* 滑鼠指標變為手型 */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* 平滑過渡效果 */
            font-size: 16px;                           /* 文字大小 */
        }

        /* 按鈕懸停效果 - 簡化版本 */
        button:hover {
            background-color: var(--hover-color);      /* 保留顏色變化表示可點擊 */
            /* 已移除 transform 和 box-shadow 以提升效能 */
        }

        /* 按鈕點擊效果 - 點擊按鈕時的視覺反饋 */
        button:active {
            transform: scale(0.95) translateY(1px);    /* 縮小並輕微下移 */
            transition: transform 0.1s;                /* 僅對變形應用快速過渡 */
        }

        /* 行容器中的按鈕樣式 - 調整在行容器內的按鈕外觀 */
        .row button {
            background-color: var(--secondary-color);   /* 使用次要背景色 */
            color: #888888;                            /* 使用暗灰色文字 */
            border: 1px solid #444444;                /* 深色邊框 */
            padding: 3px 8px;                         /* 內部間距 */
            margin: 0 5px;                            /* 左右外部間距 */
            border-radius: 4px;                       /* 圓角效果 */
            cursor: pointer;                          /* 滑鼠指標變為手型 */
            transition: all 0.3s ease;                /* 平滑過渡效果 */
            font-size: 15px;                          /* 文字大小 */
            opacity: 0.8;                             /* 輕微透明效果 */
        }

        /* 特定按鈕組內按鈕的樣式 - 統一各種類型按鈕的顯示 */
        #periodButtons button, 
        #rateButtons button, 
        #principalButtons button, 
        #commissionButtons button, 
        #PaymentduringButtons button,
        #commissionPercentButtons button {
            min-width: 50px;       /* 最小寬度 */
            text-align: center;    /* 文字居中 */
            flex: 1;               /* 平均分配空間 */
            max-width: 80px;       /* 最大寬度限制 */
            margin: 0 2px;         /* 左右外部間距 */
            height: 28px;          /* 固定高度 */
            padding: 0 5px;        /* 內部間距 */
            display: flex;         /* 使用彈性布局 */
            align-items: center;   /* 垂直居中 */
            justify-content: center; /* 水平居中 */
            white-space: nowrap;   /* 防止文字換行 */
            overflow: hidden;      /* 隱藏溢出內容 */
            text-overflow: ellipsis; /* 文字溢出時顯示省略號 */
        }

        /* 針對按鈕數量多的兩個組別進行特殊調整 - 確保布局美觀 */
        #periodButtons button, 
        #rateButtons button {
            min-width: 35px;      /* 減小最小寬度 */
            max-width: 50px;      /* 減小最大寬度 */
            padding: 0 3px;       /* 減小內部間距 */
            font-size: 15px;      /* 稍微減小字體大小 */
        }

        /* 減小這兩個按鈕組的按鈕間距 - 使更多按鈕能適應寬度 */
        #periodButtons, 
        #rateButtons {
            gap: 2px;             /* 減小按鈕之間的間距 */
        }

        /* 行容器中按鈕的懸停效果 - 提供視覺反饋 */
        .row button:hover {
            background-color: #4a4a4a; /* 稍微亮一點的灰色 */
            color: #cccccc;           /* 亮一點的文字顏色 */
            border-color: #555555;    /* 亮一點的邊框顏色 */
            opacity: 0.9;             /* 提高不透明度 */
        }

        /* 行容器中按鈕的點擊效果 - 點擊時的視覺反饋 */
        .row button:active {
            background-color: var(--secondary-color);  /* 恢復原本背景顏色 */
            color: var(--text-color);                 /* 恢復原本文字顏色 */
            border-color: var(--button-grey);         /* 使用灰色按鈕邊框 */
        }

        /* 行容器中按鈕點擊後的波紋效果 - 創建點擊漣漪效果 */
        .row button::after {
            content: '';                             /* 創建空內容 */
            position: absolute;                      /* 絕對定位 */
            top: 50%;                               /* 從中間開始 */
            left: 50%;                              /* 從中間開始 */
            width: 0;                               /* 初始寬度為0 */
            height: 0;                              /* 初始高度為0 */
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%); /* 漸變背景 */
            transition: width 0.3s ease-out, height 0.3s ease-out; /* 平滑過渡效果 */
            transform: translate(-50%, -50%);       /* 確保居中 */
            border-radius: 50%;                     /* 圓形效果 */
        }

        /* 行容器中按鈕點擊時的波紋動畫 - 擴展漣漪效果 */
        .row button:active::after {
            width: 150px;                          /* 擴展寬度 */
            height: 150px;                         /* 擴展高度 */
        }

        /* 將組內的按鍵輕微突出顯示 - 增加視覺層次感 */
        .input-button-group div[id$="Buttons"] button {
            position: relative;                    /* 相對定位 */
            z-index: 2;                           /* 提高層級 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15); /* 輕微陰影 */
        }

        /* 改進按鍵點擊反饋 - 提供更明顯的點擊視覺效果 */
        .input-button-group div[id$="Buttons"] button:active {
            transform: scale(0.95);               /* 縮小效果 */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); /* 減小陰影 */
            transition: transform 0.1s, box-shadow 0.1s; /* 快速過渡效果 */
        }

        /* 添加輕微的懸停效果 - 鼠標懸停時的邊框變化 */
        .input-button-group div[id$="Buttons"] button:hover {
            border-color: var(--button-orange);   /* 使用橙色邊框 */
        }

        /* 特定ID結尾的按鈕組樣式 - 為這些按鈕組設置統一樣式 */
        div[id$="Buttons"] button {
            background-color: var(--secondary-color); /* 使用次要背景色 */
            color: #bcbcbc;                         /* 亮灰色文字 */
            border: 1px solid var(--button-orange);  /* 使用橙色外框 */
            padding: 4px 9px;                       /* 內部間距 */
            margin: 0 4px;                          /* 左右外部間距 */
            border-radius: 4px;                     /* 圓角效果 */
            cursor: pointer;                        /* 滑鼠指標變為手型 */
            transition: all 0.3s ease;              /* 平滑過渡效果 */
            font-size: 15px;                        /* 文字大小 */
            opacity: 0.95;                          /* 較高不透明度 */
        }

        /* 特定ID結尾的按鈕組懸停效果 - 鼠標懸停時的視覺變化 */
        div[id$="Buttons"] button:hover {
            background-color: rgba(255, 156, 51, 0.15); /* 淡橘色背景 */
            color: #ffffff;                           /* 白色文字 */
            border-color: var(--button-orange);       /* 橙色邊框 */
            transform: translateY(-1px);              /* 輕微上移 */
            box-shadow: 0 2px 4px rgba(255, 156, 51, 0.2); /* 橙色陰影 */
        }

        /* 特定ID結尾的按鈕組點擊效果 - 點擊時的視覺反饋 */
        div[id$="Buttons"] button:active {
            transform: translateY(1px);              /* 輕微下移 */
            background-color: rgba(255, 156, 51, 0.3); /* 較深橙色背景 */
            box-shadow: 0 0 5px rgba(255, 156, 51, 0.5) inset; /* 內陰影效果 */
            transition: all 0.1s ease;               /* 快速過渡效果 */
        }

        /* 添加滚动时的效果 - 頭部固定區域樣式 */
        .sticky-header.is-sticky {
            border-radius: 0 0 4px 4px;              /* 底部圓角 */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); /* 增強陰影 */
            transform: translateY(0);                /* 重置Y軸位置 */
        }

        /* 各種按鈕組的布局 - 創建彈性布局容器 */
        #periodButtons, #rateButtons, #principalButtons, #commissionButtons, #PaymentduringButtons, #commissionPercentButtons {
            margin: 0;                              /* 移除外部間距 */
            display: flex;                          /* 使用彈性布局 */
            flex-wrap: wrap;                        /* 允許換行 */
            gap: 3px;                               /* 項目間距 */
            width: 100%;                            /* 占滿容器寬度 */
            justify-content: center;                /* 水平居中 */
            padding: 0 5px;                         /* 左右內部間距 */
            box-sizing: border-box;                 /* 盒模型計算方式 */
            min-height: 32px;                       /* 最小高度 */
            align-items: center;                    /* 垂直居中 */
        }

        /* 按鈕基本特性 - 防止按鈕在彈性布局中被拉伸 */
        button {
            flex-shrink: 0;                         /* 禁止按鈕縮小 */
        }

        /* 新的按鈕組樣式 - 功能按鈕組的容器 */
        .function-buttons {
            display: flex;                          /* 使用彈性布局 */
            flex-direction: column;                 /* 垂直排列 */
            gap: 4px;                               /* 項目間距 */
            margin: 4px 0;                          /* 上下外部間距 */
            padding: 0;                             /* 移除內部間距 */
            width: 100%;                            /* 占滿容器寬度 */
        }

        /* 功能按鈕行容器 - 水平排列的按鈕 */
        .function-buttons .button-row {
            display: flex;                          /* 使用彈性布局 */
            justify-content: space-between;         /* 兩端對齊 */
            gap: 4px;                               /* 減小按鈕間距 */
            width: 100%;                            /* 占滿容器寬度 */
        }

        /* 調整頂部按鈕組 - 頂部功能按鈕的布局 */
        .top-buttons .button-row button {
            flex: 1;                                /* 平均分配空間 */
            min-width: 0;                           /* 允許按鈕變窄 */
        }

        /* 調整底部按鈕組 - 底部功能按鈕的布局 */
        .bottom-buttons .button-row button {
            flex: 1;                                /* 平均分配空間 */
            min-width: 0;                           /* 允許按鈕變窄 */
        }

        /* 功能按鈕上下行樣式 - 確保統一布局 */
        .function-buttons .top-row,
        .function-buttons .bottom-row {
            display: flex;                          /* 使用彈性布局 */
            justify-content: space-between;         /* 兩端對齊 */
            gap: 10px;                              /* 項目間距 */
        }

        /* 頂部行按鈕樣式 - 確保按鈕平均分布 */
        .function-buttons .top-row button {
            flex: 1;                                /* 平均分配空間 */
            min-width: 0;                           /* 允許按鈕變窄 */
            margin: 0;                              /* 移除外部間距 */
        }

        /* 底部行按鈕樣式 - 確保按鈕平均分布 */
        .function-buttons .bottom-row button {
            flex: 1;                                /* 平均分配空間 */
            min-width: 0;                           /* 允許按鈕變窄 */
            margin: 0;                              /* 移除外部間距 */
        }

        /* 統一所有功能按鈕的基礎樣式 - 創建視覺一致的按鈕 */
        .function-buttons button {
            background-color: var(--secondary-color); /* 使用次要背景色 */
            color: #ffffff;                         /* 白色文字 */
            border: 1px solid var(--button-orange);  /* 橙色邊框 */
            border-radius: 6px;                     /* 圓角效果 */
            padding: 8px 0;                         /* 上下內部間距 */
            font-size: 16px;                        /* 文字大小 */
            font-weight: 600;                       /* 文字粗細 */
            cursor: pointer;                        /* 滑鼠指標變為手型 */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* 平滑過渡效果 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* 陰影效果 */
            text-align: center;                     /* 文字居中 */
            position: relative;                     /* 相對定位 */
            overflow: hidden;                      /* 隱藏溢出內容 */
            flex: 1;                                /* 平均分配空間 */
            min-width: 0;                           /* 允許按鈕變窄 */
            margin: 0;                              /* 移除外部間距 */
        }

        /* 功能按鈕偽元素 - 創建懸停時的漸變效果 */
        .function-buttons button::before {
            content: '';                            /* 創建空內容 */
            position: absolute;                     /* 絕對定位 */
            top: 0;                                /* 從頂部開始 */
            left: 0;                               /* 從左側開始 */
            width: 100%;                           /* 寬度100% */
            height: 100%;                          /* 高度100% */
            background: linear-gradient(to right, rgba(255, 156, 51, 0.1), transparent); /* 漸變背景 */
            z-index: -1;                           /* 置於按鈕下層 */
            transform: translateX(-100%);          /* 初始位置在左側外 */
            transition: transform 0.6s ease;       /* 平滑過渡效果 */
        }

        /* 統一所有按鈕的懸停效果 - 鼠標懸停時的視覺變化 */
        .function-buttons button:hover {
            background-color: var(--button-orange); /* 橙色背景 */
            color: #ffffff;                        /* 白色文字 */
            transform: translateY(-2px);           /* 上移效果 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* 增強陰影 */
        }

        /* 功能按鈕懸停時偽元素效果 - 顯示滑入效果 */
        .function-buttons button:hover::before {
            transform: translateX(0);              /* 滑入至可見區域 */
        }

        /* 統一所有按鈕的點擊效果 - 按下時的視覺反饋 */
        .function-buttons button:active {
            transform: translateY(1px);            /* 下移效果 */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); /* 減弱陰影 */
            transition: all 0.1s;                  /* 快速過渡效果 */
        }

        /* 主要操作按鈕樣式 - 與一般功能按鈕一致 */
        .function-buttons .main-action-btn {
            background-color: var(--secondary-color); /* 使用次要背景色 */
            color: #ffffff;                        /* 白色文字 */
            padding: 8px 0;                        /* 上下內部間距 */
            border: 1px solid var(--button-orange); /* 橙色邊框 */
        }

        /* 主要操作按鈕偽元素 - 降低漸變亮度 */
        .function-buttons .main-action-btn::before {
            background: linear-gradient(to right, rgba(255, 255, 255, 0.05), transparent); /* 較淡的漸變 */
        }

        /* 主要操作按鈕懸停效果 - 更明顯的懸停樣式 */
        .function-buttons .main-action-btn:hover {
            background-color: var(--button-orange); /* 橙色背景 */
            box-shadow: 0 7px 14px rgba(255, 156, 51, 0.4); /* 橙色陰影 */
            transform: translateY(-3px);           /* 更明顯的上移 */
        }

        /* 主要操作按鈕點擊效果 - 按下時的視覺反饋 */
        .function-buttons .main-action-btn:active {
            transform: translateY(1px);            /* 下移效果 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 輕微陰影 */
        }

        /* 報價表格樣式 - 顯示計算結果的表格 */
        .quote-table {
            width: 100%;                           /* 占滿容器寬度 */
            border-collapse: separate;             /* 分離邊框模型 */
            border-spacing: 0;                     /* 單元格間距 */
            margin: 10px 0;                        /* 上下外部間距 */
            background: var(--primary-color);      /* 使用主背景色 */
            border-radius: 12px;                   /* 圓角效果 */
            overflow: hidden;                      /* 隱藏溢出內容 */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4); /* 深色陰影 */
        }

        /* 報價表格行樣式 - 表格行的背景與過渡效果 */
        .quote-table tr {
            background: var(--secondary-color);    /* 使用次要背景色 */
            transition: background-color 0.3s ease; /* 背景色過渡效果 */
        }

        /* 報價表格行懸停效果 - 鼠標懸停時的背景變化 */
        .quote-table tr:hover {
            background: var(--hover-color);        /* 使用懸停背景色 */
        }

        /* 報價表格單元格樣式 - 調整單元格內部間距與外觀 */
        .quote-table td {
            padding: 10px 10px;                    /* 內部間距 */
            border-bottom: 1px solid var(--border-color); /* 底部邊框 */
            color: var(--text-color);              /* 使用文字顏色 */
            font-size: 16px;                       /* 文字大小 */
            line-height: 1.2;                      /* 行高 */
        }

        /* 報價表格第一列單元格樣式 - 標籤列的格式 */
        .quote-table td:first-child {
            width: 140px;                          /* 固定寬度 */
            white-space: nowrap;                   /* 禁止換行 */
            color: var(--button-orange);           /* 橙色文字 */
            font-weight: 700;                      /* 文字粗細 */
            text-align: right;                     /* 文字右對齊 */
            padding-right: 10px;                   /* 右側內部間距 */
            font-size: 16px;                       /* 文字大小 */
        }

        /* 報價表格最後一列單元格樣式 - 數值列的格式 */
        .quote-table td:last-child {
            text-align: right;                     /* 文字右對齊 */
            font-family: monospace;                /* 等寬字體 */
            font-size: 16px;                       /* 文字大小 */
            letter-spacing: 0px;                   /* 字符間距 */
        }

        /* 報價容器樣式 - 包含報價表格的容器 */
        #quoteContainer {
            padding: 24px;                         /* 內部間距 */
            background: #333333;                   /* 深灰背景 */
            border-radius: 16px;                   /* 圓角效果 */
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5); /* 深色陰影 */
            margin: 20px;                          /* 外部間距 */
        }

        /* 功能按鈕偽元素 - 創建發光邊框效果 */
        .function-buttons button::before {
            content: '';                           /* 創建空內容 */
            position: absolute;                    /* 絕對定位 */
            top: -2px;                            /* 向上延伸 */
            left: -2px;                           /* 向左延伸 */
            right: -2px;                          /* 向右延伸 */
            bottom: -2px;                         /* 向下延伸 */
            background: var(--button-orange);      /* 橙色背景 */
            z-index: -1;                          /* 置於按鈕下層 */
            border-radius: 6px;                   /* 圓角效果 */
            opacity: 0;                           /* 初始透明 */
            transition: opacity 0.3s;             /* 透明度過渡效果 */
        }

        /* 功能按鈕懸停時偽元素效果 - 顯示脈動發光 */
        .function-buttons button:hover::before {
            opacity: 0.2;                         /* 半透明效果 */
            animation: pulseGlow 1.5s infinite;   /* 脈動發光動畫 */
        }

        /* 脈動發光動畫 - 定義按鈕背景的脈動效果 */
        @keyframes pulseGlow {
            0% { transform: scale(1); opacity: 0.2; }     /* 初始狀態 */
            50% { transform: scale(1.05); opacity: 0.3; } /* 放大並增加不透明度 */
            100% { transform: scale(1); opacity: 0.2; }   /* 返回初始狀態 */
        }

        /* 功能按鈕點擊後效果 - 創建點擊波紋效果 */
        .function-buttons button::after {
            content: '';                          /* 創建空內容 */
            position: absolute;                   /* 絕對定位 */
            top: 50%;                            /* 從中心開始 */
            left: 50%;                           /* 從中心開始 */
            width: 100%;                         /* 初始寬度 */
            height: 100%;                        /* 初始高度 */
            background: rgba(255, 255, 255, 0.1); /* 白色半透明背景 */
            transform: translate(-50%, -50%) scale(0); /* 初始縮放為0 */
            border-radius: 50%;                  /* 圓形效果 */
            transition: transform 0.5s;          /* 變形過渡效果 */
        }

        /* 功能按鈕懸停效果 - 改變按鈕顏色和文字 */
        .function-buttons button:hover {
            background-color: var(--button-orange); /* 橙色背景 */
            color: var(--text-color);               /* 使用主要文字顏色 */
            border-color: var(--button-orange);     /* 橙色邊框 */
        }

        /* 功能按鈕懸停時後效果的動畫 - 擴大波紋效果 */
        .function-buttons button:hover::after {
            transform: translate(-50%, -50%) scale(2); /* 放大波紋至2倍 */
        }

        /* 功能按鈕點擊效果 - 點擊時的顏色變化 */
        .function-buttons button:active {
            background-color: var(--secondary-color); /* 恢復次要背景色 */
            color: var(--button-orange);             /* 橙色文字 */
            border-color: var(--button-orange);      /* 橙色邊框 */
        }

        /* 發光邊框動畫 - 創建脈動的發光邊框效果 */
        @keyframes glowBorder {
            0%, 100% { box-shadow: 0 0 5px var(--accent-color); }        /* 初始和結束狀態的陰影 */
            50% { box-shadow: 0 0 15px var(--accent-color), 0 0 30px rgba(var(--accent-color-rgb), 0.3); } /* 中間狀態的增強陰影 */
        }

        /* 發光效果動畫 - 控制分隔線中的流光效果 */
        @keyframes dividerGlow {
            0% {
                left: -100%;      /* 開始在左側外部 */
            }
            50% {
                left: 100%;       /* 中間移動到右側 */
            }
            100% {
                left: 100%;       /* 結束於右側 */
            }
        }

        /* 歷史記錄面板樣式 - 顯示保存的貸款記錄 */
        .history-panel {
            display: none;                                        /* 初始隱藏 */
            position: fixed;                                      /* 固定定位 */
            top: 0;                                              /* 貼齊頂部 */
            left: 0;                                             /* 貼齊左側 */
            width: 100%;                                         /* 寬度100% */
            height: 100%;                                        /* 高度100% */
            background-color: rgba(var(--primary-color-rgb), 0.95); /* 半透明背景 */
            z-index: 1200;                                       /* 提高層級，高於header */
            overflow-y: auto;                                    /* 垂直滾動 */
            animation: fadeIn 0.3s ease-out;                     /* 淡入動畫 */
            padding-top: 0;                                      /* 移除頂部內邊距 */
        }

        /* 歷史記錄面板頭部樣式 - 包含標題和按鈕的頂部區域 */
        .history-header {
            display: flex;                                       /* 彈性布局 */
            justify-content: space-between;                      /* 兩端對齊 */
            align-items: center;                                 /* 垂直居中 */
            padding: 15px;                                       /* 內部間距 */
            background-color: var(--primary-color);              /* 主背景色 */
            position: sticky;                                    /* 粘性定位 */
            top: 0;                                             /* 貼齊頂部 */
            z-index: 1201;                                      /* 提高層級 */
            border-bottom: 2px solid var(--accent-color);        /* 底部邊框 */
            box-shadow: 0 2px 10px var(--shadow_color);          /* 陰影效果 */
            margin-top: 0;                                       /* 確保貼齊頂部 */
        }

        /* 歷史記錄面板頭部左側區域 - 用於標題 */
        .header-left {
            flex: 1;                                            /* 佔用剩餘空間 */
        }

        /* 歷史記錄面板頭部右側區域 - 用於功能按鈕 */
        .header-right {
            margin-right: 10px;                                 /* 右側外部間距 */
        }

        /* 歷史記錄面板標題樣式 - 頂部標題文字 */
        .history-header h2 {
            margin: 0;                                          /* 移除外部間距 */
            color: var(--accent-color);                         /* 強調色文字 */
            font-size: 20px;                                    /* 文字大小 */
            text-shadow: 0 1px 2px var(--shadow-color);         /* 文字陰影 */
        }

        /* 關閉按鈕樣式 - 用於關閉模態框 */
        .close-btn {
            background: none;                                   /* 無背景 */
            border: none;                                       /* 無邊框 */
            color: var(--text-color);                           /* 文字顏色 */
            font-size: 28px;                                    /* 文字大小 */
            cursor: pointer;                                    /* 滑鼠指標變為手型 */
            transition: color 0.3s ease;                        /* 只過渡顏色 */
            padding: 0;                                         /* 移除內部間距 */
            margin-left: 10px;                                  /* 左側外部間距 */
            line-height: 1;                                     /* 行高設為1 */
            width: auto;                                        /* 自動寬度 */
            height: auto;                                       /* 自動高度 */
        }

        /* 關閉按鈕懸停效果 - 鼠標懸停時的視覺變化 */
        .close-btn:hover {
            color: var(--accent-color);                         /* 強調色文字 */
        }

        /* 歷史記錄內容區域 - 顯示歷史記錄列表的容器 */
        .history-content {
            padding: 8px;                                       /* 內部間距 */
            max-width: 400px;                                   /* 最大寬度 */
            margin: 0 auto;                                     /* 水平居中 */
            padding-top: 20px;                                  /* 增加頂部間距 */
        }

        /* 歷史記錄列表樣式 - 所有歷史記錄項目的容器 */
        .history-list {
            display: flex;                                      /* 彈性布局 */
            flex-direction: column;                             /* 垂直排列 */
            gap: 10px;                                          /* 項目間距 */
            padding: 3px;                                       /* 內部間距 */
            margin-bottom: 10px;                                /* 底部外部間距 */
        }

        /* 歷史記錄項目樣式 - 單個歷史記錄的卡片 */
        .history-item {
            background-color: var(--secondary-color);           /* 次要背景色 */
            padding: 8px;                                       /* 內部間距 */
            border-radius: 8px;                                 /* 圓角效果 */
            position: relative;                                 /* 相對定位 */
            transition: all 0.3s ease;                          /* 過渡效果 */
            border-left: 3px solid var(--accent-color);         /* 左側邊框 */
            display: flex;                                      /* 彈性布局 */
            flex-direction: column;                             /* 垂直排列 */
            gap: 6px;                                           /* 項目間距 */
            box-shadow: 0 2px 4px var(--shadow-color);          /* 陰影效果 */
            margin-bottom: 10px;                                /* 底部外部間距 */
        }

        /* 歷史記錄項目懸停效果 - 移除右移效果 */
        .history-item:hover {
            /* transform: translateX(5px); 已移除右移效果 */
            box-shadow: 0 5px 15px var(--shadow-color);         /* 增強陰影 */
        }

        /* 歷史記錄項目頭部區域 - 顯示日期和稅佣後利率 */
        .history-item-header {
            display: flex;                                      /* 彈性布局 */
            justify-content: space-between;                     /* 兩端對齊 */
            align-items: center;                                /* 垂直居中 */
            width: 100%;                                        /* 寬度100% */
            padding-bottom: 2px;                                /* 底部內部間距 */
        }

        /* 歷史記錄日期樣式 - 顯示記錄保存的日期 */
        .history-date {
            font-weight: normal;                                  /* 文字粗細 */
            color: var(--accent-color);                         /* 強調色文字 */
            font-size: 14px;                                    /* 文字大小 */
            padding: 2px 0;                                     /* 上下內部間距 */
            margin-left: 5px;                                   /* 添加左側間距，進一步分隔勾選框和日期 */
        }

        /* 稅佣後利率樣式 - 在歷史記錄頭部顯示的利率 */
        .history-header-rate {
            font-weight: bold;                                  /* 文字粗細 */
            color: var(--text-color);                           /* 文字顏色 */
            font-size: 16px;                                    /* 文字大小 */
            background-color: var(--accent-color-light);        /* 淡色強調背景 */
            padding: 2px 6px;                                   /* 內部間距 */
            border-radius: 4px;                                 /* 圓角效果 */
        }

        /* 歷史詳情顯示區 - 顯示貸款參數的網格布局 */
        .history-details {
            display: grid;                                      /* 網格布局 */
            grid-template-columns: repeat(2, 1fr);              /* 兩列等寬 */
            gap: 6px;                                           /* 網格間距 */
            background-color: rgba(var(--primary-color-rgb), 0.15); /* 半透明背景 */
            padding: 6px;                                       /* 內部間距 */
            border-radius: 4px;                                 /* 圓角效果 */
        }

        /* 歷史詳情項目樣式 - 單個參數的顯示 */
        .history-detail-item {
            display: flex;                                      /* 彈性布局 */
            flex-direction: column;                             /* 垂直排列 */
            gap: 1px;                                           /* 項目間距 */
        }

        /* 詳情標籤樣式 - 參數名稱的顯示 */
        .detail-label {
            font-size: 12px;                                    /* 文字大小 */
            color: var(--text-muted);                           /* 淡色文字 */
        }

        /* 詳情數值樣式 - 參數值的顯示 */
        .detail-value {
            font-size: 18px;                                    /* 文字大小 */
            font-weight: bold;                                  /* 文字粗細 */
            color: var(--text-color);                           /* 文字顏色 */
            line-height: 1.2;                                   /* 行高 */
        }

        /* 移動設備適配 - 調整小屏幕下的顯示效果 */
        @media screen and (max-width: 360px) {
            .history-item {
                padding: 6px;                                   /* 減少內部間距 */
                gap: 4px;                                       /* 減少項目間距 */
            }
            
            .history-header-rate {
                font-size: 13px;                                /* 減小文字大小 */
                padding: 2px 5px;                               /* 減少內部間距 */
            }
            
            .history-date {
                font-size: 13px;                                /* 減小文字大小 */
            }
            
            .detail-value {
                font-size: 15px;                                /* 減小文字大小 */
            }
            
            .history-details {
                padding: 5px;                                   /* 減少內部間距 */
                gap: 5px;                                       /* 減少網格間距 */
            }
            
            .delete-btn, .detail-btn {
                padding: 5px 10px;                              /* 減少按鈕內部間距 */
                font-size: 12px;                                /* 減小按鈕文字大小 */
                min-width: 65px;                                /* 設置最小寬度 */
            }
        }

        /* 按鈕區域 - 歷史記錄項目底部的操作按鈕 */
        .history-actions {
            display: flex;                                      /* 彈性布局 */
            justify-content: flex-end;                          /* 右對齊 */
            gap: 8px;                                           /* 按鈕間距 */
            margin-top: 3px;                                    /* 頂部外部間距 */
        }

        /* 刪除按鈕和詳情按鈕共用樣式 - 操作按鈕的基本樣式 */
        .delete-btn, .detail-btn {
            padding: 6px 12px;                                  /* 內部間距 */
            border-radius: 4px;                                 /* 圓角效果 */
            font-size: 13px;                                    /* 文字大小 */
            font-weight: bold;                                  /* 文字粗細 */
            transition: all 0.25s ease;                         /* 過渡效果 */
            display: flex;                                      /* 彈性布局 */
            align-items: center;                                /* 垂直居中 */
            justify-content: center;                            /* 水平居中 */
            border: none;                                       /* 無邊框 */
            min-width: 70px;                                    /* 最小寬度 */
        }

        /* 刪除按鈕樣式 - 用紅色系表示刪除操作 */
        .delete-btn {
            background-color: rgba(var(--error-color-rgb), 0.15); /* 更淡的半透明紅色背景 */
            color: var(--text-muted);                            /* 使用淡色文字 */
            border: 1px solid rgba(var(--error-color-rgb), 0.3); /* 更淡的紅色邊框 */
            opacity: 0.7;                                        /* 降低透明度 */
            transform: scale(0.9);                               /* 縮小按鈕 */
        }

        /* 刪除按鈕懸停效果 - 鼠標懸停時的視覺變化 */
        .delete-btn:hover {
            background-color: var(--error-color);               /* 錯誤色背景 */
            color: white;                                       /* 白色文字 */
            transform: translateY(-2px);                        /* 上移效果 */
            box-shadow: 0 3px 5px rgba(var(--error-color-rgb), 0.4); /* 紅色陰影 */
        }

        /* 刪除按鈕點擊效果 - 點擊時的視覺反饋 */
        .delete-btn:active {
            transform: translateY(1px);                         /* 下移效果 */
        }

        /* 詳情按鈕樣式 - 用藍色系表示信息操作 */
        .detail-btn {
            background-color: rgba(var(--info-color-rgb), 0.25); /* 半透明藍色背景 */
            color: var(--text-color);                          /* 文字顏色 */
            border: 1px solid rgba(var(--info-color-rgb), 0.5); /* 藍色邊框 */
        }

        /* 詳情按鈕懸停效果 - 鼠標懸停時的視覺變化 */
        .detail-btn:hover {
            background-color: var(--info-color);               /* 信息色背景 */
            color: white;                                      /* 白色文字 */
            transform: translateY(-2px);                       /* 上移效果 */
            box-shadow: 0 3px 5px rgba(var(--info-color-rgb), 0.4); /* 藍色陰影 */
        }

        /* 詳情按鈕點擊效果 - 點擊時的視覺反饋 */
        .detail-btn:active {
            transform: translateY(1px);                        /* 下移效果 */
        }

        /* 無數據提示樣式 - 當沒有歷史記錄時顯示 */
        .no-data {
            text-align: center;                                /* 文字居中 */
            color: var(--text-muted);                          /* 淡色文字 */
            font-style: italic;                                /* 斜體文字 */
            padding: 30px 0;                                   /* 上下內部間距 */
            font-size: 16px;                                   /* 文字大小 */
        }

        /* 全部刪除按鈕改進 - 刪除所有歷史記錄的按鈕 */
        .delete-all-btn {
            background: rgba(var(--error-color-rgb), 0.15);    /* 淡紅色背景 */
            border: 1px solid var(--error-color);             /* 紅色邊框 */
            color: var(--error-color);                        /* 紅色文字 */
            font-size: 14px;                                  /* 文字大小 */
            padding: 6px 14px;                                /* 內部間距 */
            border-radius: 6px;                               /* 圓角效果 */
            cursor: pointer;                                  /* 滑鼠指標變為手型 */
            transition: all 0.3s ease;                        /* 過渡效果 */
            font-weight: bold;                                /* 文字粗細 */
        }

        /* 全部刪除按鈕懸停效果 - 鼠標懸停時的視覺變化 */
        .delete-all-btn:hover {
            background-color: var(--error-color);             /* 紅色背景 */
            color: white;                                     /* 白色文字 */
            transform: translateY(-2px);                      /* 上移效果 */
            box-shadow: 0 3px 5px rgba(var(--error-color-rgb), 0.4); /* 紅色陰影 */
        }

        /* 全部刪除按鈕點擊效果 - 點擊時的視覺反饋 */
        .delete-all-btn:active {
            transform: translateY(1px);                       /* 下移效果 */
            box-shadow: none;                                 /* 移除陰影 */
        }

        /* 同步按鈕樣式 */
        .sync-btn {
            background: rgba(var(--info-color-rgb), 0.15);
            border: 1px solid var(--info-color);
            color: var(--info-color);
            font-size: 14px;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin-right: 10px;
        }

        .sync-btn:hover {
            background-color: var(--info-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 3px 5px rgba(var(--info-color-rgb), 0.4);
        }

        .sync-btn:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        /* 模態框背景樣式 - 覆蓋整個頁面的半透明背景 */
        .modal-overlay {
            display: none;                                    /* 初始隱藏 */
            position: fixed;                                  /* 固定定位 */
            top: 0;                                          /* 貼齊頂部 */
            left: 0;                                         /* 貼齊左側 */
            width: 100%;                                     /* 寬度100% */
            height: 100%;                                    /* 高度100% */
            background-color: rgba(var(--primary-color-rgb), 0.7); /* 半透明背景 */
            z-index: 2000;                                   /* 層級 */
            justify-content: center;                         /* 水平居中 */
            align-items: center;                             /* 垂直居中 */
            animation: fadeIn 0.3s ease-out;                 /* 淡入動畫 */
        }

        /* 模態框容器樣式 - 顯示內容的中心區域 */
        .modal-container {
            background-color: var(--primary-color);          /* 主背景色 */
            border-radius: 10px;                             /* 圓角效果 */
            width: 90%;                                      /* 容器寬度 */
            max-width: 350px;                                /* 最大寬度 */
            box-shadow: 0 10px 25px rgba(var(--shadow-color)); /* 陰影效果 */
            animation: modalSlideIn 0.3s ease-out;           /* 滑入動畫 */
            overflow: hidden;                                /* 隱藏溢出內容 */
        }

        /* 模態框滑入動畫 - 定義模態框進入畫面的效果 */
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); } /* 初始在上方且透明 */
            to { opacity: 1; transform: translateY(0); }       /* 最終在正常位置且不透明 */
        }

        /* 模態框頭部樣式 - 包含標題和關閉按鈕的頂部區域 */
        .modal-header {
            display: flex;                                   /* 彈性布局 */
            justify-content: space-between;                  /* 兩端對齊 */
            align-items: center;                             /* 垂直居中 */
            padding: 15px;                                   /* 內部間距 */
            border-bottom: 1px solid var(--border-color);    /* 底部邊框 */
            background-color: var(--secondary-color);        /* 次要背景色 */
        }

        /* 貸款比較頁面的特殊標題樣式 */
        #multiLoanComparisonModal .modal-header {
            min-height: 56px; /* 確保有足夠高度容納按鈕 */
            padding: 12px 15px; /* 調整內距 */
        }

        /* 模態框標題樣式 - 頂部標題文字 */
        .modal-header h3 {
            margin: 0;                                       /* 移除外部間距 */
            color: var(--accent-color);                      /* 強調色文字 */
            font-size: 18px;                                 /* 文字大小 */
        }

        /* 模態框內容區域樣式 - 顯示主要內容的區域 */
        .modal-content {
            padding: 20px 15px;                              /* 內部間距 */
            color: var(--text-color);                        /* 文字顏色 */
            max-height: 100vh;                                /* 最大高度 */
            overflow-y: auto;                                /* 垂直滾動 */
        }

        /* 模態框底部區域樣式 - 包含操作按鈕的底部區域 */
        .modal-footer {
            padding: 10px 15px 15px;                         /* 內部間距 */
            display: flex;                                   /* 彈性布局 */
            justify-content: flex-end;                       /* 右對齊 */
            gap: 10px;                                       /* 按鈕間距 */
            border-top: 1px solid var(--border-color);       /* 頂部邊框 */
            background-color: var(--secondary-color);        /* 次要背景色 */
        }

        /* 模態框按鈕共用樣式 - 模態框中所有按鈕的基本樣式 */
        .modal-btn {
            padding: 8px 15px;                               /* 內部間距 */
            border-radius: 10px;                             /* 圓角效果 */
            cursor: pointer;                                 /* 滑鼠指標變為手型 */
            font-size: 15px;                                 /* 文字大小 */
            transition: all 0.3s ease;                       /* 過渡效果 */
            border: none;                                    /* 無邊框 */
        }

        /* 模態框主要按鈕樣式 - 用於確認、提交等主要操作 */
        .modal-btn-primary {
            background-color: var(--accent-color);           /* 強調色背景 */
            color: white;                                    /* 白色文字 */
        }

        /* 模態框主要按鈕懸停效果 - 鼠標懸停時的視覺變化 */
        .modal-btn-primary:hover {
            background-color: var(--accent-color-dark);      /* 深色強調背景 */
            transform: translateY(-2px);                     /* 上移效果 */
        }

        /* 模態框次要按鈕樣式 - 用於取消、返回等次要操作 */
        .modal-btn-secondary {
            background-color: var(--secondary-color);        /* 次要背景色 */
            color: var(--text-color);                        /* 文字顏色 */
            border: 1px solid var(--border-color);           /* 邊框 */
        }

        /* 模態框次要按鈕懸停效果 - 鼠標懸停時的視覺變化 */
        .modal-btn-secondary:hover {
            background-color: var(--hover-color);            /* 懸停背景色 */
            transform: translateY(-2px);                     /* 上移效果 */
        }

        /* 提示框樣式 - 顯示短暫消息的浮動提示 */
        .toast-message {
            position: fixed;                                 /* 固定定位 */
            bottom: 60px;                                    /* 距底部距離 */
            left: 50%;                                       /* 水平居中 */
            transform: translateX(-50%);                     /* 精確居中 */
            background-color: rgba(var(--info-color-rgb), 0.9); /* 半透明信息色背景 */
            color: white;                                    /* 白色文字 */
            padding: 10px 20px;                              /* 內部間距 */
            border-radius: 5px;                              /* 圓角效果 */
            z-index: 9999;                                   /* 最高層級 */
            font-weight: bold;                               /* 文字粗細 */
            box-shadow: 0 2px 10px var(--shadow-color);      /* 陰影效果 */
            opacity: 1;                                      /* 完全不透明 */
            transition: opacity 0.5s ease;                   /* 透明度過渡效果 */
        }

        /* 數字輸入模態框樣式 - 自定義計算器輸入界面 */
        .number-input-modal {
            background-color: var(--primary-color);          /* 主背景色 */
            border-radius: 12px;                             /* 圓角效果 */
            width: 95%;                                      /* 容器寬度 */
            max-width: 350px;                                /* 最大寬度 */
            box-shadow: 0 10px 25px var(--shadow-color);     /* 陰影效果 */
            overflow: hidden;                                /* 隱藏溢出內容 */
            animation: modalSlideIn 0.3s ease-out;           /* 滑入動畫 */
        }

        /* 計算器顯示區域 - 顯示計算輸入與結果的區域 */
        .calculator-display {
            background-color: var(--input-bg);               /* 輸入框背景色 */
            color: var(--text-color);                        /* 文字顏色 */
            font-size: 32px;                                 /* 文字大小 */
            padding: 10px 15px;                              /* 內部間距 */
            text-align: right;                               /* 文字右對齊 */
            margin: 10px;                                    /* 外部間距 */
            border-radius: 6px;                              /* 圓角效果 */
            border: 1px solid var(--border-color);           /* 邊框 */
            height: 46px;                                    /* 固定高度 */
            display: flex;                                   /* 彈性布局 */
            align-items: center;                             /* 垂直居中 */
            justify-content: flex-end;                       /* 右對齊 */
            overflow: hidden;                                /* 隱藏溢出內容 */
            box-shadow: inset 0 2px 4px var(--shadow-color); /* 內陰影效果 */
        }

        /* 計算器顯示容器 - 包含計算歷史和當前輸入的容器 */
        .calculator-display-container {
            display: flex;                                   /* 彈性布局 */
            flex-direction: column;                          /* 垂直排列 */
            background-color: var(--input-bg);               /* 輸入框背景色 */
            margin: 10px;                                    /* 外部間距 */
            border-radius: 10px;                             /* 圓角效果 */
            border: 1px solid var(--border-color);           /* 邊框 */
            box-shadow: inset 0 2px 8px var(--shadow-color); /* 內陰影效果 */
            overflow: hidden;                                /* 隱藏溢出內容 */
            height: 110px;                                   /* 固定高度 */
            position: relative;                              /* 相對定位 */
        }

        /* 計算器歷史記錄區域 - 顯示先前的計算步驟 */
        .calculator-history {
            color: var(--text-muted);                        /* 淡色文字 */
            font-size: 16px;                                 /* 文字大小 */
            padding: 8px 15px;                               /* 內部間距 */
            text-align: right;                               /* 文字右對齊 */
            height: 40px;                                    /* 固定高度 */
            overflow-y: hidden;                              /* 隱藏垂直溢出 */
            display: flex;                                   /* 彈性布局 */
            flex-direction: column;                          /* 垂直排列 */
            justify-content: flex-end;                       /* 底部對齊 */
            line-height: 1.3;                                /* 行高 */
            word-break: break-all;                           /* 允許單詞內換行 */
            font-family: 'Consolas', monospace;              /* 等寬字體 */
            position: relative;                              /* 相對定位 */
            background: linear-gradient(to bottom, 
                rgba(var(--input-bg-rgb), 0.8), 
                rgba(var(--secondary-color-rgb), 0.8));      /* 漸變背景 */
        }

        /* 計算器歷史記錄底部分隔線 - 創建視覺分隔 */
        .calculator-history::after {
            content: '';                                     /* 創建空內容 */
            position: absolute;                              /* 絕對定位 */
            left: 0;                                         /* 貼齊左側 */
            right: 0;                                        /* 貼齊右側 */
            bottom: 0;                                       /* 貼齊底部 */
            height: 1px;                                     /* 高度1像素 */
            background: linear-gradient(to right, transparent, 
                rgba(var(--accent-color-rgb), 0.4), transparent); /* 漸變背景 */
        }

        /* 計算器顯示區域增強樣式 - 主顯示區的視覺效果 */
        .calculator-display {
            background-color: var(--input-bg);               /* 輸入框背景色 */
            color: var(--text-color);                        /* 文字顏色 */
            font-size: 36px;                                 /* 較大文字大小 */
            padding: 10px 15px;                              /* 內部間距 */
            text-align: right;                               /* 文字右對齊 */
            flex: 1;                                         /* 佔用剩餘空間 */
            display: flex;                                   /* 彈性布局 */
            align-items: center;                             /* 垂直居中 */
            justify-content: flex-end;                       /* 右對齊 */
            overflow: hidden;                                /* 隱藏溢出內容 */
            margin: 0;                                       /* 移除外部間距 */
            border: none;                                    /* 移除邊框 */
            box-shadow: none;                                /* 移除陰影 */
            font-family: 'Consolas', monospace;              /* 等寬字體 */
            font-weight: bold;                               /* 文字粗細 */
            letter-spacing: 1px;                             /* 字符間距 */
            border-bottom-left-radius: 8px;                  /* 左下圓角 */
            border-bottom-right-radius: 8px;                 /* 右下圓角 */
            position: relative;                              /* 相對定位 */
            background: linear-gradient(to bottom, 
                rgba(var(--input-bg-rgb), 0.9), 
                rgba(var(--input-bg-rgb), 0.7));             /* 漸變背景 */
            text-shadow: 0 1px 2px var(--shadow-color);      /* 文字陰影 */
        }

        /* 計算器滾動指示器 - 顯示內容可滾動的提示 */
        .calculator-scroll-indicator {
            position: absolute;                              /* 絕對定位 */
            top: 5px;                                        /* 距頂部距離 */
            right: 5px;                                      /* 距右側距離 */
            width: 12px;                                     /* 寬度 */
            height: 12px;                                    /* 高度 */
            background-color: rgba(var(--accent-color-rgb), 0.7); /* 半透明強調色背景 */
            border-radius: 50%;                              /* 圓形效果 */
            opacity: 0;                                      /* 初始透明 */
            transition: opacity 0.3s ease;                   /* 透明度過渡效果 */
            z-index: 10;                                     /* 層級 */
        }

        /* 計算器按鈕區域 - 包含所有計算器按鈕的網格 */
        .calculator-buttons {
            display: grid;                                   /* 網格布局 */
            grid-template-columns: repeat(4, 1fr);           /* 四列等寬 */
            grid-template-rows: repeat(5, auto);             /* 五行自動高度 */
            gap: 6px;                                        /* 網格間距 */
            padding: 10px;                                   /* 內部間距 */
        }

        /* 計算器按鈕基本樣式 - 所有按鈕的共同樣式 */
        .calculator-buttons button {
            padding: 10px 0;                                 /* 上下內部間距 */
            font-size: 20px;                                 /* 文字大小 */
            border-radius: 10px;                             /* 圓角效果 */
            background-color: var(--secondary-color);        /* 次要背景色 */
            color: var(--text-color);                        /* 文字顏色 */
            border: none;                                    /* 移除邊框 */
            transition: all 0.2s ease;                       /* 過渡效果 */
            margin: 0;                                       /* 移除外部間距 */
            display: flex;                                   /* 彈性布局 */
            align-items: center;                             /* 垂直居中 */
            justify-content: center;                         /* 水平居中 */
            height: 48px;                                    /* 固定高度 */
            box-shadow: 0 2px 4px var(--shadow-color);       /* 陰影效果 */
            position: relative;                              /* 相對定位 */
            overflow: hidden;                                /* 隱藏溢出內容 */
        }

        /* 計算器按鈕懸停效果 - 鼠標懸停時的視覺變化 */
        .calculator-buttons button:hover {
            background-color: var(--hover-color);            /* 懸停背景色 */
            transform: translateY(-2px);                     /* 上移效果 */
            box-shadow: 0 4px 8px var(--shadow-color);       /* 增強陰影 */
        }

        /* 計算器按鈕點擊效果 - 點擊時的視覺反饋 */
        .calculator-buttons button:active {
            transform: scale(0.95);                          /* 縮小效果 */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);        /* 減弱陰影 */
        }

        /* 數字按鈕樣式 */
        /* 數字按鈕樣式 - 水平排列數字和財務符號 */
        .calculator-buttons .number-btn {
            display: flex;                                   /* 彈性布局 */
            flex-direction: row;                             /* 水平排列 */
            align-items: center;                             /* 垂直居中 */
            justify-content: center;                         /* 水平居中 */
            padding: 5px 2px;                                /* 內部間距 */
            position: relative;                              /* 相對定位 */
        }

        /* 阿拉伯數字樣式 - 主要顯示的數字 */
        .calculator-buttons .arabic-number {
            font-size: 28px;                                 /* 較大文字大小 */
            font-weight: bold;                               /* 文字粗細 */
            line-height: 1;                                  /* 行高 */
            margin-right: 3px;                               /* 右側外部間距 */
            flex-grow: 0;                                    /* 禁止增長 */
        }

        /* 財務符號樣式 - 顯示在按鈕上的中文數字 */
        .calculator-buttons .financial-char {
            font-size: 18px;                                 /* 較小文字大小 */
            color: var(--button-orange);                     /* 橙色文字 */
            line-height: 1;                                  /* 行高 */
            position: absolute;                              /* 絕對定位 */
            right: 6px;                                      /* 距右側距離 */
            opacity: 0.9;                                    /* 輕微透明 */
        }

        /* 數字按鈕相對定位 - 確保內部元素的正確定位 */
        .calculator-buttons .number-btn {
            position: relative;                              /* 相對定位 */
        }

        /* 阿拉伯數字右側間距 - 為財務符號留出空間 */
        .calculator-buttons .number-btn .arabic-number {
            margin-right: 3px;                               /* 右側外部間距 */
        }

        /* 財務符號定位 - 固定在按鈕右側 */
        .calculator-buttons .number-btn .financial-char {
            right: 6px;                                      /* 距右側距離 */
            font-size: 18px;                                 /* 文字大小 */
            color: var(--accent-color);                      /* 強調色文字 */
            position: absolute;                              /* 絕對定位 */
            opacity: 0.9;                                    /* 輕微透明 */
        }

        /* 數字按鈕點擊時的文字顏色變化 - 提供視覺反饋 */
        .calculator-buttons .number-btn:active .arabic-number,
        .calculator-buttons .number-btn:active .financial-char {
            color: white;                                    /* 白色文字 */
        }

        /* 零鍵樣式 - 調整零按鈕的特殊布局 */
        .calculator-buttons .zero {
            background-color: #3a3a3a;                       /* 深灰背景 */
            flex-direction: column;                          /* 垂直排列 */
            align-items: center;                             /* 水平居中 */
            justify-content: center;                         /* 垂直居中 */
        }

        /* 運算符和等號文字大小 - 確保視覺平衡 */
        .calculator-buttons .operator,
        .calculator-buttons .equals {
            font-size: 22px;                                 /* 文字大小 */
            font-weight: bold;                               /* 文字粗細 */
        }

        /* 清除和功能鍵文字大小 - 統一特殊按鈕的文字大小 */
        .calculator-buttons .clear,
        .calculator-buttons .function {
            font-size: 20px;                                 /* 文字大小 */
            font-weight: bold;                               /* 文字粗細 */
        }

        /* 按鈕點擊波紋效果 - 創建點擊時的擴散效果 */
        .calculator-buttons button::after {
            content: '';                                     /* 創建空內容 */
            position: absolute;                              /* 絕對定位 */
            top: 50%;                                        /* 從中心開始 */
            left: 50%;                                       /* 從中心開始 */
            width: 5px;                                      /* 初始寬度 */
            height: 5px;                                     /* 初始高度 */
            background: rgba(255, 255, 255, 0.5);            /* 半透明白色背景 */
            opacity: 0;                                      /* 初始透明 */
            border-radius: 100%;                             /* 圓形效果 */
            transform: scale(1, 1) translate(-50%, -50%);    /* 初始變形 */
            transform-origin: 50% 50%;                       /* 變形原點 */
        }

        /* 按鈕點擊時的波紋動畫 - 點擊時觸發波紋擴散 */
        .calculator-buttons button:active::after {
            animation: ripple 0.4s ease-out;                 /* 波紋動畫 */
        }

        /* 波紋動畫定義 - 控制點擊波紋的擴散效果 */
        @keyframes ripple {
            0% {
                transform: scale(0, 0) translate(-50%, -50%); /* 初始為點 */
                opacity: 0.5;                                /* 半透明 */
            }
            100% {
                transform: scale(20, 20) translate(-50%, -50%); /* 擴散為大圓 */
                opacity: 0;                                  /* 完全透明 */
            }
        }

        /* 功能鍵樣式 - 特殊功能按鈕的顏色 */
        .calculator-buttons .function {
            background-color: #4d4d4d;                       /* 中灰色背景 */
            color: #eee;                                     /* 淺灰色文字 */
            font-weight: bold;                               /* 文字粗細 */
        }

        /* 運算符號樣式 - 數學運算符按鈕的顏色 */
        .calculator-buttons .operator {
            background-color: var(--accent-color);           /* 強調色背景 */
            color: white;                                    /* 白色文字 */
            font-weight: bold;                               /* 文字粗細 */
            box-shadow: 0 2px 6px rgba(var(--accent-color-rgb), 0.4); /* 強調色陰影 */
        }

        /* 清除鍵樣式 - 清除按鈕的顏色 */
        .calculator-buttons .clear {
            background-color: var(--error-color);            /* 錯誤色背景 */
            color: white;                                    /* 白色文字 */
            font-weight: bold;                               /* 文字粗細 */
            box-shadow: 0 2px 6px rgba(var(--error-color-rgb), 0.4); /* 錯誤色陰影 */
        }

        /* 等號鍵樣式 - 等號按鈕的顏色 */
        .calculator-buttons .equals {
            background-color: var(--info-color);             /* 信息色背景 */
            color: white;                                    /* 白色文字 */
            font-weight: bold;                               /* 文字粗細 */
            box-shadow: 0 2px 6px rgba(var(--info-color-rgb), 0.4); /* 信息色陰影 */
        }

        /* 零鍵佔據兩欄 - 擴展零按鈕的寬度 */
        .calculator-buttons .zero {
            grid-column: span 2;                            /* 佔據兩列 */
            background-color: #3a3a3a;                      /* 深灰色背景 */
        }

        /* 提交按鈕佔據兩欄 - 擴展確認按鈕的寬度 */
        .calculator-buttons .submit {
            grid-column: span 2;                            /* 佔據兩列 */
            background-color: var(--accent-color);          /* 強調色背景 */
            color: white;                                   /* 白色文字 */
            font-weight: bold;                              /* 文字粗細 */
            box-shadow: 0 2px 6px rgba(var(--accent-color-rgb), 0.4); /* 強調色陰影 */
        }

        /* 錯誤提示樣式 - 顯示錯誤信息的toast */
        .toast-error {
            background-color: rgba(var(--error-color-rgb), 0.9); /* 半透明錯誤色背景 */
        }

        /* 添加箭頭旋轉動畫 - 控制展開/收起指示器 */
        #toggleIcon {
            display: inline-block;                          /* 行內塊顯示 */
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* 平滑過渡效果 */
        }

        /* 按鈕組的轉換效果 - 控制按鈕組的展開/收起 */
        .input-button-group div[id$="Buttons"] {
            max-height: 100px;                              /* 最大高度 */
            opacity: 1;                                     /* 完全不透明 */
        }

        /* 歷史記錄備註容器 - 包含備註的區域 */
        .history-note-container {
            background-color: rgba(var(--primary-color-rgb), 0.1); /* 半透明背景 */
            border-radius: 4px;                             /* 圓角效果 */
            margin: 6px 0;                                  /* 上下外部間距 */
            padding: 6px;                                   /* 內部間距 */
        }

        /* 歷史記錄項目底部 - 包含備註和按鈕的底部區域 */
        .history-item-footer {
            display: flex;                                  /* 彈性布局 */
            align-items: center;                            /* 垂直居中 */
            gap: 8px;                                       /* 項目間距 */
        }

        /* 歷史記錄備註預覽 - 顯示備註內容的預覽 */
        .history-note-preview {
            color: var(--note-text-color);         /* 使用專門的備註文字顏色變數 */
            font-size: 14px;                       /* 文字大小 */
            min-height: 20px;                      /* 最小高度 */
            padding: 6px 8px;                      /* 增加內邊距讓文字更易讀 */
            border: 1px solid transparent;         /* 透明邊框 */
            border-radius: 6px;                    /* 圓角效果 */
            background-color: rgba(var(--primary-color-rgb), 0.3); /* 半透明背景 */
            transition: all 0.3s ease;             /* 過渡效果 */
            cursor: pointer;                       /* 滑鼠指標變為手型 */
            white-space: nowrap;                   /* 禁止換行 */
            overflow: hidden;                      /* 隱藏溢出內容 */
            text-overflow: ellipsis;               /* 文字溢出顯示省略號 */
            flex-grow: 1;                          /* 佔用剩餘空間 */
            max-width: 170px;                      /* 最大寬度 */
            line-height: 1.4;                      /* 行高，讓文字更易讀 */
        }

        /* 空備註的特殊樣式 */
        .history-note-preview.empty-note {
            color: var(--note-text-empty);         /* 使用較淡的顏色 */
            font-style: italic;                    /* 斜體字 */
            background-color: transparent;         /* 透明背景 */
        }

        /* 歷史記錄操作按鈕區域 - 置於右側的按鈕組 */
        .history-actions {
            display: flex;                                  /* 彈性布局 */
            gap: 4px;                                       /* 按鈕間距 */
            margin-left: auto;                              /* 推到右側 */
        }

        /* 歷史記錄備註預覽懸停效果 - 鼠標懸停時的視覺變化 */
        .history-note-preview:hover {
            background-color: var(--accent-color-light);    /* 淡色強調背景 */
            border-color: rgba(var(--accent-color-rgb), 0.3); /* 半透明強調色邊框 */
        }

        /* 備註編輯器模態框 - 編輯備註的彈出窗口 */
        .note-editor-modal {
            display: none;                                  /* 初始隱藏 */
            position: fixed;                                /* 固定定位 */
            top: 0;                                         /* 貼齊頂部 */
            left: 0;                                        /* 貼齊左側 */
            width: 100%;                                    /* 寬度100% */
            height: 100%;                                   /* 高度100% */
            background-color: rgba(var(--primary-color-rgb), 0.7); /* 半透明背景 */
            z-index: 2000;                                  /* 層級 */
            justify-content: center;                        /* 水平居中 */
            align-items: flex-start;                        /* 頂部對齊 */
            padding-top: 160px;                             /* 頂部內部間距 */
        }

        /* 備註編輯器內容區域 - 包含輸入框和按鈕的主體 */
        .note-editor-content {
            background-color: var(--primary-color);         /* 主背景色 */
            border-radius: 12px;                            /* 圓角效果 */
            width: 80%;                                     /* 容器寬度 */
            max-width: 320px;                               /* 最大寬度 */
            padding: 15px;                                  /* 內部間距 */
            box-shadow: 0 10px 25px var(--shadow-color);    /* 陰影效果 */
            border: 1px solid var(--accent-color);          /* 強調色邊框 */
            animation: slideDown 0.3s ease-out;             /* 滑入動畫 */
            margin: 0 auto;                                 /* 水平居中 */
        }

        /* 向下滑入動畫 - 定義模態框進入畫面的效果 */
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; } /* 初始在上方且透明 */
            to { transform: translateY(0); opacity: 1; }       /* 最終在正常位置且不透明 */
        }

        /* 備註編輯器輸入框 - 多行文本輸入區域 */
        .note-editor-input {
            width: calc(100% - 24px);                       /* 計算寬度 */
            padding: 12px;                                  /* 內部間距 */
            margin: 12px 0;                                 /* 上下外部間距 */
            background-color: var(--input-bg);              /* 輸入框背景色 */
            color: var(--text-color);                       /* 文字顏色 */
            border: 1px solid var(--border-color);          /* 邊框 */
            border-radius: 8px;                             /* 圓角效果 */
            min-height: 100px;                              /* 最小高度 */
            resize: none;                                   /* 禁止調整大小 */
            font-size: 16px;                                /* 文字大小 */
            box-shadow: inset 0 2px 4px var(--shadow-color); /* 內陰影效果 */
            transition: all 0.3s ease;                      /* 過渡效果 */
            box-sizing: border-box;                         /* 盒模型計算方式 */
        }

        /* 備註編輯器輸入框聚焦效果 - 輸入時的視覺反饋 */
        .note-editor-input:focus {
            border-color: var(--accent-color);              /* 強調色邊框 */
            box-shadow: 0 0 0 2px var(--accent-color-light); /* 強調色陰影 */
            outline: none;                                  /* 移除默認輪廓 */
        }

        /* 備註編輯器按鈕區域 - 底部操作按鈕的容器 */
        .note-editor-buttons {
            display: flex;                                  /* 彈性布局 */
            justify-content: flex-end;                      /* 右對齊 */
            gap: 8px;                                       /* 按鈕間距 */
            margin-top: 8px;                                /* 頂部外部間距 */
        }

        /* 備註編輯器標題 - 頂部標題樣式 */
        .note-editor-content h3 {
            color: var(--accent-color);                     /* 強調色文字 */
            font-size: 18px;                                /* 文字大小 */
            margin: 0 0 8px 0;                              /* 外部間距 */
            padding-bottom: 8px;                            /* 底部內部間距 */
            border-bottom: 1px solid rgba(var(--accent-color-rgb), 0.3); /* 半透明強調色底部邊框 */
        }

        /* 主題相關元素樣式調整 - 確保元素使用主題變量 */
        .row {
            background-color: var(--secondary-color);        /* 使用次要背景色 */
            border-left: 3px solid transparent;              /* 透明左側邊框 */
            transition: all var(--transition-normal) ease;   /* 使用主題過渡時間 */
        }

        /* 行標籤文字顏色 - 使用主題文字色 */
        .row .label {
            color: var(--text-color);                        /* 使用文字顏色 */
        }

        /* 強調行樣式 - 特殊突出顯示的行 */
        .emphasized-row {
            border-left: 3px solid var(--accent-color);      /* 強調色左側邊框 */
            background: linear-gradient(90deg, var(--accent-color-light), transparent); /* 漸變背景 */
        }

        /* 強調行標籤文字顏色 - 使用強調色 */
        .emphasized-row .label {
            color: var(--accent-color);                      /* 強調色文字 */
        }

        /* 強調行輸入框邊框 - 使用強調色邊框 */
        .emphasized-row input {
            border-color: var(--accent-color);               /* 強調色邊框 */
        }

        /* 輸入框樣式 - 應用主題變量 */
        input {
            background-color: var(--input-bg);               /* 使用輸入框背景色 */
            color: var(--text-color);                        /* 使用文字顏色 */
            border: 1px solid var(--input-border);           /* 使用輸入框邊框色 */
        }

        /* 輸入框聚焦效果 - 應用主題變量 */
        input:focus {
            border-color: var(--accent-color);               /* 強調色邊框 */
            box-shadow: 0 0 0 3px var(--accent-color-light); /* 淡色強調陰影 */
        }

        /* 按鈕樣式 - 應用主題變量 */
        button {
            background-color: var(--secondary-color);        /* 次要背景色 */
            color: var(--text-color);                        /* 文字顏色 */
            border: 1px solid var(--border-color);           /* 邊框色 */
        }

        /* 按鈕懸停效果 - 應用主題變量 */
        button:hover {
            background-color: var(--hover-color);            /* 懸停背景色 */
        }

        /* 功能按鈕樣式 - 應用主題變量 */
        .function-buttons button {
            background-color: var(--secondary-color);        /* 次要背景色 */
            color: var(--text-color);                        /* 文字顏色 */
            border: 1px solid var(--accent-color);           /* 強調色邊框 */
        }

        /* 功能按鈕懸停效果 - 應用主題變量 */
        .function-buttons button:hover {
            background-color: var(--accent-color);           /* 強調色背景 */
        }

        /* 提示訊息樣式 - 應用主題變量 */
        .toast-message {
            background-color: var(--info-color);             /* 信息色背景 */
        }

        /* 錯誤提示樣式 - 應用主題變量 */
        .toast-error {
            background-color: var(--error-color);            /* 錯誤色背景 */
        }

        /* 警告文字樣式 - 應用主題變量 */
        .warning-text {
            color: var(--error-color) !important;            /* 強制使用錯誤色文字 */
        }

        /* 歷史記錄項目左側邊框 - 應用主題變量 */
        .history-item {
            border-left: 3px solid var(--accent-color);      /* 強調色左側邊框 */
        }

        /* 歷史記錄日期文字顏色 - 應用主題變量 */
        .history-date {
            color: var(--accent-color);                      /* 強調色文字 */
        }

        /* 添加到样式表的.history-item相关部分之后 */
        .checkbox-date-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-item-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.2s ease;
            margin: 0;
            flex-shrink: 0;
        }

        .history-item-checkbox:checked {
            accent-color: var(--accent-color);
        }

        .history-item-checkbox:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .compare-selected-btn {
            background: rgba(var(--accent-color-rgb), 0.15);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            font-size: 14px;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin-right: 10px;
        }

        .compare-selected-btn:hover:not(:disabled) {
            background-color: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 3px 5px rgba(var(--accent-color-rgb), 0.4);
        }

        .compare-selected-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(150, 150, 150, 0.15);
            border: 1px solid #999;
            color: #999;
        }

        .comparison-highlight {
            border-left: 3px solid #33b5e5 !important;
            background: linear-gradient(90deg, rgba(51, 181, 229, 0.1), transparent) !important;
        }

        /* 提示視窗的背景遮罩 */
        .install-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        /* 提示視窗 */
        .install-modal {
            width: 90%;
            max-width: 350px;
            background-color: var(--secondary-color);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border: 3px solid #ff0000; /* 紅色外框 */
        }

        /* 提示視窗標題 */
        .install-modal-title {
            background-color: #ff0000; /* 紅色背景 */
            color: white;
            padding: 12px 15px;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin: 0;
        }

        /* 提示視窗內容 */
        .install-modal-content {
            padding: 15px;
            color: var(--text-color);
            font-size: 13px;
            line-height: 1.4;
            text-align: center;
        }

        /* 提示視窗按鈕區域 */
        .install-modal-buttons {
            display: flex;
            padding: 10px 15px 15px;
            justify-content: center;
            gap: 15px;
        }

        /* 提示視窗按鈕 */
        .install-modal-btn {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            text-align: center;
        }

        /* 確認按鈕 */
        .install-btn-confirm {
            background-color: var(--accent-color);
            color: white;
        }

        /* 取消按鈕 */
        .install-btn-cancel {
            background-color: #666;
            color: white;
        }

        /* 安裝提示區域 */
        .install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--secondary-color);
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
            z-index: 9998;
        }

        /* 安裝提示文字 */
        .install-banner-text {
            flex: 1;
            font-size: 14px;
            color: var(--text-color);
        }

        /* 安裝按鈕 */
        .install-banner-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
        }

        /* 關閉安裝提示按鈕 */
        .install-banner-close {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 24px;
            line-height: 1;
            padding: 0;
            margin-right: 5px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        /* 中文國字大寫欄位樣式 */
        .chinese-amount-row {
            margin: 4px 0;
            display: flex;
            align-items: center;
            background: var(--secondary-color);
            padding: 3px;
            border-radius: 4px;
            box-shadow: 0 4px 8px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            transform-origin: left;
            will-change: transform;
        }

        /* 中文大寫欄位懸停效果 - 移除右移效果 */
        .chinese-amount-row:hover {
            /* transform: translateX(5px); 已移除右移效果 */
            box-shadow: 0 6px 12px var(--shadow-color); /* 增強陰影 */
        }

        .chinese-amount-result {
            width: 100%;
            padding: 6px 8px;
            margin-bottom: 0;
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 18px;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            min-height: 42px;
            max-height: 76px;
            overflow-y: auto;
            overflow-x: auto;
            white-space: normal;
            word-wrap: break-word;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            display: block;
            text-align: right;
            line-height: 1.2;
            flex: 1;                              /* 讓輸入框佔用剩餘空間 */
        }

        .chinese-amount-result::after {
            content: attr(data-placeholder);
            opacity: 0.5;
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            color: #888888;
            font-size: 16px;
            white-space: nowrap;
            pointer-events: none;
        }

        .chinese-amount-result:not(:empty)::after {
            display: none;
        }

        /* 專門為中文國字大寫添加的樣式 */
        .financial-digit {
            color: #FFBE7A;
            display: inline;
        }

        /* 總繳款中文國字大寫欄位樣式 */
        .total-payment-chinese-row {
            margin: 4px 0;
            display: flex;
            align-items: center;
            background: var(--secondary-color);
            padding: 3px;
            border-radius: 4px;
            box-shadow: 0 4px 8px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            transform-origin: left;
            will-change: transform;
        }

        /* 總繳款中文大寫欄位懸停效果 - 移除右移效果 */
        .total-payment-chinese-row:hover {
            /* transform: translateX(5px); 已移除右移效果 */
            box-shadow: 0 6px 12px var(--shadow-color); /* 增強陰影 */
        }

        .total-payment-chinese-result {
            width: 100%;
            padding: 6px 8px;
            margin-bottom: 0;
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 18px;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            min-height: 42px;
            max-height: 76px;
            overflow-y: auto;
            overflow-x: auto;
            white-space: normal;
            word-wrap: break-word;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            display: block;
            text-align: right;
            line-height: 1.2;
            flex: 1;                              /* 讓輸入框佔用剩餘空間 */
        }

        .total-payment-chinese-result::after {
            content: attr(data-placeholder);
            opacity: 0.5;
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            color: #888888;
            font-size: 16px;
            white-space: nowrap;
            pointer-events: none;
        }

        .total-payment-chinese-result:not(:empty)::after {
            display: none;
        }

        /* 中文大寫欄位的特殊標籤樣式 - 讓發票和總繳的標籤靠左對齊 */
        .chinese-amount-row .label,
        .total-payment-chinese-row .label {
            margin-right: 3px;                  /* 標籤右側的間距 */
            text-align: left;                   /* 文字靠左對齊 */
            width: 35px;                        /* 縮小標籤寬度，讓輸入框有更多空間 */
            flex-shrink: 0;                     /* 防止標籤被壓縮 */
        }

        /* 全螢幕比較貸款樣式 */
        #multiLoanComparisonModal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            background-color: var(--primary-color) !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        #multiLoanComparisonModal .modal-container {
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            margin: 0 !important;
            border-radius: 0 !important;
            display: flex !important;
            flex-direction: column !important;
        }

        #multiLoanComparisonModal .modal-header {
            flex-shrink: 0;
            position: sticky;
            top: 0;
            background-color: var(--secondary-color);
            z-index: 100;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        #multiLoanComparisonModal .modal-content {
            flex: 1;
            overflow-y: auto;
            background-color: var(--primary-color);
            padding-bottom: 20px; /* 底部留一點空間 */
        }

        /* 貸款選擇對話框全螢幕樣式 */
        #loanSelectionModal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            background-color: var(--primary-color) !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        #loanSelectionModal .modal-container {
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            margin: 0 !important;
            border-radius: 0 !important;
            display: flex !important;
            flex-direction: column !important;
        }

        #loanSelectionModal .modal-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        /* iframe 載入動畫 */
        #gasIframeLoader {
            animation: pulse 1.5s infinite;
        }

        /* 合併的每年/每月利息欄位的特殊樣式 */
        .combined-interest-row {
            display: flex !important;
            align-items: center !important;
            /* 確保欄位內容適當分佈 */
            justify-content: flex-start !important;
        }

        /* 第一個標籤的統一寬度 - 讓所有合併欄位的第一個標籤對齊 */
        .combined-interest-row .label:first-child {
            width: 75px !important;          /* 統一第一個標籤寬度 */
            font-size: 16px !important;      /* 保持字體大小 */
            margin-right: 4px !important;    /* 右側間距 */
            text-align: right !important;    /* 文字靠右對齊 */
            flex-shrink: 0;                 /* 防止標籤被壓縮 */
        }

        /* 第二個標籤的統一寬度 */
        .combined-interest-row .label:not(:first-child) {
            width: 65px !important;          /* 統一第二個標籤寬度 */
            font-size: 16px !important;      /* 保持字體大小 */
            margin-right: 4px !important;    /* 右側間距 */
            margin-left: 4px !important;     /* 左側間距 */
            text-align: right !important;    /* 文字靠右對齊 */
            flex-shrink: 0;                 /* 防止標籤被壓縮 */
        }

        /* 統一所有合併欄位的輸入框寬度 */
        .combined-interest-row input {
            width: 85px !important;          /* 增加輸入框寬度以顯示較大數值 */
            font-size: 16px !important;      /* 保持字體大小 */
            flex-shrink: 0;                 /* 防止輸入框被壓縮 */
        }

        /* 分隔符號的精確定位 */
        .interest-separator {
            color: var(--accent-color);
            margin: 0 8px;                   /* 左右間距各8px */
            font-weight: bold;
            font-size: 18px;
            flex-shrink: 0;                 /* 防止分隔符被壓縮 */
            /* 設定固定位置以確保對齊 */
            position: relative;
            left: 0;
        }

        .interest-separator {
            color: var(--accent-color);
            margin: 0 8px;
            font-weight: bold;
            font-size: 18px;
        }

        /* 子標籤樣式（每年、每月） */
        .sub-label {
            
            font-size: 16px;  /* 稍微小一點的字體 */
            margin: 0 6px;  /* 左右間距 */
        }

        /* 特別針對百萬利息和一萬利息欄位的輸入框寬度調整 */
        /* 因為這兩個欄位的數值通常較小，所以縮減寬度 */
        .million-interest-row input,
        .ten-thousand-interest-row input {
            width: 64px !important;          /* 縮小輸入框寬度（原本是85px） */
            font-size: 16px !important;      /* 保持字體大小不變 */
        }

        /* 調整百萬利息和一萬利息欄位的子標籤（每年、每月）寬度 */
        .million-interest-row .sub-label,
        .ten-thousand-interest-row .sub-label {
            width: auto !important;          /* 自動寬度 */
            margin: 0 8px !important;        /* 減少左右間距 */
            font-size: 16px !important;      /* 稍微縮小字體 */
        }

        /* 調整百萬利息和一萬利息欄位的主標籤寬度 */
        .million-interest-row .label:first-child,
        .ten-thousand-interest-row .label:first-child {
            width: 76px !important;          /* 稍微縮小標籤寬度（原本是75px） */
        }

        /* ============================================
        * 顯示模式切換按鈕樣式
        * ============================================ */

        /* 模式圖標基礎樣式 */
        .mode-icon {
            font-size: 20px;                    /* 圖標大小 */
            line-height: 1;                     /* 行高 */
            display: inline-block;              /* 行內塊顯示 */
            transition: none;                   /* 無過渡效果 */
        }

        /* 圓形圖標 - 完整模式 */
        .mode-circle {
            font-size: 18px;                    /* 圓形稍小一點 */
        }

        /* 正方形圖標 - 計算模式 */
        .mode-square {
            font-size: 16px;                    /* 正方形適中大小 */
        }

        /* 三角形圖標 - 精簡模式 */
        .mode-triangle {
            font-size: 18px;                    /* 三角形稍小一點 */
        }

        /* 隱藏元素樣式 - 簡化版本 */
        .mode-hidden {
            display: none !important;           /* 強制隱藏 */
        }

    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</head>
<body>

    <!-- ============================================
    * 固定頂部利率顯示header
    * 說明：永遠固定在網頁最頂部的利率顯示區域，包含佣後和稅佣後利率
    * 即使滑動網頁內容，這個區域始終保持在螢幕頂部可見
    * ============================================ -->
    <div id="fixedRateHeader" class="fixed-rate-header">
        
        <!-- 佣後利率顯示區域 -->
        <div class="rate-header-item">
            <!-- 佣後利率標籤文字 -->
            <span class="rate-header-label">佣後</span>
            <!-- 佣後利率數值輸入框（唯讀） -->
            <input type="text" 
                id="headerAfterCommissionOnlyRate" 
                class="rate-header-input" 
                readonly>
            <!-- 百分比符號 -->
            <span class="rate-header-percent">%</span>
        </div>
        
        <!-- 兩個利率顯示之間的分隔線 -->
        <div class="rate-header-separator"></div>
        
        <!-- 稅佣後利率顯示區域 -->
        <div class="rate-header-item">
            <!-- 稅佣後利率標籤文字 -->
            <span class="rate-header-label">稅佣後</span>
            <!-- 稅佣後利率數值輸入框（唯讀） -->
            <input type="text" 
                id="headerAfterCommissionRate" 
                class="rate-header-input" 
                readonly>
            <!-- 百分比符號 -->
            <span class="rate-header-percent">%</span>
        </div>
        
    </div>
	
    <div class="time-display-wrapper">
        <div id="timeDisplay" class="sticky-header">
            <div style="display: flex; justify-content: center; width: 100%;">
                <span class="time-label">報價時間</span>
                <span id="currentTime"></span>
            </div>
        </div>
    </div>
    
    <div class="input-button-group">
        <div class="row editable-field">
            <span class="label">期數</span>
            <input type="text" id="period" step="0.1" readonly>
            <button onclick="clearField('period')">清除</button>
        </div>
    
        <div id="periodButtons">
            <button onclick="adjustPeriod(-1)">-1</button>
            <button onclick="setPeriod(13)">底</button>
            <button onclick="setPeriod(24)">2</button>
            <button onclick="setPeriod(36)">3</button>
            <button onclick="setPeriod(48)">4</button>
            <button onclick="setPeriod(60)">5</button>
            <button onclick="setPeriod(72)">6</button>
            <button onclick="adjustPeriod(1)">+1</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row editable-field">
            <span class="label">稅前利率</span>
            <input type="text" id="rate" step="0.001" readonly>
            <button onclick="clearField('rate')">清除</button>
        </div>

        <div id="rateButtons">
            <!-- 減少0.2的按鍵，文字改為 -.2 -->
            <button onclick="adjustRate(-0.2)">-.2</button>
            
            <!-- 設定利率為 4% 的按鍵 -->
            <button onclick="setRate(4)">4</button>
            
            <!-- 設定利率為 6% 的按鍵 -->
            <button onclick="setRate(6)">6</button>
            
            <!-- 設定利率為 8% 的按鍵 -->
            <button onclick="setRate(8)">8</button>
            
            <!-- 設定利率為 10% 的按鍵 -->
            <button onclick="setRate(10)">10</button>
            
            <!-- 設定利率為 12% 的按鍵（原本是13，現在改為12） -->
            <button onclick="setRate(12)">12</button>
            
            <!-- 新增：設定利率為 14% 的按鍵 -->
            <button onclick="setRate(14)">14</button>
            
            <!-- 增加0.2的按鍵，文字改為 +.2 -->
            <button onclick="adjustRate(0.2)">+.2</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row editable-field">
            <span class="label">本金</span>
            <input type="text" id="principal" min="0" readonly>
            <button onclick="clearField('principal')">清除</button>
        </div>

        <div id="principalButtons">
            <button onclick="adjustPrincipal(-1000000)">-100</button>
            <button onclick="adjustPrincipal(-100000)">-10</button>
            <button onclick="adjustPrincipal(-10000)">-1</button>
            <button onclick="adjustPrincipal(10000)">+1</button>
            <button onclick="adjustPrincipal(100000)">+10</button>
            <button onclick="adjustPrincipal(1000000)">+100</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row editable-field">
            <span class="label">期繳</span>
            <input type="text" id="payment" step="0.01" readonly>
            <button onclick="clearField('payment')">清除</button>
        </div>

        <div id="PaymentduringButtons">
            <button onclick="adjustPayment(-100)">-100</button>
            <button onclick="adjustPayment(-50)">-50</button>
            <button onclick="roundPayment('down', 100)">捨百</button>
            <button onclick="roundPayment('up', 100)">進百</button>
            <button onclick="adjustPayment(50)">+50</button>
            <button onclick="adjustPayment(100)">+100</button>
        </div>
    </div>

    <!-- 合併的總利息和總繳款欄位 -->
    <div class="row combined-interest-row total-payment-row">
        <!-- 總利息部分 -->
        <span class="label">總利息</span>
        <input type="text" id="totalInterest" class="readonly medium-input" readonly>
        
        <!-- 分隔符號 -->
        <span class="interest-separator">|</span>
        
        <!-- 總繳款部分 -->
        <span class="label">總繳款</span>
        <input type="text" id="totalPayment" class="readonly medium-input" readonly>
    </div>

    <!-- 合併的每年/每月利息欄位 -->
    <div class="row combined-interest-row">
        <!-- 每年利息部分 -->
        <span class="label">每年利息</span>
        <input type="text" id="yearlyInterest" class="readonly" readonly>
        
        <!-- 分隔符號 - 使用更美觀的設計 -->
        <span class="interest-separator">|</span>
        
        <!-- 每月利息部分 -->
        <span class="label">每月利息</span>
        <input type="text" id="monthlyInterest" class="readonly" readonly>
    </div>

    <div class="divider-flow"></div>

    <!-- 合併的稅金和稅後利率欄位 -->
    <div class="row combined-interest-row tax-rate-row">
        <!-- 稅金部分 -->
        <span class="label">稅金</span>
        <input type="text" id="tax" class="readonly medium-input" readonly>
        
        <!-- 分隔符號 -->
        <span class="interest-separator">|</span>
        
        <!-- 稅後利率部分 -->
        <span class="label">稅後利率</span>
        <input type="text" id="afterTaxRate" step="0.001" class="readonly medium-input" readonly>
    </div>

    <div class="divider-flow"></div>

    <div class="input-button-group">
        <div class="row editable-field">
            <span class="label">推廣</span>
            <input type="text" id="commission" min="0" step="1" readonly>
            <button onclick="clearCommission()">清除</button>
        </div>

        <div id="commissionButtons">
            <button onclick="adjustCommission(-10000)">-萬</button>
            <button onclick="adjustCommission(-1000)">-千</button>
            <button onclick="adjustCommission(-100)">-百</button>
            <button onclick="adjustCommission(100)">+百</button>
            <button onclick="adjustCommission(1000)">+千</button>
            <button onclick="adjustCommission(10000)">+萬</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row editable-field">
            <span class="label">推廣比例</span>
            <input type="text" id="commissionRatio" class="readonly" readonly>
        </div>
    
        <div id="commissionPercentButtons">
            <button onclick="setCommissionPercent(1)">1%</button>
            <button onclick="setCommissionPercent(2)">2%</button>
            <button onclick="setCommissionPercent(3)">3%</button>
            <button onclick="setCommissionPercent(4)">4%</button>
            <button onclick="setCommissionPercent(5)">5%</button>
        </div>
    </div>

    <div class="row">
        <span class="label">佣後利率</span>
        <input type="text" id="afterCommissionOnlyRate" class="readonly" readonly>
        <span class="helper-text">資貸</span>
    </div>

    <div class="row">
        <span class="label">稅佣後利率</span>
        <input type="text" id="afterCommissionRate" class="readonly" readonly>
        <span class="helper-text">分期</span>
    </div>

    <div class="divider-flow"></div>

    <!-- 合併的百萬利息欄位 -->
    <div class="row combined-interest-row million-interest-row">
        <!-- 百萬利息標題 -->
        <span class="label">百萬利息</span>
        
        <!-- 每年部分 -->
        <span class="sub-label">每年</span>
        <input type="text" id="annualMillionInterest" class="readonly short-input" readonly>
        
        <!-- 分隔符號 -->
        <span class="interest-separator">|</span>
        
        <!-- 每月部分 -->
        <span class="sub-label">每月</span>
        <input type="text" id="monthlyMillionInterest" class="readonly short-input" readonly>
    </div>

    <!-- 合併的一萬利息欄位 -->
    <div class="row combined-interest-row ten-thousand-interest-row">
        <!-- 一萬利息標題 -->
        <span class="label">一萬利息</span>
        
        <!-- 每年部分 -->
        <span class="sub-label">每年</span>
        <input type="text" id="annualTenThousandInterest" class="readonly short-input" readonly>
        
        <!-- 分隔符號 -->
        <span class="interest-separator">|</span>
        
        <!-- 每月部分 -->
        <span class="sub-label">每月</span>
        <input type="text" id="monthlyTenThousandInterest" class="readonly short-input" readonly>
    </div>

    <div class="divider-flow"></div>

    <div class="row editable-field">
        <span class="label">資金成本</span>
        <input type="text" id="monthlyCost" value="2.1904" step="0.0001" readonly>
        <button onclick="resetMonthlyCost()">8月</button>
    </div>

    <div class="row">
        <span class="label">Spread</span>
        <input type="text" id="spread" class="readonly" readonly>
    </div>
	
    <div class="row">
        <span class="label">NPV</span>
        <input type="text" id="fundingCost" class="readonly" readonly>
        <span class="helper-text">稅佣後預估</span>
    </div>

    <div class="divider-flow"></div>

    <!-- 新增：客戶發票、營業稅、未稅金額欄位 -->
    <div class="row">
        <span class="label">客戶發票</span>
        <input type="text" id="customerInvoice" class="readonly" readonly>
    </div>
    <div class="row">
        <span class="label">營業稅</span>
        <input type="text" id="businessTax" class="readonly" readonly>
    </div>
    <div class="row">
        <span class="label">未稅金額</span>
        <input type="text" id="untaxedAmount" class="readonly" readonly>
    </div>

    <div class="row chinese-amount-row">
        <span class="label">發票</span>
        <div class="result chinese-amount-result" id="chineseAmount" data-placeholder="客戶發票金額的國字大寫"></div>
    </div>

    <div class="row total-payment-chinese-row">
        <span class="label">總繳</span>
        <div class="result total-payment-chinese-result" id="totalPaymentChinese" data-placeholder="總繳款金額的國字大寫"></div>
    </div>
    

    <!-- 按鈕區域重新組織 -->
    <div class="divider-flow"></div>

    <div class="function-buttons top-buttons">
        <div class="button-row">
            <button onclick="saveLoanData()" >保存計算</button>
            <button onclick="toggleHistoryPanel()" >歷史記錄</button>
        </div>
    </div>

    <div class="divider-flow"></div>

    <div class="function-buttons bottom-buttons">
        <div class="button-row">
            <button onclick="window.open('https://travel.chiayi.gov.tw/Folder/TurkeyRice', '_blank')">雞肉飯</button>
            <button onclick="clearAllFieldsExceptMonthlyCost()">清除</button>
        </div>
    </div>

    <div class="footer-message">報價後記得吃碗火雞肉飯唷！</div>

    <!-- 添加歷史記錄面板 -->
    <!-- 重新设计的历史记录面板 -->
    <div id="historyPanel" class="history-panel">
        <!-- 歷史記錄面板標題區域 -->
        <!-- 說明：包含標題、比較按鈕和全部刪除按鈕 -->
        <div class="history-header">
            <div class="header-left">
                <h2>歷史記錄</h2>
            </div>
            <div class="header-right">
                <!-- 比較按鈕：選擇多個貸款記錄進行比較 -->
                <button id="compareSelectedBtn" class="compare-selected-btn" onclick="compareSelectedLoans()" disabled>比較</button>
                <!-- 全部刪除按鈕：清空所有歷史記錄 -->
                <button class="delete-all-btn" onclick="confirmDeleteAll()">全刪</button>
            </div>
            <!-- 關閉按鈕 -->
            <button class="close-btn" onclick="toggleHistoryPanel()">×</button>
        </div>
        <div id="historyContent" class="history-content"></div>
    </div>

    <!-- 普通提示模態框 -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle">提示</h3>
                <button class="close-btn" onclick="hideModal()">×</button>
            </div>
            <div id="modalContent" class="modal-content"></div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" onclick="hideModal()">確定</button>
            </div>
        </div>
    </div>

    <!-- 確認模態框 -->
    <div id="confirmModalOverlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="confirmModalTitle">確認</h3>
                <button class="close-btn" onclick="hideConfirmModal()">×</button>
            </div>
            <div id="confirmModalContent" class="modal-content"></div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="hideConfirmModal()">取消</button>
                <button id="confirmModalOk" class="modal-btn modal-btn-primary">確定</button>
            </div>
        </div>
    </div>

    <div class="footer-spacing"></div>

    <!-- 加入動畫樣式 -->
    <style>
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>

<script>

    window.onload = function() {

        // ========== 清理舊的主題設定 ==========
        // 說明：移除之前儲存的主題選擇，確保使用預設主題
        localStorage.removeItem('selectedTheme');
        // ========== 清理結束 ==========

        // 初始化時間顯示
        updateTime();
        
        // ========== 自動恢復上次的計算數據 ==========
        // 說明：頁面載入時，檢查是否有自動保存的數據，如果有就恢復
        try {
            // 從本地儲存讀取自動保存的數據
            const savedDataStr = localStorage.getItem('loanCalculatorAutoSave');
            
            if (savedDataStr) {
                // 解析保存的數據
                const savedData = JSON.parse(savedDataStr);
                
                // 檢查數據是否是最近24小時內的（避免恢復太舊的數據）
                const savedTime = new Date(savedData.timestamp);
                const now = new Date();
                const hoursDiff = (now - savedTime) / (1000 * 60 * 60); // 轉換為小時
                
                // 如果數據是24小時內的，則恢復
                if (hoursDiff < 24) {
                    // 恢復各個欄位的值
                    if (savedData.period) document.getElementById('period').value = savedData.period;
                    if (savedData.rate) document.getElementById('rate').value = savedData.rate;
                    if (savedData.principal) document.getElementById('principal').value = savedData.principal;
                    if (savedData.payment) document.getElementById('payment').value = savedData.payment;

                    // ============================================
                    // 推廣欄位的特殊處理
                    // 說明：只有在有實際值且不為0時才恢復，否則保持空白
                    // ============================================
                    if (savedData.commission && savedData.commission !== '0' && savedData.commission !== 0) {
                        document.getElementById('commission').value = savedData.commission;
                    } else {
                        // 如果保存的值是0或空，則清空欄位
                        document.getElementById('commission').value = '';
                    }

                    if (savedData.monthlyCost) document.getElementById('monthlyCost').value = savedData.monthlyCost;
                    
                    // 更新所有相關計算
                    updateAllFields();
                    
                    // 顯示恢復成功的提示
                    showToast('已恢復上次的計算數據');
                    
                    console.log('成功恢復自動保存的數據:', savedData);
                } else {
                    // 如果數據太舊，清除它
                    localStorage.removeItem('loanCalculatorAutoSave');
                    console.log('自動保存的數據已過期，已清除');
                }
            }
        } catch (error) {
            // 如果恢復失敗，記錄錯誤但不影響正常功能
            console.error('恢復自動保存數據失敗:', error);
        }
        // ========== 自動恢復結束 ==========
    }

    // 獲取裝置類型
    function getDeviceType() {
        const ua = navigator.userAgent;
        if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) {
            return "tablet";
        }
        if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(ua)) {
            return "mobile";
        }
        return "desktop";
    }

    // 獲取瀏覽器資訊
    function getBrowserInfo() {
        const ua = navigator.userAgent;
        let browser = "Unknown";
        if (ua.indexOf("Chrome") > -1) browser = "Chrome";
        else if (ua.indexOf("Safari") > -1) browser = "Safari";
        else if (ua.indexOf("Firefox") > -1) browser = "Firefox";
        else if (ua.indexOf("Edge") > -1) browser = "Edge";
        else if (ua.indexOf("Opera") > -1) browser = "Opera";
        else if (ua.indexOf("MSIE") > -1 || ua.indexOf("Trident/") > -1) browser = "Internet Explorer";
        
        return `${browser} ${navigator.platform}`;
    }

	// 添加震動函數
	function vibrate() {
		if (navigator.vibrate) {
		navigator.vibrate(30); // 震動30毫秒
		}
	}

    // 添加這個新函數到第一個 script 標籤內，updateTime 函數之前
    function calculateNPV(payment, period, principal, monthlyCost) {
        try {
            // 檢查輸入值是否有效
            if (!payment || !period || !principal || !monthlyCost || 
                isNaN(payment) || isNaN(period) || isNaN(principal) || isNaN(monthlyCost)) {
                return 0;
            }
            
            // 檢查極端值
            if (period > 1200) { // 100年
                console.warn('NPV計算: 期數過大可能導致計算不準確');
                period = 1200; // 限制最大期數
            }
            
            // 將年利率轉換為月利率
            const monthlyRate = monthlyCost / 100 / 12;
            
            // 處理利率接近0的情況
            if (Math.abs(monthlyRate) < 1e-10) {
                // 如果利率接近0，使用簡化公式計算現值
                return payment * period - principal;
            }
            
            // 計算貸款現值 (PV) - 使用本息平均攤還公式
            // PV = PMT × [(1 - (1 + r)^(-n)) / r]
            const presentValue = payment * (1 - Math.pow(1 + monthlyRate, -period)) / monthlyRate;
            
            // 獲取稅金和推廣費
            const taxElement = document.getElementById('tax');
            const commissionElement = document.getElementById('commission');
            
            // 解析稅金值（移除千位分隔符）
            let tax = 0;
            if (taxElement && taxElement.value) {
                tax = parseFloat(taxElement.value.replace(/,/g, '')) || 0;
            }
            
            // 解析推廣費值（移除千位分隔符）
            let commission = 0;
            if (commissionElement && commissionElement.value) {
                commission = parseFloat(commissionElement.value.replace(/,/g, '')) || 0;
            }
            
            // 計算最終NPV：貸款現值 - 稅金 - 推廣費 - 本金
            const npv = presentValue - tax - commission - principal;
            
            // 檢查計算結果是否有效
            if (!isFinite(npv) || isNaN(npv)) {
                console.error('NPV計算結果無效');
                return 0;
            }
            
            return Math.round(npv);
        } catch (error) {
            console.error('NPV 計算錯誤:', error);
            return 0;
        }
    }

    // 添加更新時間的函數
    function updateTime() {
        const now = new Date();
        const days = ['日', '一', '二', '三', '四', '五', '六'];
        
        // 調整為台北時間 (GMT+8)
        const taipeiTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
        
        const year = taipeiTime.getUTCFullYear();
        const month = String(taipeiTime.getUTCMonth() + 1).padStart(2, '0');
        const date = String(taipeiTime.getUTCDate()).padStart(2, '0');
        const day = days[taipeiTime.getUTCDay()];
        const hours = String(taipeiTime.getUTCHours()).padStart(2, '0');
        const minutes = String(taipeiTime.getUTCMinutes()).padStart(2, '0');
        const seconds = String(taipeiTime.getUTCSeconds()).padStart(2, '0');
        
        const timeString = `${year}年${month}月${date}日
            星期${day} ${hours}:${minutes}:${seconds}`;
        document.getElementById('currentTime').textContent = timeString;
    }

    // 每秒更新一次時間
    setInterval(updateTime, 1000);
    updateTime(); // 初始化顯示

    // ========== 頁面可見性檢測 ==========
    // 說明：當使用者切換到其他應用或標籤頁時，自動保存數據
    // 當使用者回到頁面時，檢查並提示是否有新版本
    
    // 添加頁面可見性變化的監聽器
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            // ===== 頁面被隱藏時（切換到其他應用） =====
            console.log('頁面已隱藏，執行自動保存...');
            
            // 執行一次完整的欄位更新，這會觸發自動保存
            updateAllFields();
            
            // 記錄頁面隱藏的時間
            localStorage.setItem('pageHiddenTime', new Date().toISOString());
            
        } else {
            // ===== 頁面重新顯示時（回到應用） =====
            console.log('頁面已顯示');
            
            // 檢查頁面隱藏了多久
            const hiddenTime = localStorage.getItem('pageHiddenTime');
            if (hiddenTime) {
                const hiddenDuration = new Date() - new Date(hiddenTime);
                const minutesHidden = Math.floor(hiddenDuration / 60000);
                
                // 如果頁面隱藏超過5分鐘，重新載入資料以確保資料是最新的
                if (minutesHidden >= 5) {
                    console.log(`頁面已隱藏 ${minutesHidden} 分鐘，檢查資料狀態...`);
                    
                    // 檢查是否有自動保存的資料
                    const savedData = localStorage.getItem('loanCalculatorAutoSave');
                    if (savedData) {
                        showToast('歡迎回來！您的計算資料已保存');
                    }
                }
                
                // 清除隱藏時間記錄
                localStorage.removeItem('pageHiddenTime');
            }
        }
    });
    
    // 監聽頁面即將關閉或重新整理的事件
    window.addEventListener('beforeunload', function(event) {
        // 在頁面即將關閉前，執行最後一次保存
        updateAllFields();
        console.log('頁面即將關閉，已執行自動保存');
        
        // 如果有未保存的重要資料，可以提示使用者
        const hasUnsavedData = document.getElementById('period').value || 
                              document.getElementById('rate').value || 
                              document.getElementById('principal').value || 
                              document.getElementById('payment').value;
        
        if (hasUnsavedData) {
            // 註：現代瀏覽器會顯示標準的離開提示，而不是自定義訊息
            event.preventDefault();
            event.returnValue = '';
        }
    });
    // ========== 頁面可見性檢測結束 ==========

    // 原始的JavaScript函數保持不變
    function PMT(rate, nper, pv) {
        // 參數驗證
        if (!nper || nper <= 0) {
            showToast('錯誤：期數必須為正數', true);
            return 0;
        }
        
        if (!pv || pv <= 0) {
            showToast('錯誤：本金必須為正數', true);
            return 0;
        }
        
        // 轉換利率為月利率
        rate = rate / 100 / 12;
        
        try {
            // 特殊情況：利率為0或接近0
            if (Math.abs(rate) < 1e-10) {
                return pv / nper; // 如果利率接近0，簡單地將本金除以期數
            }
            
            // 標準等額本息公式
            return (pv * rate * Math.pow(1 + rate, nper)) / (Math.pow(1 + rate, nper) - 1);
        } catch (error) {
            console.error('PMT 計算錯誤:', error);
            showToast('期繳金額計算出錯，請檢查輸入值', true);
            return 0;
        }
    }
        
    function RATE(nper, pmt, pv) {
        // 參數驗證
        if (!nper || nper <= 0) {
            showToast('錯誤：期數必須為正數', true);
            return 0;
        }
        
        if (!pmt || pmt <= 0) {
            showToast('錯誤：期繳金額必須為正數', true);
            return 0;
        }
        
        if (!pv || pv <= 0) {
            showToast('錯誤：本金必須為正數', true);
            return 0;
        }
        
        // 基本檢查：如果期繳總額小於本金，無法計算有效利率
        if (pmt * nper <= pv) {
            showToast('錯誤：期繳總額必須大於本金才能計算利率', true);
            return 0;
        }
        
        let rate = 0.1; // 初始猜測值，10%
        let step = 0.05;
        let tolerance = 0.0001;
        let maxIterations = 100;
        let iteration = 0;
        
        try {
            while (iteration < maxIterations) {
                let monthlyRate = rate / 12;
                
                // 避免除零錯誤
                let denominator = Math.pow(1 + monthlyRate, nper) - 1;
                if (Math.abs(denominator) < 1e-10) { // 接近零的情況
                    rate += step; // 調整並繼續迭代
                    step *= 0.5;
                    iteration++;
                    continue;
                }
                
                let calculated = pv * monthlyRate * Math.pow(1 + monthlyRate, nper) / denominator;
                
                if (Math.abs(calculated - pmt) < tolerance) {
                    return Math.max(0, rate * 100); // 確保不返回負利率
                }
                
                if (calculated > pmt) {
                    rate -= step;
                } else {
                    rate += step;
                }
                
                // 確保利率不會變為負數
                rate = Math.max(0.0001, rate);
                
                step *= 0.5;
                iteration++;
            }
            
            // 如果達到最大迭代次數仍未收斂
            console.warn('RATE 計算未收斂，返回最佳近似值');
            return Math.max(0, rate * 100);
        } catch (error) {
            console.error('RATE 計算錯誤:', error);
            showToast('利率計算出錯，請檢查輸入值', true);
            return 0;
        }
    }

    function calculateRate() {
        const period = parseFloat(document.getElementById('period').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, ''));
        
        // 只有當至少三個欄位已填寫時才顯示警告
        const filledFields = countFilledFields();
        const shouldWarn = filledFields >= 3;
        
        // 輸入驗證
        if (shouldWarn) {
            if (isNaN(period) || period <= 0) {
                showToast('請輸入有效的期數', true);
                return;
            }
            
            if (isNaN(principal) || principal <= 0) {
                showToast('請輸入有效的本金', true);
                return;
            }
            
            if (isNaN(payment) || payment <= 0) {
                showToast('請輸入有效的期繳金額', true);
                return;
            }
            
            // 基本財務檢查：總還款應超過本金
            if (payment * period <= principal) {
                showToast('期繳總額必須大於本金才能計算有效利率', true);
                return;
            }
        } else {
            // 如果欄位數不足，但輸入無效，直接返回
            if (isNaN(period) || isNaN(principal) || isNaN(payment) || 
                period <= 0 || principal <= 0 || payment <= 0 ||
                payment * period <= principal) {
                return;
            }
        }
        
        try {
            const rate = RATE(period, payment, principal);
            
            // 檢查計算結果是否有效
            if (isNaN(rate) || !isFinite(rate) || rate < 0) {
                if (shouldWarn) {
                    showToast('利率計算結果無效，請檢查輸入值', true);
                }
                return;
            }
            
            // 檢查利率是否超過20%
            if (rate > 20) {
                showToast('警告：計算結果顯示利率超過20%，可能不符合一般貸款條件', true);
            }
            
            // 限制利率顯示的小數位數並更新界面，不截斷超過20%的數值
            document.getElementById('rate').value = rate.toFixed(4);
            updateAllFields();
        } catch (error) {
            console.error('利率計算錯誤:', error);
            if (shouldWarn) {
                showToast('計算利率時出錯', true);
            }
        }
    }

    function calculatePayment() {
        const period = parseFloat(document.getElementById('period').value);
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        
        // 只有當至少三個欄位已填寫時才顯示警告
        const filledFields = countFilledFields();
        const shouldWarn = filledFields >= 3;
        
        // 檢查所有輸入並提供具體錯誤訊息
        if (shouldWarn) {
            if (isNaN(period) || period <= 0) {
                showToast('請輸入有效的期數', true);
                return;
            }
            
            if (isNaN(rate) || rate <= 0) {
                showToast('請輸入有效的利率', true);
                return;
            }
            
            if (isNaN(principal) || principal <= 0) {
                showToast('請輸入有效的本金', true);
                return;
            }
        } else {
            // 如果欄位數不足，但輸入無效，直接返回
            if (isNaN(period) || isNaN(rate) || isNaN(principal) || 
                period <= 0 || rate <= 0 || principal <= 0) {
                return;
            }
        }
        
        try {
            // 限制極端值
            const safeRate = Math.min(Math.max(rate, 0.0001), 50); // 限制利率在合理範圍內
            const safePeriod = Math.min(Math.max(period, 1), 999); // 限制期數不超過999期
            
            const payment = PMT(safeRate, safePeriod, principal);
            
            // 檢查計算結果是否有效
            if (isNaN(payment) || !isFinite(payment) || payment <= 0) {
                if (shouldWarn) {
                    showToast('計算結果無效，請檢查輸入值', true);
                }
                return;
            }
            
            // 四捨五入為整數並格式化
            document.getElementById('payment').value = formatNumberWithCommas(Math.round(payment));
            updateAllFields();
        } catch (error) {
            console.error('期繳金額計算錯誤:', error);
            if (shouldWarn) {
                showToast('計算期繳金額時出錯', true);
            }
        }
    }


    function updateAllFields() {
        // 獲取基本值 - 需要先移除千位分隔符再轉換為數字
        const period = parseFloat(document.getElementById('period').value);
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, '')) || 0;
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, '')) || 0;
        const monthlyCost = parseFloat(document.getElementById('monthlyCost').value);

        // 期數檢查
        const periodInput = document.getElementById('period');
        if (period <= 12) {
            periodInput.classList.add('warning-text');
        } else {
            periodInput.classList.remove('warning-text');
        }

        // 檢查四個基本輸入框是否都有值
        const hasAllRequiredValues = period && rate && principal && payment && 
                                    !isNaN(period) && !isNaN(rate) && !isNaN(principal) && !isNaN(payment);

        // 計算並顯示總繳款
        const totalPaymentField = document.getElementById('totalPayment');
        if (hasAllRequiredValues) {
            // 計算總繳款
            const totalPaymentValue = payment * period;
            // 總繳款格式化為整數帶千位分隔符
            totalPaymentField.value = formatNumberWithCommas(Math.round(totalPaymentValue));
        } else {
            // 如果缺少任何必要值，清空總繳款輸入框
            totalPaymentField.value = '';
        }

        // 計算並顯示總利息
        const totalInterestField = document.getElementById('totalInterest');
        if (hasAllRequiredValues) {
            // 計算總利息
            const totalInterest = (payment * period) - principal;
            // 總利息格式化為整數帶千位分隔符
            totalInterestField.value = formatNumberWithCommas(Math.round(totalInterest));
        } else {
            // 如果缺少任何必要值，清空總利息輸入框
            totalInterestField.value = '';
        }

        // 計算並顯示每年利息
        const yearlyInterestField = document.getElementById('yearlyInterest');
        if (hasAllRequiredValues) {
            // 計算每年利息 = 總利息 ÷ 期數 × 12
            const totalInterest = (payment * period) - principal;
            const yearlyInterest = (totalInterest / period) * 12;
            // 每年利息格式化為整數帶千位分隔符
            yearlyInterestField.value = formatNumberWithCommas(Math.round(yearlyInterest));
        } else {
            // 如果缺少任何必要值，清空每年利息輸入框
            yearlyInterestField.value = '';
        }

        // 計算並顯示每月利息
        const monthlyInterestField = document.getElementById('monthlyInterest');
        if (hasAllRequiredValues) {
            // 計算每月利息 = 每年利息 ÷ 12
            const totalInterest = (payment * period) - principal;
            const yearlyInterest = (totalInterest / period) * 12;
            const monthlyInterest = yearlyInterest / 12;
            // 每月利息格式化為整數帶千位分隔符
            monthlyInterestField.value = formatNumberWithCommas(Math.round(monthlyInterest));
        } else {
            // 如果缺少任何必要值，清空每月利息輸入框
            monthlyInterestField.value = '';
        }

        // 計算稅金 - 同樣需要檢查總利息是否已計算
        const taxField = document.getElementById('tax');
        if (hasAllRequiredValues) {
            const totalInterest = (payment * period) - principal;
            const tax = totalInterest / 21;
            taxField.value = formatNumberWithCommas(tax.toFixed(2));
        } else {
            taxField.value = '';
        }

        // 計算稅後利率 - 同樣需要檢查必要值
        const afterTaxRateInput = document.getElementById('afterTaxRate');
        if (hasAllRequiredValues) {
            const totalInterest = (payment * period) - principal;
            const tax = totalInterest / 21;
            const afterTaxRate = RATE(period, payment, principal + tax);
            afterTaxRateInput.value = afterTaxRate.toFixed(4);
            
            // 檢查稅後利率是否超過20%
            if (afterTaxRate > 20) {
                afterTaxRateInput.classList.add('warning-text');
                if (countFilledFields() >= 3) {
                    showToast('警告：稅後利率超過20%，可能不符合一般貸款條件', true);
                }
            } else if (afterTaxRate <= 2.5) {
                afterTaxRateInput.classList.add('warning-text');
            } else {
                afterTaxRateInput.classList.remove('warning-text');
            }
        } else {
            afterTaxRateInput.value = '';
            afterTaxRateInput.classList.remove('warning-text');
        }

        // ============================================
        // 推廣費（佣金）欄位處理
        // 說明：只有在欄位有實際輸入值時才格式化，空白時保持空白
        // ============================================
        const commissionField = document.getElementById('commission');
        const commissionValue = commissionField.value.replace(/,/g, ''); // 移除千位分隔符

        // 檢查欄位是否為空或只有空白
        if (commissionValue === '' || commissionValue.trim() === '') {
            // 如果欄位是空的，保持空白，不要顯示0
            // 不做任何處理，保持原樣
        } else {
            // 如果欄位有值，才進行格式化
            const commission = parseFloat(commissionValue) || 0;
            commissionField.value = formatNumberWithCommas(Math.round(commission));
        }

        // 為了後續計算，需要取得推廣費的數值（如果為空則為0）
        const commission = parseFloat(commissionField.value.replace(/,/g, '')) || 0;
        
        // 檢查佣金是否超過總利息的45%
        const commissionInput = document.getElementById('commission');
        if (hasAllRequiredValues) {
            const totalInterest = (payment * period) - principal;
            if (commission >= totalInterest * 0.45) {
                commissionInput.classList.add('warning-text');
                // 新增警告提示
                showToast('請注意推廣費與總利息比例！', true);
            } else {
                commissionInput.classList.remove('warning-text');
            }
        } else {
            commissionInput.classList.remove('warning-text');
        }

        // 計算並更新推廣費比例
        const commissionRatioInput = document.getElementById('commissionRatio');
        if (principal > 0 && commission > 0) {
            const commissionRatio = commission / principal * 100;
            commissionRatioInput.value = commissionRatio.toFixed(2);
            
            // 檢查推廣費比例是否超過5%
            if (commissionRatio > 5) {
                commissionRatioInput.classList.add('warning-text');
            } else {
                commissionRatioInput.classList.remove('warning-text');
            }
        } else {
            commissionRatioInput.value = '';
            commissionRatioInput.classList.remove('warning-text');
        }

        // 計算佣後利率
        const afterCommissionOnlyRateInput = document.getElementById('afterCommissionOnlyRate');
        if (hasAllRequiredValues) {
            try {
                // 計算佣後利率（只考慮佣金，不考慮稅金）
                const afterCommissionOnlyRate = RATE(period, payment, principal + commission);
                
                // 檢查結果是否有效
                if (isNaN(afterCommissionOnlyRate) || !isFinite(afterCommissionOnlyRate)) {
                    afterCommissionOnlyRateInput.value = "計算錯誤";
                    afterCommissionOnlyRateInput.classList.add('warning-text');
                } else {
                    // 佣後利率不需要千位分隔符
                    afterCommissionOnlyRateInput.value = afterCommissionOnlyRate.toFixed(4);
                    if (afterCommissionOnlyRate <= 2.5) {
                        afterCommissionOnlyRateInput.classList.add('warning-text');
                    } else {
                        afterCommissionOnlyRateInput.classList.remove('warning-text');
                    }
                }
            } catch (error) {
                console.error('佣後利率計算錯誤:', error);
                afterCommissionOnlyRateInput.value = "計算錯誤";
                afterCommissionOnlyRateInput.classList.add('warning-text');
            }
        } else {
            afterCommissionOnlyRateInput.value = '';
            afterCommissionOnlyRateInput.classList.remove('warning-text');
        }

        // 計算稅佣後利率
        // 計算稅佣後利率
        const afterCommissionRateInput = document.getElementById('afterCommissionRate');
        if (hasAllRequiredValues) {
            try {
                const totalInterest = (payment * period) - principal;
                const tax = totalInterest / 21;
                
                // 檢查計算是否合理
                const totalCost = principal + tax + commission;
                if (totalCost >= payment * period) {
                    // 如果成本超過總還款額，無法計算有效利率
                    afterCommissionRateInput.value = "N/A";
                    afterCommissionRateInput.classList.add('warning-text');
                    
                    // 同時更新 Spread
                    const spreadInput = document.getElementById('spread');
                    spreadInput.value = "N/A";
                    spreadInput.classList.add('warning-text');
                } else {
                    // 正常計算
                    const afterCommissionRate = RATE(period, payment, principal + tax + commission);
                    
                    // 檢查結果是否有效
                    if (isNaN(afterCommissionRate) || !isFinite(afterCommissionRate)) {
                        afterCommissionRateInput.value = "計算錯誤";
                        afterCommissionRateInput.classList.add('warning-text');
                    } else {
                        // 稅佣後利率不需要千位分隔符
                        afterCommissionRateInput.value = afterCommissionRate.toFixed(4);
                        if (afterCommissionRate <= 2.5) {
                            afterCommissionRateInput.classList.add('warning-text');
                        } else {
                            afterCommissionRateInput.classList.remove('warning-text');
                        }
                        
                        // 計算 Spread
                        const spread = afterCommissionRate - monthlyCost;
                        // Spread 不需要千位分隔符
                        const spreadInput = document.getElementById('spread');
                        spreadInput.value = spread.toFixed(4);
                        if (spread <= 0) {
                            spreadInput.classList.add('warning-text');
                        } else {
                            spreadInput.classList.remove('warning-text');
                        }
                    }
                }
            } catch (error) {
                console.error('稅佣後利率計算錯誤:', error);
                afterCommissionRateInput.value = "計算錯誤";
                afterCommissionRateInput.classList.add('warning-text');
                
                document.getElementById('spread').value = '';
                document.getElementById('spread').classList.remove('warning-text');
            }
        } else {
            afterCommissionRateInput.value = '';
            afterCommissionRateInput.classList.remove('warning-text');
            
            document.getElementById('spread').value = '';
            document.getElementById('spread').classList.remove('warning-text');
        }
        
        // 計算百萬利息相關
        if (rate > 0) {
            // 百萬利息計算
            const millionPayment = PMT(rate, 12, 1000000);
            const annualMillionInterest = (millionPayment * 12) - 1000000;
            
            // 百萬每年利息格式化為整數帶千位分隔符
            document.getElementById('annualMillionInterest').value = formatNumberWithCommas(Math.round(annualMillionInterest));
            // 百萬每月利息格式化為整數帶千位分隔符
            document.getElementById('monthlyMillionInterest').value = formatNumberWithCommas(Math.round(annualMillionInterest / 12));
            
            // 一萬利息
            const tenThousandPayment = PMT(rate, 12, 10000);
            const annualTenThousandInterest = (tenThousandPayment * 12) - 10000;
            
            // 一萬每年利息格式化為整數帶千位分隔符
            document.getElementById('annualTenThousandInterest').value = formatNumberWithCommas(Math.round(annualTenThousandInterest));
            // 一萬每月利息格式化為整數帶千位分隔符
            document.getElementById('monthlyTenThousandInterest').value = formatNumberWithCommas(Math.round(annualTenThousandInterest / 12));
        } else {
            document.getElementById('annualMillionInterest').value = '';
            document.getElementById('monthlyMillionInterest').value = '';
            document.getElementById('annualTenThousandInterest').value = '';
            document.getElementById('monthlyTenThousandInterest').value = '';
        }
        
        // 計算 NPV
        const npvValue = calculateNPV(
            payment,
            period,
            principal,
            monthlyCost
        );
        
        // 更新 NPV 顯示，帶千位分隔符
        const fundingCostInput = document.getElementById('fundingCost');
        if (hasAllRequiredValues) {
            fundingCostInput.value = formatNumberWithCommas(npvValue);
            
            // 更新警告樣式
            if (npvValue < 0) {
                fundingCostInput.classList.add('warning-text');
            } else {
                fundingCostInput.classList.remove('warning-text');
            }
        } else {
            fundingCostInput.value = '';
            fundingCostInput.classList.remove('warning-text');
        }

        // 新增：自動更新三個新欄位
        const principalValue = principal;
        const customerInvoiceField = document.getElementById('customerInvoice');
        const businessTaxField = document.getElementById('businessTax');
        const untaxedAmountField = document.getElementById('untaxedAmount');
        if (principalValue > 0) {
            // 客戶發票 = 本金
            customerInvoiceField.value = formatNumberWithCommas(Math.round(principalValue));
            // 營業稅 = 客戶發票 / 21，四捨五入至整數
            const businessTax = Math.round(principalValue / 21);
            businessTaxField.value = formatNumberWithCommas(businessTax);
            // 未稅金額 = 客戶發票 - 營業稅，顯示正整數
            const untaxedAmount = Math.max(0, Math.round(principalValue - businessTax));
            untaxedAmountField.value = formatNumberWithCommas(untaxedAmount);
        } else {
            customerInvoiceField.value = '';
            businessTaxField.value = '';
            untaxedAmountField.value = '';
        }

        // 新增：更新中文國字大寫欄位
        const chineseAmountField = document.getElementById('chineseAmount');
        if (principalValue > 0) {
            try {
                // 轉換客戶發票金額為中文國字大寫
                const chineseAmount = arabicToChineseNumber(principalValue, 'financial') + ' 元整';
                chineseAmountField.innerHTML = chineseAmount; // 使用 innerHTML 以支持HTML標籤
            } catch (error) {
                console.error('中文轉換錯誤:', error);
                chineseAmountField.textContent = '轉換錯誤';
            }
        } else {
            chineseAmountField.innerHTML = ''; // 清空顯示
        }

        // 新增：更新總繳款中文國字大寫欄位
        const totalPaymentChineseField = document.getElementById('totalPaymentChinese');
        if (hasAllRequiredValues) {
            try {
                // 計算總繳款
                const totalPaymentValue = payment * period;
                const roundedTotalPayment = Math.round(totalPaymentValue);
                
                // 轉換總繳款為中文國字大寫
                const totalPaymentChinese = arabicToChineseNumber(roundedTotalPayment, 'financial') + ' 元整';
                totalPaymentChineseField.innerHTML = totalPaymentChinese; // 使用 innerHTML 以支持HTML標籤
            } catch (error) {
                console.error('總繳款中文轉換錯誤:', error);
                totalPaymentChineseField.textContent = '轉換錯誤';
            }
        } else {
            totalPaymentChineseField.innerHTML = ''; // 清空顯示
        }

        // 在更新值之前保存舊值
        const oldValues = {};
        const fieldsToTrack = ['totalInterest', 'afterTaxRate', 'spread'];
        fieldsToTrack.forEach(field => {
            oldValues[field] = document.getElementById(field).value;
        });

        // 在更新後檢查變化
        fieldsToTrack.forEach(field => {
            const newValue = document.getElementById(field).value;
            if (oldValues[field] !== newValue) {
                animateValueChange(field);
            }
        });

        // ============================================
        // 更新頂部固定header的利率顯示
        // 說明：將計算結果同步顯示到頂部固定的header區域
        // 包含數值更新和警告樣式的同步處理
        // ============================================

        // 取得頂部header中的兩個利率顯示輸入框元素
        const headerAfterCommissionOnlyRate = document.getElementById('headerAfterCommissionOnlyRate');
        const headerAfterCommissionRate = document.getElementById('headerAfterCommissionRate');

        // 更新佣後利率到header顯示區域
        if (headerAfterCommissionOnlyRate) {
            // 從主要計算區域的佣後利率輸入框取得當前計算結果
            const afterCommissionOnlyValue = document.getElementById('afterCommissionOnlyRate').value;
            // 將計算結果同步到header的佣後利率顯示框
            headerAfterCommissionOnlyRate.value = afterCommissionOnlyValue;
            
            // 同步警告樣式處理：如果主要區域有警告樣式，header也要顯示警告
            if (document.getElementById('afterCommissionOnlyRate').classList.contains('warning-text')) {
                // 主要區域有警告（通常是利率過低），header也要顯示警告樣式
                headerAfterCommissionOnlyRate.classList.add('warning-text');
            } else {
                // 主要區域沒有警告，移除header的警告樣式
                headerAfterCommissionOnlyRate.classList.remove('warning-text');
            }
        }

        // 更新稅佣後利率到header顯示區域
        if (headerAfterCommissionRate) {
            // 從主要計算區域的稅佣後利率輸入框取得當前計算結果
            const afterCommissionValue = document.getElementById('afterCommissionRate').value;
            // 將計算結果同步到header的稅佣後利率顯示框
            headerAfterCommissionRate.value = afterCommissionValue;
            
            // 同步警告樣式處理：如果主要區域有警告樣式，header也要顯示警告
            if (document.getElementById('afterCommissionRate').classList.contains('warning-text')) {
                // 主要區域有警告（通常是利率過低或計算錯誤），header也要顯示警告樣式
                headerAfterCommissionRate.classList.add('warning-text');
            } else {
                // 主要區域沒有警告，移除header的警告樣式
                headerAfterCommissionRate.classList.remove('warning-text');
            }
        }

        // ========== 自動保存當前計算數據 ==========
        // 說明：每次欄位更新時，自動將當前的計算數據保存到瀏覽器的本地儲存
        // 這樣即使頁面意外重新整理，數據也不會丟失
        try {
            // 收集需要保存的數據
            const autoSaveData = {
                period: document.getElementById('period').value,                    // 期數
                rate: document.getElementById('rate').value,                        // 稅前利率
                principal: document.getElementById('principal').value,              // 本金
                payment: document.getElementById('payment').value,                  // 期繳
                commission: document.getElementById('commission').value,            // 推廣費
                monthlyCost: document.getElementById('monthlyCost').value,          // 資金成本
                timestamp: new Date().toISOString(),                                // 保存時間戳記
                version: 'v1'                                                       // 版本號，方便未來升級
            };
            
            // 只有在有實際數據時才保存（避免保存空白數據）
            if (autoSaveData.period || autoSaveData.rate || autoSaveData.principal || autoSaveData.payment) {
                // 將數據保存到瀏覽器的本地儲存
                localStorage.setItem('loanCalculatorAutoSave', JSON.stringify(autoSaveData));
                
                // 在控制台記錄（方便除錯）
                console.log('自動保存計算數據:', autoSaveData);
            }
        } catch (error) {
            // 如果保存失敗，記錄錯誤但不影響正常功能
            console.error('自動保存失敗:', error);
        }
        // ========== 自動保存結束 ==========

    }

    // 在 clearField 函數之前添加這個新函數
    // 修改 validatePrincipalInput 函数
    function validatePrincipalInput(input) {
        // 移除负号，确保为正整数
        let value = Math.floor(Math.abs(parseFloat(input.value))) || 0;
        
        // 如果输入为0，设置为最小值1
        if (value <= 0) {
            value = 1;
        }
        
        // 更新输入框值并格式化
        input.value = formatNumberWithCommas(value);
        
        // 更新相关计算
        updateAllFields();
    }

    function clearField(fieldId) {
        vibrate();
        document.getElementById(fieldId).value = '';
    }

    function clearCommission() {
        vibrate();
        document.getElementById('commission').value = '';
        updateAllFields(); // 更新所有欄位
    }

    function adjustPeriod(delta) {
        vibrate();
        const periodField = document.getElementById('period');
        const currentValue = parseFloat(periodField.value) || 0;
        periodField.value = currentValue + delta;
        calculatePayment();
    }

    function setPeriod(value) {
        vibrate();
        document.getElementById('period').value = value;
        
        // 檢查其他必要輸入是否已有值
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        
        if (!isNaN(rate) && !isNaN(principal) && rate > 0 && principal > 0) {
            calculatePayment(); // 只有當其他必要值都存在時才計算
        }
    }

    function adjustRate(delta) {
        vibrate();
        const rateField = document.getElementById('rate');
        const currentValue = parseFloat(rateField.value) || 0;
        const newRate = currentValue + delta;
        
        // 檢查新利率是否超過20%
        if (newRate > 20) {
            showToast('警告：利率超過20%，可能不符合一般貸款條件', true);
        }
        
        rateField.value = newRate.toFixed(4);
        calculatePayment();
    }

    function setRate(value) {
        vibrate();
        // 檢查新利率是否超過20%
        if (value > 20) {
            showToast('警告：利率超過20%，可能不符合一般貸款條件', true);
        }
        
        document.getElementById('rate').value = value;
        calculatePayment();
    }

    function validateCommissionInput(input) {
        // 移除小數點
        let value = parseInt(input.value) || 0;
        
        // 如果是負數，設為0
        if (value < 0) {
            value = 0;
        }
        
        // 更新輸入框的值為整數
        input.value = Math.floor(value);
        
        // 更新相關計算
        updateAllFields();
    }

    function adjustCommission(delta) {
        vibrate();
        const commissionField = document.getElementById('commission');
        
        // ============================================
        // 取得當前值的處理
        // 說明：如果欄位為空，從0開始計算；如果有值，則基於現有值調整
        // ============================================
        let currentValue = 0;
        
        // 檢查欄位是否為空
        if (commissionField.value && commissionField.value.trim() !== '') {
            // 如果有值，解析該值
            currentValue = parseFloat(commissionField.value.replace(/,/g, '')) || 0;
        }
        // 如果欄位為空，currentValue 保持為 0
        
        // 計算新值
        const newValue = Math.max(0, currentValue + delta);
        
        // ============================================
        // 更新輸入框的值
        // 說明：如果新值為0且原本欄位是空的，保持空白
        // ============================================
        if (newValue === 0 && (!commissionField.value || commissionField.value.trim() === '')) {
            // 如果計算結果是0且原本欄位是空的，保持空白
            commissionField.value = '';
        } else {
            // 否則顯示格式化的數值
            commissionField.value = formatNumberWithCommas(Math.floor(newValue));
        }
        
        // 更新所有相關欄位的計算
        updateAllFields();
    }

    function setCommissionPercent(percent) {
        vibrate(); // 觸發震動
        
        // 獲取本金值（移除千位分隔符）
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, '')) || 0;
        
        if (principal <= 0) {
            showToast('請先輸入有效的本金金額', true);
            return;
        }
        
        // 計算對應百分比的金額，並無條件捨去至整數
        const commissionAmount = Math.floor(principal * (percent / 100));
        
        // 更新推廣輸入框的值，並添加千位分隔符
        document.getElementById('commission').value = formatNumberWithCommas(commissionAmount);
        
        // 更新相關欄位的計算
        updateAllFields();
    }

    // 修改 adjustPrincipal 函数
    function adjustPrincipal(delta) {
        vibrate();
        const principalField = document.getElementById('principal');
        // 移除千位分隔符后再转换为数字
        const currentValue = parseFloat(principalField.value.replace(/,/g, '')) || 0;
        // 计算新值，确保是正整数
        const newValue = Math.max(1, Math.floor(currentValue + delta)); // 确保最小值为1且为整数
        // 添加千位分隔符显示
        principalField.value = formatNumberWithCommas(newValue);
        calculatePayment();
        updateAllFields();
    }

    // 修改 roundPayment 函数以保持正数限制
    function roundPayment(direction, base) {
        vibrate();
        const paymentField = document.getElementById('payment');
        // 移除千位分隔符后再转换为数字
        let value = parseFloat(paymentField.value.replace(/,/g, '')) || 0;
        
        if (direction === 'down') {
            value = Math.floor(value / base) * base;
        } else {
            value = Math.ceil(value / base) * base;
        }
        
        // 确保值为正整数
        value = Math.max(1, Math.round(value));
        
        // 添加千位分隔符显示，不再保留小數位
        paymentField.value = formatNumberWithCommas(value);
        calculateRate(); // 确保这个调用能正确计算税前利率
    }

    // 修改 adjustPayment 函数
    function adjustPayment(delta) {
        vibrate();
        const paymentField = document.getElementById('payment');
        // 移除千位分隔符后再转换为数字
        const currentValue = parseFloat(paymentField.value.replace(/,/g, '')) || 0;
        // 计算新值，确保是正整数
        const newValue = Math.max(1, Math.round(currentValue + delta)); // 使用Math.round確保是整數
        // 添加千位分隔符显示，不再保留小數
        paymentField.value = formatNumberWithCommas(newValue);
        calculateRate(); // 确保这个调用能正确计算税前利率
    }

    function saveData() {
        const dataToSave = {
        period: document.getElementById('period').value,
        rate: document.getElementById('rate').value,
        principal: document.getElementById('principal').value,
        payment: document.getElementById('payment').value,
        commission: document.getElementById('commission').value
        };
        localStorage.setItem('loanCalculatorData', JSON.stringify(dataToSave));
        alert('資料已暫存！');
    }

    document.addEventListener('DOMContentLoaded', function() {
        // 為相關輸入欄位添加事件監聽
        const inputIds = ['period', 'payment', 'principal', 'monthlyCost'];
        inputIds.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', updateAllFields);
                element.addEventListener('change', updateAllFields);
            }
        });
    });

    // 添加數值變化動畫
        function animateValueChange(elementId) {
        const element = document.getElementById(elementId);
        element.classList.remove('value-changed');
        void element.offsetWidth; // 觸發重繪
        element.classList.add('value-changed');
    }
    

    // 保存貸款計算結果
    // 說明：將貸款計算結果儲存到瀏覽器的本地儲存空間
    function saveLoanData() {
        const period = document.getElementById('period').value;
        const rate = document.getElementById('rate').value;
        const principal = document.getElementById('principal').value.replace(/,/g, '');
        const payment = document.getElementById('payment').value.replace(/,/g, '');
        const afterTaxRate = document.getElementById('afterTaxRate').value;
        const commission = document.getElementById('commission').value.replace(/,/g, '');
        const afterCommissionRate = document.getElementById('afterCommissionRate').value;
        
        // 檢查必要字段是否填寫
        if (!period || !rate || !principal || !payment) {
            showToast('請先完成必要欄位（期數、利率、本金、期繳）的計算！');
            return;
        }
        
        // 取得當前日期時間
        const loanDate = new Date();
        const year = loanDate.getFullYear();
        const month = String(loanDate.getMonth() + 1).padStart(2, '0');
        const date = String(loanDate.getDate()).padStart(2, '0');
        const hours = String(loanDate.getHours()).padStart(2, '0');
        const minutes = String(loanDate.getMinutes()).padStart(2, '0');
        const formattedDate = `${year}-${month}-${date} ${hours}:${minutes}`;
        
        const loanData = {
            id: new Date().getTime(),
            date: formattedDate,
            period: period,
            rate: rate,
            principal: principal,
            payment: payment,
            afterTaxRate: afterTaxRate,
            commission: commission || '0',
            afterCommissionRate: afterCommissionRate,
            totalInterest: document.getElementById('totalInterest').value.replace(/,/g, ''),
            timestamp: new Date().toISOString(),
            note: ''
        };
        
        // 儲存到瀏覽器本地儲存空間
        let loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        loanHistory.push(loanData);
        localStorage.setItem('loanHistory', JSON.stringify(loanHistory));
        
        // 顯示儲存成功訊息
        showToast('貸款計算結果已保存！');
    }

    // 顯示多貸款比較視圖
    function showMultiLoanComparison(loans) {
        vibrate();
        
        // 確保至少有2個貸款方案
        if (loans.length < 2) {
            showToast('至少需要2個貸款方案進行比較');
            return;
        }
        
        // 關閉歷史記錄面板
        document.getElementById('historyPanel').style.display = 'none';
        
        // 生成表格HTML（已移除分頁標籤，直接顯示表格）
        let tableHTML = `
        <!-- 直接顯示比較表格，不需要分頁 -->
        <div class="comparison-tab-content">
            <table class="comparison-table">
                <tr>
                    <th>項目</th>
                    ${loans.map((loan, index) => `<th>${loan.id === 'current' ? '目前計算' : '方案 ' + (index + 1)}</th>`).join('')}
                </tr>
                <tr>
                    <td>日期</td>
                    ${loans.map(loan => `<td>${loan.id === 'current' ? '目前計算' : formatDate(loan.date)}</td>`).join('')}
                </tr>
                <tr>
                    <td>期數</td>
                    ${loans.map(loan => `<td>${loan.period}</td>`).join('')}
                </tr>
                <tr>
                    <td>稅前利率</td>
                    ${loans.map(loan => `<td>${loan.rate}%</td>`).join('')}
                </tr>
                <tr>
                    <td>本金</td>
                    ${loans.map(loan => `<td>${formatNumberWithCommas(loan.principal)}</td>`).join('')}
                </tr>
                <tr>
                    <td>期繳</td>
                    ${loans.map(loan => `<td>${formatNumberWithCommas(loan.payment)}</td>`).join('')}
                </tr>
                <tr>
                    <td>總利息</td>
                    ${loans.map(loan => `<td>${formatNumberWithCommas(loan.totalInterest)}</td>`).join('')}
                </tr>
                <tr>
                    <td>稅後利率</td>
                    ${loans.map(loan => `<td>${loan.afterTaxRate}%</td>`).join('')}
                </tr>
                <tr>
                    <td>推廣費</td>
                    ${loans.map(loan => `<td>${formatNumberWithCommas(loan.commission)}</td>`).join('')}
                </tr>
                <tr class="highlight-row">
                    <td>稅佣後利率</td>
                    ${loans.map(loan => `<td>${loan.afterCommissionRate}%</td>`).join('')}
                </tr>
                <tr class="highlight-row">
                    <td>總還款</td>
                    ${loans.map(loan => {
                        const totalPayment = parseFloat(loan.payment) * parseFloat(loan.period);
                        /* 修改為只顯示整數，不顯示小數 */
                        return `<td>${formatNumberWithCommas(Math.round(totalPayment))}</td>`;
                    }).join('')}
                </tr>

                <!-- 新增備註比較欄位 -->
                <tr>
                    <td style="vertical-align: top;">備註</td>
                    ${loans.map(loan => {
                        /* 顯示備註內容，如果沒有備註則顯示"無" */
                        const noteContent = loan.note || '無';
                        return `<td style="
                            font-size: 13px;
                            line-height: 1.4;
                            padding: 10px;
                            vertical-align: top;
                        ">${noteContent}</td>`;
                    }).join('')}
                </tr>

            </table>
        </div>
        `;
        
        // 創建模態框
        const modalHTML = `
        <!-- 貸款方案比較頁面標題區域 - 新增回上頁按鈕 -->
        <div class="modal-header" style="position: relative;">
            <!-- 左側：回上頁按鈕（修改為直接返回歷史記錄頁面） -->
            <button onclick="backToHistoryPanel()" style="
                position: absolute;
                left: 15px;
                top: 50%;
                transform: translateY(-50%);
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: var(--text-color);
                padding: 6px 12px;
                border-radius: 6px;
                font-size: 14px;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 4px;
            " onmouseover="this.style.backgroundColor='rgba(255, 255, 255, 0.2)'; this.style.borderColor='var(--accent-color)';" 
            onmouseout="this.style.backgroundColor='rgba(255, 255, 255, 0.1)'; this.style.borderColor='rgba(255, 255, 255, 0.2)';">
                <span style="font-size: 16px;">←</span>
                <span>回上頁</span>
            </button>
            
            <!-- 中間：標題 -->
            <h3 style="margin: 0; flex: 1; text-align: center;">貸款方案比較</h3>
            
            <!-- 右側：關閉按鈕 -->
            <button class="close-btn" onclick="closeCustomModal('multiLoanComparisonModal')">×</button>
        </div>
        <div class="modal-content" style="padding: 10px; flex: 1; overflow-y: auto; background-color: var(--primary-color);">
            ${tableHTML}
        </div>
        `;
        
        // 創建並顯示全螢幕模態框
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        modalOverlay.id = 'multiLoanComparisonModal';
        modalOverlay.style.cssText = 'display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--primary-color); z-index: 9999;';
        modalOverlay.innerHTML = `<div class="modal-container" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%; margin: 0; border-radius: 0; display: flex; flex-direction: column;">${modalHTML}</div>`;

        // 添加到網頁
        document.body.appendChild(modalOverlay);

        // 點擊背景關閉（移除此功能以確保全螢幕）
        // modalOverlay.addEventListener('click', function(event) {
        //     if (event.target === this) {
        //         closeCustomModal('multiLoanComparisonModal');
        //     }
        // });

        vibrate();
        
        // 添加樣式
        const style = document.createElement('style');
        style.textContent = `
            
            .comparison-tab-content {
                padding: 10px 0;
            }
            
            /* 比較表格樣式 - 與整體設計風格統一 */
            .comparison-table {
                width: 100%;
                border-collapse: separate;
                border-spacing: 0;
                font-size: 14px;
                background: var(--secondary-color);
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 12px var(--shadow-color);
            }

            /* 表格標題和單元格樣式 */
            .comparison-table th, 
            .comparison-table td {
                padding: 12px 10px;
                text-align: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            /* 表格標題樣式 - 深色背景 */
            .comparison-table th {
                background: linear-gradient(135deg, 
                    rgba(var(--accent-color-rgb), 0.2) 0%, 
                    rgba(var(--accent-color-rgb), 0.1) 100%);
                color: var(--text-color);
                font-weight: 600;
                position: sticky;
                top: 0;
                z-index: 10;
                font-size: 15px;
            }

            /* 第一列（項目名稱）特殊樣式 */
            .comparison-table td:first-child {
                text-align: left;
                font-weight: 600;
                color: var(--accent-color);
                background: rgba(255, 255, 255, 0.03);
                padding-left: 15px;
            }

            /* 表格列懸停效果 */
            .comparison-table tr:hover td {
                background-color: rgba(255, 255, 255, 0.05);
                transition: background-color 0.2s ease;
            }

            /* 強調列樣式 - 用於重要數據 */
            .highlight-row td {
                background-color: rgba(var(--accent-color-rgb), 0.08);
                font-weight: 600;
            }

            /* 最後一列無底部邊框 */
            .comparison-table tr:last-child td {
                border-bottom: none;
            }
        `;
        document.head.appendChild(style);
    }

    // 顯示貸款比較模態框
    function showLoanComparisonModal(loan1, loan2) {
        // 創建比較模態框的HTML
        const modalHTML = `
        <div class="modal-header">
            <h3>貸款方案比較</h3>
            <button class="close-btn" onclick="closeLoanComparisonModal()">×</button>
        </div>
        <div class="modal-content" style="flex: 1; overflow-y: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <th style="text-align: left; padding: 8px; border-bottom: 1px solid var(--border-color);">項目</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">方案1</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">方案2</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">差異</th>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">期數</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan1.period}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan2.period}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan2.period - loan1.period}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">稅前利率</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan1.rate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan2.rate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${(parseFloat(loan2.rate) - parseFloat(loan1.rate)).toFixed(4)}%</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">本金</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan1.principal)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.principal)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.principal - loan1.principal)}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">期繳</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan1.payment)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.payment)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.payment - loan1.payment)}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">總利息</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan1.totalInterest)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.totalInterest)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.totalInterest - loan1.totalInterest)}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">稅後利率</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan1.afterTaxRate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan2.afterTaxRate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${(parseFloat(loan2.afterTaxRate) - parseFloat(loan1.afterTaxRate)).toFixed(4)}%</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">推廣</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan1.commission)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.commission)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.commission - loan1.commission)}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">稅佣後利率</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan1.afterCommissionRate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan2.afterCommissionRate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${(parseFloat(loan2.afterCommissionRate) - parseFloat(loan1.afterCommissionRate)).toFixed(4)}%</td>
                </tr>
            </table>
            
            <div style="margin-top: 20px; padding: 15px; background-color: var(--secondary-color); border-radius: 8px;">
                <h4 style="margin-top: 0; color: var(--accent-color);">方案比較摘要</h4>
                <p>總成本差異: ${formatNumberWithCommas(Math.round((parseFloat(loan2.totalInterest) + parseFloat(loan2.commission)) - (parseFloat(loan1.totalInterest) + parseFloat(loan1.commission))))} 元</p>
                <p>月付款差異: ${formatNumberWithCommas(Math.round(loan2.payment - loan1.payment))} 元/月</p>
                <p>實際利率差異: ${(parseFloat(loan2.afterCommissionRate) - parseFloat(loan1.afterCommissionRate)).toFixed(4)}%</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn modal-btn-secondary" onclick="clearComparisonData()">清除比較</button>
            <button class="modal-btn modal-btn-primary" onclick="closeLoanComparisonModal()">關閉</button>
        </div>
        `;
        
        // 創建比較模態框
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        modalOverlay.id = 'loanComparisonModal';
        modalOverlay.style.display = 'flex';
        modalOverlay.innerHTML = `<div class="modal-container">${modalHTML}</div>`;
        
        // 添加到網頁
        document.body.appendChild(modalOverlay);
        
        // 添加背景點擊關閉功能
        modalOverlay.addEventListener('click', function(event) {
            if (event.target === this) {
                closeLoanComparisonModal();
            }
        });
        
        // 添加震動反饋
        vibrate();
    }

    // 關閉貸款比較模態框
    function closeLoanComparisonModal() {
        const modal = document.getElementById('loanComparisonModal');
        if (modal) {
            document.body.removeChild(modal);
        }
        
        // 添加震動反饋
        vibrate();
    }

    // 顯示/隱藏歷史記錄面板
    function toggleHistoryPanel() {
        const panel = document.getElementById('historyPanel');
        if (panel.style.display === 'block') {
            panel.style.display = 'none';
        } else {
            panel.style.display = 'block';
            loadHistoryData();
            
            // 添加一次性背景点击关闭事件
            panel.onclick = function(event) {
                if (event.target === this) {
                    this.style.display = 'none';
                }
            };
        }
    }

    // 載入歷史記錄
    // 修改 loadHistoryData 函数以使用新的设计
    function loadHistoryData() {
        const historyContent = document.getElementById('historyContent');
        const loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        
        if (loanHistory.length === 0) {
            historyContent.innerHTML = '<p class="no-data">尚無貸款計算記錄</p>';
            return;
        }
        
        // 按日期排序，最新的在前面
        loanHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        let html = '<div class="history-list">';
        loanHistory.forEach(loan => {
            // 确保数值正确显示，移除千位分隔符后再格式化
            const principalDisplay = formatNumber(loan.principal);
            const paymentDisplay = formatNumber(loan.payment);
            const commissionDisplay = formatNumber(loan.commission);
            
            html += `
                <div class="history-item" data-loan-id="${loan.id}">
                    <div class="history-item-header">
                        <div class="checkbox-date-container">
                            <input type="checkbox" class="history-item-checkbox" data-loan-id="${loan.id}" onchange="updateCompareButton()">
                            <div class="history-date">${formatDate(loan.date)}</div>
                        </div>
                        <div class="history-header-rate">稅佣後利率: ${parseFloat(loan.afterCommissionRate).toFixed(4)}%</div>
                    </div>
                    
                    <div class="history-details">
                        <div class="history-detail-item">
                            <span class="detail-label">期數</span>
                            <span class="detail-value">${loan.period}</span>
                        </div>
                        <div class="history-detail-item">
                            <span class="detail-label">推廣</span>
                            <span class="detail-value">${commissionDisplay}</span>
                        </div>
                        <div class="history-detail-item">
                            <span class="detail-label">本金</span>
                            <span class="detail-value">${principalDisplay}</span>
                        </div>
                        <div class="history-detail-item">
                            <span class="detail-label">期繳</span>
                            <span class="detail-value">${paymentDisplay}</span>
                        </div>
                    </div>

                    <div class="history-note-container">
                        <div class="history-item-footer">
                            <div class="history-note-preview ${loan.note ? '' : 'empty-note'}" onclick="openNoteEditor(${loan.id}, '${loan.note || ''}')">
                                ${loan.note ? loan.note : '點擊添加備註'}
                            </div>
                            <div class="history-actions">
                                <button class="detail-btn" onclick="loadLoanToForm(${loan.id})">載入計算</button>
                                <button class="delete-btn" onclick="deleteLoan(${loan.id})">刪除</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        html += '</div>';
        
        historyContent.innerHTML = html;
    }

    // 更新比較按鈕狀態
    function updateCompareButton() {
        const checkboxes = document.querySelectorAll('.history-item-checkbox:checked');
        const compareButton = document.getElementById('compareSelectedBtn');
        
        // 如果有2個或以上選中的項目，啟用比較按鈕
        if (checkboxes.length >= 2) {
            compareButton.disabled = false;
        } else {
            compareButton.disabled = true;
        }
    }

    // 比較選中的貸款
    function compareSelectedLoans() {
        const checkboxes = document.querySelectorAll('.history-item-checkbox:checked');
        if (checkboxes.length < 2) {
            showToast('請至少選擇2個貸款方案進行比較');
            return;
        }
        
        // 獲取所有選中的貸款ID
        const selectedIds = Array.from(checkboxes).map(checkbox => 
            parseInt(checkbox.getAttribute('data-loan-id'))
        );
        
        // 從歷史記錄中獲取選中的貸款數據
        const loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        const selectedLoans = loanHistory.filter(loan => selectedIds.includes(loan.id));
        
        // 顯示比較視圖
        showMultiLoanComparison(selectedLoans);
    }

    function openNoteEditor(loanId, existingNote = '') {
        // 創建備註編輯器模態框
        const noteEditorModal = document.createElement('div');
        noteEditorModal.className = 'note-editor-modal';
        noteEditorModal.id = 'noteEditorModal';
        noteEditorModal.innerHTML = `
            <div class="note-editor-content">
                <h3>備註編輯</h3>
                <textarea id="noteEditorInput" class="note-editor-input" placeholder="請輸入備註內容...">${existingNote}</textarea>
                <div class="note-editor-buttons">
                    <button onclick="closeNoteEditor(false)" class="modal-btn modal-btn-secondary">取消</button>
                    <button onclick="saveNote(${loanId})" class="modal-btn modal-btn-primary">儲存</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(noteEditorModal);
        
        // 顯示模態框
        noteEditorModal.style.display = 'flex';
        
        // 自動聚焦到輸入框並調出鍵盤
        const noteInput = document.getElementById('noteEditorInput');
        noteInput.focus();
        
        // 添加點擊空白處關閉功能
        noteEditorModal.addEventListener('click', function(event) {
            if (event.target === this) {
                closeNoteEditor();
            }
        });
        
        // 監聽鍵盤彈出事件，進一步調整位置
        window.addEventListener('resize', adjustNoteEditorPosition);
        
        // 初始調整位置
        adjustNoteEditorPosition();
    }

    // 新增函數：調整備註編輯器位置
    function adjustNoteEditorPosition() {
        const modal = document.getElementById('noteEditorModal');
        if (!modal) return;
        
        // 偵測視窗高度變化來推測鍵盤是否彈出
        const windowHeight = window.innerHeight;
        const viewportHeight = window.visualViewport ? window.visualViewport.height : windowHeight;
        
        // 鍵盤彈出時會減少視口高度
        if (viewportHeight < windowHeight * 0.8) {
            // 鍵盤已彈出，將編輯器移至更靠頂部的位置
            modal.style.paddingTop = '180px';
            modal.style.justifyContent = 'center'; // 保持水平置中
        } else {
            // 鍵盤收起，恢復原本位置
            modal.style.paddingTop = '180px';
            modal.style.justifyContent = 'center'; // 保持水平置中
        }
    }

    function closeNoteEditor(isCancelled = true) {
        const noteEditorModal = document.getElementById('noteEditorModal');
        if (noteEditorModal) {
            document.body.removeChild(noteEditorModal);
        }
        
        // 移除事件監聽器
        window.removeEventListener('resize', adjustNoteEditorPosition);
    }

    // 儲存備註
    // 說明：將備註內容儲存到本地的歷史記錄中
    function saveNote(loanId) {
        const noteInput = document.getElementById('noteEditorInput');
        const newNote = noteInput.value.trim();
        
        // 獲取當前的歷史記錄
        let loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        
        // 找到對應的貸款記錄並更新備註
        const updatedHistory = loanHistory.map(loan => {
            if (loan.id === loanId) {
                return { ...loan, note: newNote };
            }
            return loan;
        });
        
        // 儲存更新後的歷史記錄
        localStorage.setItem('loanHistory', JSON.stringify(updatedHistory));
        
        // 關閉備註編輯器
        closeNoteEditor();
        
        // 重新載入歷史記錄
        loadHistoryData();
        
        // 顯示成功提示
        showToast('備註已儲存');
    }

    // 格式化日期顯示（包含時間）
    function formatDate(dateString) {
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');     // 小時（24小時制）
        const minutes = String(date.getMinutes()).padStart(2, '0'); // 分鐘
        
        // 返回格式：2024/03/15 14:30
        return `${year}/${month}/${day} ${hours}:${minutes}`;
    }

    // 修改 formatNumber 函数
    function formatNumber(num) {
        if (!num) return '0';
        
        // 如果是字符串且包含逗号，先去除千位分隔符
        if (typeof num === 'string') {
            num = num.replace(/,/g, '');
        }
        
        // 确保是数字，然后格式化
        return parseFloat(num).toLocaleString();
    }

    // 載入貸款記錄到表單
    function loadLoanToForm(id) {
        const loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        const loan = loanHistory.find(item => item.id === id);
        
        if (loan) {
            // 除了原有的載入邏輯外，不要重置備註
            document.getElementById('period').value = loan.period;
            document.getElementById('rate').value = loan.rate;
            
            document.getElementById('principal').value = formatNumberWithCommas(Math.round(parseFloat(loan.principal)));
            document.getElementById('payment').value = formatNumberWithCommas(Math.round(parseFloat(loan.payment)));
            document.getElementById('commission').value = formatNumberWithCommas(Math.round(parseFloat(loan.commission)));
            
            calculatePayment();
            updateAllFields();
            
            document.getElementById('historyPanel').style.display = 'none';
            
            showToast('已載入貸款計算資料');
            
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
    }

    // 刪除貸款記錄（增加確認步驟）
    // 說明：從本地儲存中刪除指定的貸款記錄
    function deleteLoan(id) {
        // 先顯示確認對話框
        showConfirmModal(
            '確認刪除', 
            '您確定要刪除這筆貸款記錄嗎？<br><br>此操作無法復原。', 
            function() {
                // 用戶確認後才執行刪除
                let loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
                loanHistory = loanHistory.filter(loan => loan.id !== id);
                localStorage.setItem('loanHistory', JSON.stringify(loanHistory));
                
                loadHistoryData(); // 重新載入歷史記錄
                showToast('貸款記錄已刪除！');
                
                // 觸覺反饋
                if (navigator.vibrate) {
                    navigator.vibrate([30, 20, 30]);
                }
            }
        );
    }

    // 確認是否刪除所有貸款記錄
    function confirmDeleteAll() {
        showConfirmModal('確認刪除', '確定要刪除所有貸款計算記錄嗎？此操作無法撤銷。', deleteAllLoans);
    }

    // 刪除所有貸款記錄
    // 說明：清空本地儲存中的所有貸款記錄
    function deleteAllLoans() {
        localStorage.removeItem('loanHistory');
        
        loadHistoryData(); // 重新載入歷史記錄（會顯示無記錄）
        showToast('所有貸款記錄已刪除！');
        
        // 觸覺反饋
        if (navigator.vibrate) {
            navigator.vibrate([50, 30, 50, 30, 50]);
        }
    }

    // 顯示一般模態框
    function showModal(title, content) {
        document.getElementById('modalTitle').textContent = title || '提示';
        document.getElementById('modalContent').innerHTML = content;
        document.getElementById('modalOverlay').style.display = 'flex';
        
        // 添加背景點擊關閉功能
        document.getElementById('modalOverlay').onclick = function(event) {
            if (event.target === this) {
                hideModal();
            }
        };
    }

    // 隱藏一般模態框
    function hideModal() {
        document.getElementById('modalOverlay').style.display = 'none';
    }

    // 顯示確認模態框
    function showConfirmModal(title, content, confirmCallback) {
        document.getElementById('confirmModalTitle').textContent = title || '確認';
        document.getElementById('confirmModalContent').innerHTML = content;
        document.getElementById('confirmModalOverlay').style.display = 'flex';
        
        // 設定確認按鈕點擊事件
        const confirmButton = document.getElementById('confirmModalOk');
        
        // 移除舊的事件監聽器（如果有的話）
        const newConfirmButton = confirmButton.cloneNode(true);
        confirmButton.parentNode.replaceChild(newConfirmButton, confirmButton);
        
        // 添加新的事件監聽器
        newConfirmButton.addEventListener('click', function() {
            hideConfirmModal();
            if (typeof confirmCallback === 'function') {
                confirmCallback();
            }
        });
        
        // 添加背景點擊關閉功能
        document.getElementById('confirmModalOverlay').onclick = function(event) {
            if (event.target === this) {
                hideConfirmModal();
            }
        };
    }

    // 隱藏確認模態框
    function hideConfirmModal() {
        document.getElementById('confirmModalOverlay').style.display = 'none';
    }

    // 顯示輕量級的提示訊息
    function showToast(message, isError = false, duration = 2000) {
        // 檢查是否已有 toast 存在
        const existingToast = document.querySelector('.toast-message');
        if (existingToast) {
            document.body.removeChild(existingToast);
        }
        
        // 創建一個新的 toast 元素
        const toast = document.createElement('div');
        toast.className = 'toast-message';
        if (isError) {
            toast.classList.add('toast-error');
        }
        toast.textContent = message;
        document.body.appendChild(toast);
        
        // 指定時間後自動消失
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 500);
        }, duration);
    }

    // 重置資金成本為預設值的函數
    function resetMonthlyCost() {
        // 震動效果
        vibrate();
        
        // 將資金成本設為預設值 2.2165
        document.getElementById('monthlyCost').value = '2.1904';
        
        // 更新所有相關計算
        updateAllFields();
        
        // 顯示提示訊息
        showToast('已重置資金成本為預設值');
    }

    // 清空所有欄位除了資金成本
    function clearAllFieldsExceptMonthlyCost() {
        // 震動效果
        vibrate();
        
        // 要清空的欄位ID列表
        const fieldsToReset = [
            'period', 'rate', 'principal', 'payment', 
            'totalPayment', 'totalInterest', 'tax', 'afterTaxRate', 
            'commission', 'commissionRatio', 'afterCommissionRate',
            'afterCommissionOnlyRate',     // 佣後利率
            'annualMillionInterest', 'monthlyMillionInterest',
            'annualTenThousandInterest', 'monthlyTenThousandInterest',
            'spread', 'fundingCost', 'monthlyInterest', 'yearlyInterest',
            'customerInvoice',             // 客戶發票
            'businessTax',                 // 營業稅
            'untaxedAmount',               // 未稅金額
            'chineseAmount',               // 中文國字大寫
            'totalPaymentChinese'          // 總繳大寫 

        ];
        
        // 清空每個欄位
        fieldsToReset.forEach(fieldId => {
            const element = document.getElementById(fieldId);
            if (element) {  // 檢查元素是否存在，避免錯誤
                // 檢查是否為特殊的 div 元素（中文大寫欄位）
                if (fieldId === 'chineseAmount' || fieldId === 'totalPaymentChinese') {
                    // 對於 div 元素，使用 innerHTML 來清空內容
                    element.innerHTML = '';
                } else {
                    // 對於一般 input 元素，使用 value 來清空
                    element.value = '';
                }
                // 移除任何警告樣式
                element.classList.remove('warning-text');
            }
        });

        // 將資金成本重置為預設值，而不是清空
        const monthlyCostElement = document.getElementById('monthlyCost');
        if (monthlyCostElement) {
            monthlyCostElement.value = '2.2165';
        }
        
        // 顯示提示訊息
        showToast('已清空所有欄位');

        // ============================================
        // 清空頂部header的利率顯示
        // 說明：當清除所有欄位時，同時清空header中的利率顯示
        // 並移除任何警告樣式，讓header回到初始狀態
        // ============================================

        // 取得頂部header中的兩個利率顯示輸入框元素
        const headerAfterCommissionOnlyRate = document.getElementById('headerAfterCommissionOnlyRate');
        const headerAfterCommissionRate = document.getElementById('headerAfterCommissionRate');

        // 清空佣後利率顯示
        if (headerAfterCommissionOnlyRate) {
            // 清空佣後利率的數值顯示
            headerAfterCommissionOnlyRate.value = '';
            // 移除任何警告樣式，讓顯示回到正常狀態
            headerAfterCommissionOnlyRate.classList.remove('warning-text');
        }

        // 清空稅佣後利率顯示
        if (headerAfterCommissionRate) {
            // 清空稅佣後利率的數值顯示
            headerAfterCommissionRate.value = '';
            // 移除任何警告樣式，讓顯示回到正常狀態
            headerAfterCommissionRate.classList.remove('warning-text');
        }

        // 清除自動保存的數據
        localStorage.removeItem('loanCalculatorAutoSave');
        console.log('已清除自動保存的數據');

    }

    // 全局變量
    let currentInputField = null;
    let calculatorValue = "0";
    let calculatorOperator = null;
    let calculatorFirstValue = null;
    let calculatorWaitingForSecondValue = false;
    let calculatorHistory = ""; // 新增：計算過程記錄

    // 開啟計算機輸入器
    function openCalculator(inputId, title) {
        currentInputField = inputId;
        document.getElementById('inputModalTitle').textContent = title;
        
        // 獲取當前輸入框的值
        const currentValue = document.getElementById(inputId).value;
        
        if (currentValue && currentValue !== '') {
            // 如果輸入框有值，使用該值初始化計算器
            calculatorValue = currentValue.replace(/,/g, ''); // 移除千位分隔符
            document.getElementById('calculatorDisplay').textContent = calculatorValue;
        } else {
            // 如果輸入框沒有值，使用 "0"
            calculatorValue = "0";
            document.getElementById('calculatorDisplay').textContent = calculatorValue;
        }
        
        calculatorOperator = null;
        calculatorFirstValue = null;
        calculatorWaitingForSecondValue = false;
        calculatorHistory = ""; // 清空計算歷史
        document.getElementById('calculatorHistory').textContent = ""; // 清空歷史顯示
        document.getElementById('historyScrollIndicator').style.opacity = '0'; // 隱藏滾動指示器
        
        document.getElementById('numberInputModal').style.display = 'flex';
        
        // 添加震動效果
        vibrate();
    }

    // 關閉模態框
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
        
        // 添加震動效果
        vibrate();
    }

    // 計算機數字輸入
    function calculatorInput(num) {
        if (calculatorWaitingForSecondValue) {
            calculatorValue = num.toString();
            calculatorWaitingForSecondValue = false;
        } else {
            calculatorValue = calculatorValue === '0' ? num.toString() : calculatorValue + num.toString();
        }
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // 添加震動效果
        vibrate();
    }

    // 計算機小數點輸入
    function calculatorDecimal() {
        // 如果正在等待第二個值，重置顯示
        if (calculatorWaitingForSecondValue) {
            calculatorValue = '0';
            calculatorWaitingForSecondValue = false;
        }
        
        // 如果當前值不包含小數點，則添加
        if (!calculatorValue.includes('.')) {
            calculatorValue += '.';
        }
        
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // 添加震動效果
        vibrate();
    }

    // 計算機清除
    function calculatorClear() {
        calculatorValue = '0';
        calculatorOperator = null;
        calculatorFirstValue = null;
        calculatorWaitingForSecondValue = false;
        calculatorHistory = ""; // 清空計算歷史
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        document.getElementById('calculatorHistory').textContent = ""; // 清空歷史顯示
        document.getElementById('historyScrollIndicator').style.opacity = '0'; // 隱藏滾動指示器
        
        // 添加震動效果
        vibrate();
    }

    // 計算機退格
    function calculatorBackspace() {
        if (calculatorValue.length > 1) {
            calculatorValue = calculatorValue.slice(0, -1);
        } else {
            calculatorValue = '0';
        }
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // 添加震動效果
        vibrate();
    }

    // 計算機運算符
    function calculatorOperation(op) {
        // 如果已經有運算符在等待，先進行計算
        if (calculatorFirstValue !== null && calculatorOperator !== null) {
            calculatorEquals();
        }
        
        calculatorFirstValue = parseFloat(calculatorValue);
        calculatorOperator = op;
        calculatorWaitingForSecondValue = true;
        
        // 更新計算歷史
        let opSymbol = op;
        switch(op) {
            case '+': opSymbol = ' + '; break;
            case '-': opSymbol = ' - '; break;
            case '*': opSymbol = ' × '; break;
            case '/': opSymbol = ' ÷ '; break;
        }
        
        // 添加當前數字和運算符到歷史記錄
        if (calculatorHistory === "") {
            calculatorHistory = calculatorValue + opSymbol;
        } else {
            // 檢查是否需要換行
            if (calculatorHistory.length > 20) {
                calculatorHistory += "\n" + calculatorValue + opSymbol;
            } else {
                calculatorHistory += calculatorValue + opSymbol;
            }
        }
        
        // 顯示計算歷史並檢查是否需要顯示滾動指示器
        updateCalculatorHistory();
        
        // 添加震動效果
        vibrate();
    }

    // 計算機等號
    function calculatorEquals() {
        if (calculatorFirstValue === null || calculatorOperator === null) return;
        
        const secondValue = parseFloat(calculatorValue);
        let result;
        
        // 完成歷史記錄的運算式
        let completeExpression = calculatorHistory + calculatorValue + " = ";
        
        switch (calculatorOperator) {
            case '+':
                result = calculatorFirstValue + secondValue;
                break;
            case '-':
                result = calculatorFirstValue - secondValue;
                break;
            case '*':
                result = calculatorFirstValue * secondValue;
                break;
            case '/':
                // 增加除零檢查
                if (secondValue === 0) {
                    showToast('錯誤：不能除以零', true);
                    calculatorClear();
                    return;
                }
                result = calculatorFirstValue / secondValue;
                break;
            default:
                return;
        }
        
        // 限制小數點位數，但保留有意義的數字
        calculatorValue = result.toString();
        if (calculatorValue.includes('.')) {
            // 如果是小數，限制最多顯示8位，但去除尾部無意義的零
            calculatorValue = parseFloat(result.toFixed(8)).toString();
        }
        
        // 更新顯示
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // 更新歷史記錄，保持較短的顯示
        if (completeExpression.length > 30) {
            // 如果表達式太長，只顯示最後的等號部分
            calculatorHistory = calculatorValue;
        } else {
            // 如果表達式不太長，顯示完整表達式
            calculatorHistory = completeExpression;
        }
        
        // 顯示計算歷史並檢查是否需要顯示滾動指示器
        updateCalculatorHistory();
        
        // 為下一次計算準備
        calculatorOperator = null;
        calculatorFirstValue = parseFloat(calculatorValue);
        calculatorWaitingForSecondValue = true;
        
        // 添加震動效果
        vibrate();
    }

    // 修改 submitCalculatorValue 函数
    function submitCalculatorValue() {
        if (!currentInputField) return;
        
        let value = parseFloat(calculatorValue);
        if (isNaN(value)) value = 0;
        
        // 根据不同输入框进行验证
        switch (currentInputField) {
            case 'period':
                // 期数不需要千位分隔符
                value = Math.floor(value);
                if (value < 0) {
                    showToast('錯誤：期數不能為負數', true);
                    return;
                }
                if (value > 999) {
                    showToast('錯誤：期數不能超過3位數', true);
                    return;
                }
                document.getElementById(currentInputField).value = value;
                break;
                
                case 'rate':
                    // 利率不需要千位分隔符
                    if (value < 0) {
                        showToast('錯誤：利率不能為負數', true);
                        return;
                    }
                    if (value > 20) {
                        showToast('警告：利率超過20%，可能不符合一般貸款條件', true);
                        // 允許超過20%的利率，但顯示警告
                    }
                    document.getElementById(currentInputField).value = value.toFixed(4);
                    break;
                
            case 'principal':
                // 本金需要千位分隔符并且只能是正整数
                value = Math.floor(value); // 确保是整数
                if (value <= 0) {
                    showToast('錯誤：本金必須是正整數', true);
                    return;
                }
                if (value > 999999999) {
                    showToast('錯誤：本金不能超過9位數', true);
                    return;
                }
                document.getElementById(currentInputField).value = formatNumberWithCommas(value);
                break;
                
            case 'payment':
                // 期繳必须是正整数
                value = Math.max(1, Math.round(value)); // 改為取整數
                if (value > 999999) {
                    showToast('錯誤：期繳款金額不能超過6位數', true);
                    return;
                }
                document.getElementById(currentInputField).value = formatNumberWithCommas(value);
                break;
                
            case 'commission':
                // 推廣需要千位分隔符
                value = Math.floor(value);
                if (value < 0) {
                    showToast('錯誤：推廣費必須為正整數', true);
                    return;
                }
                if (value > 999999) {
                    showToast('錯誤：推廣費不能超過6位數', true);
                    return;
                }
                document.getElementById(currentInputField).value = formatNumberWithCommas(value);
                break;

            case 'monthlyCost':
                // 資金成本不需要千位分隔符，保留4位小數
                if (value < 0) {
                    showToast('錯誤：資金成本不能為負數', true);
                    return;
                }
                if (value > 20) {
                    showToast('錯誤：資金成本不能超過20', true);
                    return;
                }
                // 限制在0.0000到20.0000之間，並保留4位小數
                value = Math.max(0, Math.min(20, value));
                document.getElementById(currentInputField).value = value.toFixed(4);
                break;
        }
        
        // 触发 change 事件以更新相关计算
        const event = new Event('change');
        document.getElementById(currentInputField).dispatchEvent(event);
        
        // 关闭模态框
        closeModal('numberInputModal');
        
        // 根據欄位執行相應的計算函數
        if (currentInputField === 'period' || currentInputField === 'rate' || currentInputField === 'principal') {
            calculatePayment();
        } else if (currentInputField === 'payment') {
            calculateRate();
        } else if (currentInputField === 'commission' || currentInputField === 'monthlyCost') {
            // 推廣費或資金成本改變時，更新所有相關計算
            updateAllFields();
        }
        
        // 添加震动效果
        vibrate();
    }

    // 显示提示信息（可重用现有的 showToast 函数，如果没有的话添加这个）
    function showToast(message, isError = false) {
        // 检查是否已有 toast
        const existingToast = document.querySelector('.toast-message');
        if (existingToast) {
            document.body.removeChild(existingToast);
        }
        
        // 创建新的 toast
        const toast = document.createElement('div');
        toast.className = 'toast-message';
        if (isError) {
            toast.classList.add('toast-error');
        }
        toast.textContent = message;
        document.body.appendChild(toast);
        
        // 2秒后自动消失
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 500);
        }, 2000);
    }

    // 格式化数字 - 添加千位分隔符
    function formatNumberWithCommas(num) {
        if (!num && num !== 0) return '';
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // 更新计算历史显示，并检查是否需要显示滚动指示器
    function updateCalculatorHistory() {
        const historyElement = document.getElementById('calculatorHistory');
        const indicatorElement = document.getElementById('historyScrollIndicator');
        
        // 更新历史内容
        historyElement.textContent = calculatorHistory;
        
        // 检查是否内容溢出需要显示滚动指示器
        const isOverflowing = historyElement.scrollWidth > historyElement.clientWidth || 
                            historyElement.scrollHeight > historyElement.clientHeight;
        
        if (isOverflowing) {
            historyElement.classList.add('has-overflow');
        } else {
            historyElement.classList.remove('has-overflow');
        }
    }

    function countFilledFields() {
        const period = document.getElementById('period').value;
        const rate = document.getElementById('rate').value;
        const principal = document.getElementById('principal').value;
        const payment = document.getElementById('payment').value;
        
        let count = 0;
        if (period && period !== '0') count++;
        if (rate && rate !== '0') count++;
        if (principal && principal !== '0') count++;
        if (payment && payment !== '0') count++;
        
        return count;
    }

    // 通用的模態框顯示函數
    function showCustomModal(id, html) {
        // 創建模態框
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        modalOverlay.id = id;
        modalOverlay.style.display = 'flex';
        
        // ============================================
        // 已移除期數方案對比的特殊處理
        // 現在所有模態框都使用標準樣式
        // ============================================
        modalOverlay.innerHTML = `<div class="modal-container">${html}</div>`;
        
        // 添加到網頁
        document.body.appendChild(modalOverlay);
        
        // 點擊背景關閉
        modalOverlay.addEventListener('click', function(event) {
            if (event.target === this) {
                closeCustomModal(id);
            }
        });
        
        vibrate();
    }

    // 通用的模態框關閉函數
    function closeCustomModal(id) {
        const modal = document.getElementById(id);
        if (modal) {
            document.body.removeChild(modal);
        }
        vibrate();
    }

    // ============================================
    // 從貸款比較頁面返回歷史記錄頁面
    // 說明：關閉比較頁面並重新顯示歷史記錄面板
    // ============================================
    function backToHistoryPanel() {
        // 觸發震動反饋
        vibrate();
        
        // 關閉當前的比較頁面
        closeCustomModal('multiLoanComparisonModal');
        
        // 延遲一點時間後顯示歷史記錄頁面，確保動畫流暢
        setTimeout(() => {
            // 顯示歷史記錄面板
            const historyPanel = document.getElementById('historyPanel');
            if (historyPanel) {
                historyPanel.style.display = 'block';
                // 重新載入歷史記錄數據
                loadHistoryData();
            } else {
                // 如果找不到歷史記錄面板，顯示錯誤提示
                showToast('無法返回歷史記錄頁面');
            }
        }, 300); // 300毫秒的延遲，確保關閉動畫完成
    }

    // 关闭子选单
    function closeSubmenu(submenuId) {
        const submenu = document.getElementById(submenuId);
        if (submenu) {
            const submenuContent = submenu.querySelector('.submenu-content');
            
            // 添加关闭动画
            submenuContent.classList.add('submenu-closing');
            
            // 动画结束后隐藏子选单
            setTimeout(function() {
                submenu.style.display = 'none';
                submenuContent.classList.remove('submenu-closing');
            }, 200); // 与动画时长相匹配
            
            vibrate(); // 使用现有的震动函数
        }
    }

    // 通用的模態框顯示函數
    function showCustomModal(id, html) {
        // 創建模態框
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        modalOverlay.id = id;
        modalOverlay.style.display = 'flex';
        modalOverlay.innerHTML = `<div class="modal-container">${html}</div>`;
        
        // 添加到網頁
        document.body.appendChild(modalOverlay);
        
        // 點擊背景關閉
        modalOverlay.addEventListener('click', function(event) {
            if (event.target === this) {
                closeCustomModal(id);
            }
        });
        
        vibrate();
    }

    // 通用的模態框關閉函數
    function closeCustomModal(id) {
        const modal = document.getElementById(id);
        if (modal) {
            document.body.removeChild(modal);
        }
        vibrate();
    }

    // 阿拉伯數字轉中文國字大寫函數
    function arabicToChineseNumber(num, format) {
        if (!num || num === '0' || num === 0) {
            return format === 'financial' ? '<span class="financial-digit">零</span>' : '零';
        }
        
        // 分割整數和小數部分
        const parts = num.toString().split('.');
        const integerPart = parts[0];
        const decimalPart = parts.length > 1 ? parts[1] : '';
        
        // 根據格式選擇對應的字符
        let digits, units;
        if (format === 'traditional') {
            digits = ['零', '一', '二', '三', '四', '五', '六', '七', '八', '九'];
            units = ['', '十', '百', '千', '萬', '十', '百', '千', '億', '十', '百', '千', '兆'];
        } else if (format === 'financial') {
            digits = ['零', '壹', '貳', '參', '肆', '伍', '陸', '柒', '捌', '玖'];
            units = ['', '拾', '佰', '仟', '萬', '拾', '佰', '仟', '億', '拾', '佰', '仟', '兆'];
        }
        
        // 處理整數部分
        let intResult = '';
        if (integerPart === '0') {
            intResult = format === 'financial' ? '<span class="financial-digit">零</span>' : digits[0];
        } else {
            const len = integerPart.length;
            
            // 特殊處理10-19的數字
            if (format !== 'financial' && len === 2 && integerPart.charAt(0) === '1') {
                intResult = units[1];
                if (integerPart.charAt(1) !== '0') {
                    intResult += digits[parseInt(integerPart.charAt(1))];
                }
            } else {
                // 新增變量來追蹤上一個處理過的字符是否為零，以及是否已經添加了單位
                let lastWasZero = false;
                let hasAddedUnit = false;
                
                for (let i = 0; i < len; i++) {
                    const digit = parseInt(integerPart.charAt(i));
                    const pos = len - i - 1;
                    
                    if (digit !== 0) {
                        // 非零數字直接轉換並加上單位
                        lastWasZero = false;
                        hasAddedUnit = false;
                        
                        // 在 financial 格式中為數字添加特殊標籤
                        if (format === 'financial') {
                            intResult += `<span class="financial-digit">${digits[digit]}</span>${units[pos]}`;
                        } else {
                            intResult += digits[digit] + units[pos];
                        }
                    } else {
                        // 處理零的特殊規則
                        if (pos === 4 || pos === 8) {
                            // 萬位或億位的零，需要加上對應的單位，但不需要加上"零"字
                            if (intResult.length > 0) {
                                // 確保沒有連續加入同一單位
                                if (!intResult.endsWith(units[4]) && !intResult.endsWith(units[8])) {
                                    intResult += units[pos];
                                    hasAddedUnit = true;
                                }
                            }
                        } else if (i < len - 1 && integerPart.charAt(i + 1) !== '0' && !lastWasZero) {
                            // 當前數字是0，下一個不是0，且上一個不是0，加上零
                            if (format === 'financial') {
                                intResult += `<span class="financial-digit">${digits[0]}</span>`;
                            } else {
                                intResult += digits[0];
                            }
                            lastWasZero = true;
                        }
                    }
                }
            }
        }
        
        // 處理小數部分
        let decResult = '';
        if (decimalPart) {
            decResult = '點';
            for (let i = 0; i < decimalPart.length; i++) {
                if (format === 'financial') {
                    decResult += `<span class="financial-digit">${digits[parseInt(decimalPart.charAt(i))]}</span>`;
                } else {
                    decResult += digits[parseInt(decimalPart.charAt(i))];
                }
            }
        }
        
        // 組合結果
        return intResult + decResult;
    }
</script>
	
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.add('loaded');
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    const header = document.querySelector('.sticky-header');
    const h1Element = document.querySelector('h1');
    
    if (!header || !h1Element) return; // 添加检查

    window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const headerRect = header.getBoundingClientRect();
        const h1Rect = h1Element.getBoundingClientRect();
        
        // 使用更精确的条件判断
        if (scrollTop > header.offsetTop) {
            header.classList.add('is-sticky');
            if (h1Rect.bottom > 0) {
                header.classList.remove('is-sticky');
            }
        } else {
            header.classList.remove('is-sticky');
        }
    });
    });
</script>

<script>
        if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
            .then(registration => {
                console.log('ServiceWorker registration successful');
            })
            .catch(err => {
                console.log('ServiceWorker registration failed: ', err);
            });
        });
        }

        // 在所有 JavaScript 函數定義之後添加
        document.addEventListener('DOMContentLoaded', function() {
            // 設置輸入框點擊事件
            document.getElementById('period').addEventListener('click', function() {
                openCalculator('period', '請輸入【期數】');
            });
            
            document.getElementById('rate').addEventListener('click', function() {
                openCalculator('rate', '請輸入【稅前利率】');
            });
            
            document.getElementById('principal').addEventListener('click', function() {
                openCalculator('principal', '請輸入【本金】');
            });
            
            document.getElementById('payment').addEventListener('click', function() {
                openCalculator('payment', '請輸入【期繳】');
            });
            
            document.getElementById('commission').addEventListener('click', function() {
                openCalculator('commission', '請輸入【推廣】');
            });

            // 為資金成本輸入框添加點擊事件
            document.getElementById('monthlyCost').addEventListener('click', function() {
                openCalculator('monthlyCost', '請輸入【資金成本】');
            });
            
            // 點擊模態框背景關閉模態框
            document.getElementById('numberInputModal').addEventListener('click', function(event) {
                if (event.target === this) {
                    closeModal('numberInputModal');
                }
            });

            // 在这里添加历史记录面板背景点击关闭功能
            document.getElementById('historyPanel').addEventListener('click', function(event) {
                if (event.target === this) {
                    this.style.display = 'none';
                }
            });
            
            // 添加計算歷史的滾動功能
            const historyElement = document.getElementById('calculatorHistory');
            let isScrolling = false;
            let startX;
            let scrollLeft;

            historyElement.addEventListener('mousedown', (e) => {
                isScrolling = true;
                startX = e.pageX - historyElement.offsetLeft;
                scrollLeft = historyElement.scrollLeft;
            });

            historyElement.addEventListener('mouseleave', () => {
                isScrolling = false;
            });

            historyElement.addEventListener('mouseup', () => {
                isScrolling = false;
            });

            historyElement.addEventListener('mousemove', (e) => {
                if (!isScrolling) return;
                e.preventDefault();
                const x = e.pageX - historyElement.offsetLeft;
                const walk = (x - startX) * 2; // 滾動速度
                historyElement.scrollLeft = scrollLeft - walk;
            });

            // 添加觸摸事件支持
            historyElement.addEventListener('touchstart', (e) => {
                isScrolling = true;
                startX = e.touches[0].pageX - historyElement.offsetLeft;
                scrollLeft = historyElement.scrollLeft;
            });

            historyElement.addEventListener('touchend', () => {
                isScrolling = false;
            });

            historyElement.addEventListener('touchmove', (e) => {
                if (!isScrolling) return;
                const x = e.touches[0].pageX - historyElement.offsetLeft;
                const walk = (x - startX) * 2;
                historyElement.scrollLeft = scrollLeft - walk;
            });

        });
    </script>

    <!-- 數字輸入器模態框 -->
    <div id="numberInputModal" class="modal-overlay">
        <div class="number-input-modal">
            <div class="modal-header">
                <h3 id="inputModalTitle">數字輸入器</h3>
                <button class="close-btn" onclick="closeModal('numberInputModal')">×</button>
            </div>

            <div class="calculator-display-container">
                <div class="calculator-scroll-indicator" id="historyScrollIndicator"></div>
                <div class="calculator-history" id="calculatorHistory"></div>
                <div class="calculator-display" id="calculatorDisplay">0</div>
            </div>

            <div class="calculator-buttons">
                <!-- 第一行：功能鍵 -->
                <button onclick="calculatorClear()" class="clear">C</button>
                <button onclick="calculatorBackspace()" class="function">⌫</button>
                <button onclick="calculatorOperation('/')" class="operator">÷</button>
                <button onclick="calculatorOperation('*')" class="operator">×</button>
                
                <!-- 第二行：數字和減號 -->
                <button onclick="calculatorInput(7)" class="number-btn">
                    <div class="arabic-number">7</div>
                    <div class="financial-char">柒</div>
                </button>
                <button onclick="calculatorInput(8)" class="number-btn">
                    <div class="arabic-number">8</div>
                    <div class="financial-char">捌</div>
                </button>
                <button onclick="calculatorInput(9)" class="number-btn">
                    <div class="arabic-number">9</div>
                    <div class="financial-char">玖</div>
                </button>
                <button onclick="calculatorOperation('-')" class="operator">−</button>
                
                <!-- 第三行：數字和加號 -->
                <button onclick="calculatorInput(4)" class="number-btn">
                    <div class="arabic-number">4</div>
                    <div class="financial-char">肆</div>
                </button>
                <button onclick="calculatorInput(5)" class="number-btn">
                    <div class="arabic-number">5</div>
                    <div class="financial-char">伍</div>
                </button>
                <button onclick="calculatorInput(6)" class="number-btn">
                    <div class="arabic-number">6</div>
                    <div class="financial-char">陸</div>
                </button>
                <button onclick="calculatorOperation('+')" class="operator">+</button>
                
                <!-- 第四行：底部數字和等號 -->
                <button onclick="calculatorInput(1)" class="number-btn">
                    <div class="arabic-number">1</div>
                    <div class="financial-char">壹</div>
                </button>
                <button onclick="calculatorInput(2)" class="number-btn">
                    <div class="arabic-number">2</div>
                    <div class="financial-char">貳</div>
                </button>
                <button onclick="calculatorInput(3)" class="number-btn">
                    <div class="arabic-number">3</div>
                    <div class="financial-char">參</div>
                </button>
                <button onclick="calculatorEquals()" class="equals">=</button>
                
                <!-- 第五行：零、小數點和確認鍵 -->
                <button onclick="calculatorInput(0)" class="number-btn">
                    <div class="arabic-number">0</div>
                    <div class="financial-char">零</div>
                </button>
                <button onclick="calculatorDecimal()" class="function">.</button>
                <button onclick="submitCalculatorValue()" class="submit">確認輸入</button>
            </div>
        </div>
    </div>
</body>
</html>
